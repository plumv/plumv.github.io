<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"plumv.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="Springboot">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot的使用">
<meta property="og:url" content="https://plumv.github.io/2021/04/11/%E5%B0%9A%E7%A1%85%E8%B0%B7%E8%AF%B4Java/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/SpringBoot2/index.html">
<meta property="og:site_name" content="李川的个人博客">
<meta property="og:description" content="Springboot">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325114958.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325115609.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325123354.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325145602.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210412135650.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325174214.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325174434.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327131403.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327135637.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327140742.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327140949.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327143721.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327172601.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327172722.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330095925.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327172601.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330153242.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330154710.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330155312.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403085808.jpg">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403085804.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403094002.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403123215.jpg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605498132699-4fae6085-a207-456c-89fa-e571ff1663da.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605765121071-64cfc649-4892-49a3-ac08-88b52fb4286f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1212">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606366100317-5e0199fa-6709-4d32-bce3-bb262e2e5e6a.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210410145724.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210410172926.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210411155353.png">
<meta property="article:published_time" content="2021-04-10T16:00:00.000Z">
<meta property="article:modified_time" content="2021-06-04T11:06:56.149Z">
<meta property="article:author" content="Plum Reiver">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325114958.png">

<link rel="canonical" href="https://plumv.github.io/2021/04/11/%E5%B0%9A%E7%A1%85%E8%B0%B7%E8%AF%B4Java/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/SpringBoot2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SpringBoot的使用 | 李川的个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">李川的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学习生活</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>日志</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://plumv.github.io/2021/04/11/%E5%B0%9A%E7%A1%85%E8%B0%B7%E8%AF%B4Java/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/SpringBoot2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Plum Reiver">
      <meta itemprop="description" content="技术，日常，笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李川的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SpringBoot的使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-11 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-11T00:00:00+08:00">2021-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-04 19:06:56" itemprop="dateModified" datetime="2021-06-04T19:06:56+08:00">2021-06-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Java学习</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%AD%A6%E4%B9%A0/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">分布式技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Springboot</p>
<span id="more"></span>

<ul>
<li>版本：springboot 2.3.9 + maven 3</li>
<li>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/html/index.html">https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/html/index.html</a></li>
</ul>
<h1 id="第一章-HelloWorld"><a href="#第一章-HelloWorld" class="headerlink" title="第一章 HelloWorld"></a>第一章 HelloWorld</h1><ul>
<li><p>准备工作：修改maven配置。方便下载依赖从阿里云镜像下载。</p>
<ul>
<li>配置文件：apache-maven-3.6.3\conf\setting.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/nexus/content/repositories/central/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建一个maven工程</p>
</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325114958.png"></p>
<ul>
<li>在pom.xml文件中引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring-boot-starter为SpringBoot依赖的启动依赖--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring-boot-starter-web为web相关依赖。</span></span><br><span class="line"><span class="comment">引入后会引入springweb,webmvc,tomcat等依赖--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建Spring Boot启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* MainApplication作为启动整个项目的入口。</span></span><br><span class="line"><span class="comment">* SpringBootApplication注解表明这是一个启动类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(MainApplication.class,args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建控制层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RestController注解为spring的注解。</span></span><br><span class="line"><span class="comment"> *  其作用相当于Controller注解和ResponseBody注解的结合实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world Spring Boot&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>结果</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325115609.png"></p>
<h1 id="第二章：配置文件"><a href="#第二章：配置文件" class="headerlink" title="第二章：配置文件"></a>第二章：配置文件</h1><ul>
<li>Spring Boot的配置文件默认名为application.properties文件。也可以是application.yml文件。</li>
<li>配置文件的路径应在resources文件下。</li>
<li>Spring Boot只有一个配置文件，且这个配置文件是全局的。</li>
<li>Spring Boot的配置很多都是默认的，但当我们想改时，只需要在配置文件中写出即可。就会覆盖默认值。</li>
<li>配置文件支持的配置，官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/html/appendix-application-properties.html#common-application-properties">https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/html/appendix-application-properties.html#common-application-properties</a></li>
<li>例如：修改Tomcat启动的端口号为8088，而不是默认的8080。只需要在配置文件中添加以下带啊吗即可</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8088</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当初同时存在properties文件且有yml文件时。两个都会生效。</li>
<li>如果配置文件中配置了相同的设置。优先properties文件配置。</li>
</ul>
<p><strong>yml格式说明</strong></p>
<ul>
<li><p>基本语法</p>
<ul>
<li>key: value；kv之间有空格</li>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许使用tab，只允许空格</li>
<li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>
<li>‘#’表示注释</li>
<li>字符串无需加引号，如果要加，’’与””表示字符串内容 会被 转义/不转义</li>
</ul>
</li>
<li><p>数据类型</p>
<ul>
<li>字面量：单个的、不可再分的值。date、boolean、string、number、null</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> <span class="string">v</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对象：键值对的集合。map、hash、set、object </li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> </span><br><span class="line"> <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line"> <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line"> <span class="attr">k3:</span> <span class="string">v3</span></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="attr">k:</span> &#123;<span class="string">k1:v1</span>,<span class="string">k2:v2</span>,<span class="string">k3:v3</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>数组：一组按次序排列的值。array、list、queue</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v3</span></span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>示例</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Pet pet;</span><br><span class="line">    <span class="keyword">private</span> String[] interests;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; animal;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; score;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Double&gt; salarys;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;Pet&gt;&gt; allPets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>数据的写法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># yaml表示以上对象</span><br><span class="line">person:</span><br><span class="line">  userName: zhangsan</span><br><span class="line">  boss: false</span><br><span class="line">  birth: 2019&#x2F;12&#x2F;12 20:12:33</span><br><span class="line">  age: 18</span><br><span class="line">  pet: </span><br><span class="line">    name: tomcat</span><br><span class="line">    weight: 23.4</span><br><span class="line">  interests: [篮球,游泳]</span><br><span class="line">  animal: </span><br><span class="line">    - jerry</span><br><span class="line">    - mario</span><br><span class="line">  score:</span><br><span class="line">    english: </span><br><span class="line">      first: 30</span><br><span class="line">      second: 40</span><br><span class="line">      third: 50</span><br><span class="line">    math: [131,140,148]</span><br><span class="line">    chinese: &#123;first: 128,second: 136&#125;</span><br><span class="line">  salarys: [3999,4999.98,5999.99]</span><br><span class="line">  allPets:</span><br><span class="line">    sick:</span><br><span class="line">      - &#123;name: tom&#125;</span><br><span class="line">      - &#123;name: jerry,weight: 47&#125;</span><br><span class="line">    health: [&#123;name: mario,weight: 47&#125;]</span><br></pre></td></tr></table></figure>

<ul>
<li>当编写自定义的配置时。在配置文件没有提示。此时需要引入下面的依赖。</li>
<li>然后重新启动项目后就有提示了。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--设置打包时不打包configuration-processor。因为它只是方便我们开发的。和项目没有用--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第三章：打包部署"><a href="#第三章：打包部署" class="headerlink" title="第三章：打包部署"></a>第三章：打包部署</h1><ul>
<li>可以直接打包乘jar包。然后使用java -jar 包名的方式部署</li>
<li>第一步：导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注意点1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意点2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>helloworld<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意点3--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--此插件的作用是将项目直接打包成jar包，不需要打包成war包。</span></span><br><span class="line"><span class="comment">打包成jar包后，使用java -jar 包名 的方式直接运行了整个项目--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：使用maven清除缓存，然后打包。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325123354.png"></p>
<ul>
<li>注意：使用cmd时，需要设置cmd的窗口属性快速编辑模式前不打对号。</li>
</ul>
<h1 id="第四章：依赖管理"><a href="#第四章：依赖管理" class="headerlink" title="第四章：依赖管理"></a>第四章：依赖管理</h1><ul>
<li><p>SpringBoot中的依赖可以依赖父项目。</p>
<ul>
<li>子项目在添加依赖时，只需要写出依赖的groupId即可，不需要编写版本号。因为父项目都给确定好了版本。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--版本号的查看:</span></span><br><span class="line"><span class="comment">在父项目spring-boot-starter-parent的父项目spring-boot-dependencies中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当子项目的依赖的版本不想要父项目的版本，只需要设置properties中对应的版本覆盖父项目版本即可。<ul>
<li>maven的就近优先原则。</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.0.23<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在SpringBoot中starts意为一种场景。例如starts-web意为web项目的环境。环境中包含这个环境的所有依赖。</p>
<ul>
<li>所有的场景支持：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</a></li>
</ul>
</li>
<li><p>在依赖中以*-spring-boot-starter开头的依赖都是第三方给我们提供的可以在springboot中使用的场景。</p>
</li>
<li><p>springboot支持自定义场景。且建议场景的名字为*-spring-boot-starter</p>
</li>
</ul>
<h1 id="第五章：自动配置"><a href="#第五章：自动配置" class="headerlink" title="第五章：自动配置"></a>第五章：自动配置</h1><ul>
<li>SpringBoot的一个特点就是自动配置。<ul>
<li>即它帮我们配置了几乎所有场景的依赖包。我们只需要引入依赖即可。</li>
<li>另外它也帮我们配置了很多场景的默认配置。比如tomcat的端口号等等配置。我们可以在application配置文件中修改这些配置。</li>
</ul>
</li>
<li>自动配好Tomcat</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>自动配好SpringMVC</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>自动配好Web常见功能，如：字符编码问题。<ul>
<li>SpringBoot会在启动时，就将依赖场景相关的配置都加入到IOC中了。</li>
</ul>
</li>
<li>默认的包结构<ul>
<li>默认情况下，主程序所在包及其子包下的注解都会被SpringBoot扫描到。但是其他包就不能被扫描到。</li>
<li>但是我们可以自己设置扫描的位置。使用Componentscan注解。</li>
</ul>
</li>
<li>各种配置拥有默认值。<ul>
<li>所有的默认配置都是先加载到MultipartProperties中。</li>
<li>然后配置文件的值会绑定到相关的类上。</li>
</ul>
</li>
<li>按需加载所有自动配置项。<ul>
<li>按需指父项目中有的依赖，子项目不会全部加载。子项目只会加载子项目明确指定的依赖场景。</li>
</ul>
</li>
</ul>
<h1 id="第六章：容器功能"><a href="#第六章：容器功能" class="headerlink" title="第六章：容器功能"></a>第六章：容器功能</h1><h2 id="6-1-组件添加"><a href="#6-1-组件添加" class="headerlink" title="6.1 组件添加"></a>6.1 组件添加</h2><h3 id="6-1-1-Configuration注解"><a href="#6-1-1-Configuration注解" class="headerlink" title="6.1.1 @Configuration注解"></a>6.1.1 @Configuration注解</h3><ul>
<li>@Configuration用于表明此类是一个配置类。相当于Spring中的xml文件的作用。</li>
<li>使用方式如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Configuration</span></span><br><span class="line"><span class="meta">@Configuration(value = &quot;&quot;,proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 默认情况下。</span></span><br><span class="line"><span class="comment">   *  组件类型为返回值类型</span></span><br><span class="line"><span class="comment">   *  组件实例化就是返回值的数据</span></span><br><span class="line"><span class="comment">   *  组件的id为方法名</span></span><br><span class="line"><span class="comment">   *  组件实例默认为单实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">user1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;ads&quot;</span>,<span class="number">21</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * value,name属性为组件的id。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Bean(&quot;user&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">user2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;fgfgs&quot;</span>,<span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>说明<ul>
<li>@Configuration：只用于指明当前类时配置文件。<ul>
<li>配置类也是一个组件。默认是单实例的。组件id为类型第一个字母小写。</li>
<li>value属性表示bean名称，id</li>
<li>proxyBeanMethods属性：默认为true.</li>
<li>为true代表这个类是个代理对象。会被SpringBoot增强。且通过这个类调用的方法返回的都是一个实例。以保证单实例的bean</li>
<li>为false代表这个类就是一个配置类。且通过这个类调用的方法返回的不是同一个实例。此时的bean组件就是多实例了。</li>
<li>另一种说法：为true表示为全配置Full，生成单实例 。为false表示轻量配置Lite，生成多实例。</li>
</ul>
</li>
<li>@Bean：相当于xml文件的bean标签。<ul>
<li>默认情况下：组件类型为返回值类型，组件实例化就是返回值的数据，组件的id为方法名，组件实例默认为单实例。</li>
<li>name,value属性可以设置组件的id。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="6-1-2-Bean、-Component、-Controller、-Service、-Repository"><a href="#6-1-2-Bean、-Component、-Controller、-Service、-Repository" class="headerlink" title="6.1.2 @Bean、@Component、@Controller、@Service、@Repository"></a>6.1.2 @Bean、@Component、@Controller、@Service、@Repository</h3><ul>
<li>Spring boot也支持@Component、@Controller、@Service、@Repository注解的作用。</li>
<li>@Component：表明这个类是一个组件</li>
<li>@Controller：表明这个类是一个控制层的类。</li>
<li>@Service：表明这个类是一个访问层的类。</li>
<li>@Repository：表明这个类是一个数据访问层的类。</li>
</ul>
<h3 id="6-1-3-ComponentScan、-Import"><a href="#6-1-3-ComponentScan、-Import" class="headerlink" title="6.1.3 @ComponentScan、@Import"></a>6.1.3 @ComponentScan、@Import</h3><ul>
<li>@ComponentScan：指定扫描的包。一般是用在主配置文件上。</li>
<li>@Import：写在容器中的组件的类上。作用：给容器中导入组件<ul>
<li>值为：类的Class类型。是个数组类型，因此可以导入多个。</li>
<li>导入的组件的id为类的全列名。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Import(&#123;User.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-1-4-Conditional"><a href="#6-1-4-Conditional" class="headerlink" title="6.1.4 @Conditional"></a>6.1.4 @Conditional</h3><ul>
<li>条件装配：当满足Conditional指定的条件时，此注解表示的类或方法中的注解才会生效。</li>
<li>@Conditional是个根注解，此注解下面还有很多的子注解。我们经常使用的就是子注解。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325145602.png"></p>
<ul>
<li>实例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当容器中有user组件时，bean注解才生效</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(name = &quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">user1</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;ads&quot;</span>,<span class="number">21</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-2-原生配置文件引入-ImportResource"><a href="#6-2-原生配置文件引入-ImportResource" class="headerlink" title="6.2 原生配置文件引入@ImportResource"></a>6.2 原生配置文件引入@ImportResource</h2><ul>
<li><p>此注解的作用就是导入资源路径下的配置文件资源。</p>
</li>
<li><p>例如导入spring的配置文件，或springmvc的配置文件，或mybatis的配置文件(mybtis.xml)。</p>
<ul>
<li>springboot在导入配置文件后，会自动解析并绑定到相应的配置中。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:spring-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="6-3-配置绑定"><a href="#6-3-配置绑定" class="headerlink" title="6.3 配置绑定"></a>6.3 配置绑定</h2><ul>
<li>当我们使用数据库连接时，一般我们希望把他们写在配置文件中，以方便我们后期修改数据。</li>
<li>然后将配置的信息转载到JavaBean中。</li>
</ul>
<h3 id="6-3-1-ConfigurationProperties"><a href="#6-3-1-ConfigurationProperties" class="headerlink" title="6.3.1 @ConfigurationProperties"></a>6.3.1 @ConfigurationProperties</h3><ul>
<li>此注解用于将springboot主配置文件中的指定配置的信息绑定到当前的bean上。<ul>
<li>位置：bean实体上。</li>
<li>prefix属性：配置的前缀。</li>
<li>配置时除去前缀，剩下的应当与bean的属性名相一致。</li>
</ul>
</li>
</ul>
<h3 id="6-3-2-使用方式一：-ConfigurationProperties-Component"><a href="#6-3-2-使用方式一：-ConfigurationProperties-Component" class="headerlink" title="6.3.2 使用方式一：@ConfigurationProperties+@Component"></a>6.3.2 使用方式一：@ConfigurationProperties+@Component</h3><ul>
<li>两个注解都位于bean实体类上。</li>
<li>@Component用于将此实体类注入到容器中。</li>
<li>@ConfigurationProperties用于绑定配置信息。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Integer price;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置信息</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mycar.name</span>=<span class="string">byd</span></span><br><span class="line"><span class="meta">mycar.price</span>=<span class="string">10000</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-3-使用方式二：-ConfigurationProperties-EnableConfigurationProperties"><a href="#6-3-3-使用方式二：-ConfigurationProperties-EnableConfigurationProperties" class="headerlink" title="6.3.3 使用方式二：@ConfigurationProperties+@EnableConfigurationProperties"></a>6.3.3 使用方式二：@ConfigurationProperties+@EnableConfigurationProperties</h3><ul>
<li>@EnableConfigurationProperties注解用于配置类上。用于指定要开启配置信息绑定的类。</li>
<li>@ConfigurationProperties注解用于绑定配置信息。位于bean类上。<ul>
<li>此时的bean可以不加@Component注解</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注解类</span></span><br><span class="line"><span class="comment">//EnableConfigurationProperties意为：开启配置属性</span></span><br><span class="line"><span class="meta">@Configuration()</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;Car.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//bean类</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Integer price;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第七章：自动配置原理"><a href="#第七章：自动配置原理" class="headerlink" title="第七章：自动配置原理"></a>第七章：自动配置原理</h1><ul>
<li>在启动程序类中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//相当于下面三个注解的作用。扫描路径默认为当前启动类的包路径</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.lc&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="7-1-引导自动配置类"><a href="#7-1-引导自动配置类" class="headerlink" title="7.1 引导自动配置类"></a>7.1 引导自动配置类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-1-1-SpringBootConfiguration"><a href="#7-1-1-SpringBootConfiguration" class="headerlink" title="7.1.1 @SpringBootConfiguration"></a>7.1.1 @SpringBootConfiguration</h3><ul>
<li>源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>作用：表明当前类是一个配置类。</li>
</ul>
<h3 id="7-1-2-EnableAutoConfiguration"><a href="#7-1-2-EnableAutoConfiguration" class="headerlink" title="7.1.2 @EnableAutoConfiguration"></a>7.1.2 @EnableAutoConfiguration</h3><ul>
<li>源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span> <span class="comment">//自动配置包</span></span><br><span class="line"><span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@AutoConfigurationPackage注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@AutoConfigurationPackage注解导入了Registrar组件</li>
</ul>
<p><strong>Registrar类</strong></p>
<ul>
<li>此组件的方法：将注解的元信息的包路径的第一个路径进行了注册。<ul>
<li>此路径就是启动类所在的包路径。例如com.lc</li>
<li>因为元注解的第一个是启动类，因此SpringBoot的默认扫描路径是启动类所在的包路径</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">  register(registry, <span class="keyword">new</span> PackageImports(metadata).getPackageNames().toArray(<span class="keyword">new</span> String[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>import注解</strong></p>
<ul>
<li>@EnableAutoConfiguration注解通过@Import(AutoConfigurationImportSelector.class)导入另一个组件。</li>
</ul>
<p><strong>AutoConfigurationImportSelector类</strong></p>
<ul>
<li>意为自动配置选择器。</li>
<li>其中的一个方法：将元注解数据的所有配置信息都转换为字符数组返回。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">    <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">  &#125;</span><br><span class="line">  AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">  <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对*getAutoConfigurationEntry(annotationMetadata)*方法的解析<ul>
<li>作用：给容器中批量导入组件</li>
</ul>
</li>
<li>源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">    <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">  &#125;</span><br><span class="line">  AnnotationAttributes attributes = getAttributes(annotationMetadata);</span><br><span class="line">  <span class="comment">//获取所有要导入容器信息中的配置类组件。</span></span><br><span class="line">  List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">  configurations = removeDuplicates(configurations);</span><br><span class="line">  Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line">  checkExcludedClasses(configurations, exclusions);</span><br><span class="line">  configurations.removeAll(exclusions);</span><br><span class="line">  configurations = getConfigurationClassFilter().filter(configurations);</span><br><span class="line">  fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> AutoConfigurationEntry(configurations, exclusions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此方法调用了getCandidateConfigurations()方法。进而分析</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//工厂加载器</span></span><br><span class="line">  List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),</span><br><span class="line">                                                                       getBeanClassLoader());</span><br><span class="line">  Assert.notEmpty(configurations, <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories. If you &quot;</span></span><br><span class="line">                  + <span class="string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>getCandidateConfigurations()方法使用了工厂加载器获取所有的组件。</li>
<li>而工厂加载器又从FACTORIES_RESOURCE_LOCATION = “META-INF/spring.factories”路径下扫描。<ul>
<li>加载此文件后，加载此文件获取要加载的组件的类路径。</li>
<li>例如spring-boot-autocpnfigure.jar包中的spring.factories文件，列举了127个类路径。</li>
</ul>
</li>
</ul>
<p><strong>总结</strong></p>
<ul>
<li>@Import(AutoConfigurationImportSelector.class)通过一系列获取，最终在spring.factories文件中获取要加载的组件的类路经。</li>
<li>这个文件中的类路径是写死的。</li>
</ul>
<h3 id="7-1-3-ComponentScan"><a href="#7-1-3-ComponentScan" class="headerlink" title="7.1.3 @ComponentScan"></a>7.1.3 @ComponentScan</h3><ul>
<li>作用：指定包扫描的路径。</li>
</ul>
<h2 id="7-2-按需开启自动配置项"><a href="#7-2-按需开启自动配置项" class="headerlink" title="7.2 按需开启自动配置项"></a>7.2 按需开启自动配置项</h2><ul>
<li>虽然Springboot在启动时加载了127个配置。</li>
<li>但根据条件装配(@Conditional注解)，最终会按需装配这些组件，不会全部一次性加载完。</li>
</ul>
<h2 id="7-3-修改默认配置"><a href="#7-3-修改默认配置" class="headerlink" title="7.3 修改默认配置"></a>7.3 修改默认配置</h2><p>SpringBoot配置的特点：</p>
<ul>
<li>对于所有的场景都会有配置属性的绑定。</li>
<li>对于所有的配置类格式为xxxAutoConfig。</li>
<li>对于所有的配置是默认都有。但当用户在application.xml文件中指出时。会覆盖默认的。</li>
</ul>
<p>查看spring-boot-autoconfigure.jar中的所有文件可知。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span> <span class="comment">//此配置的优先级</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span> <span class="comment">//此类是个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><span class="comment">//是否是web应用程序</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DispatcherServlet.class)</span> <span class="comment">//存在DispatcherServlet组件</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(ServletWebServerFactoryAutoConfiguration.class)</span><span class="comment">//在ServletWebServerFactoryAutoConfiguration配置类加载之后，在加载自己。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServletAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第八章：开发技巧"><a href="#第八章：开发技巧" class="headerlink" title="第八章：开发技巧"></a>第八章：开发技巧</h1><h2 id="8-1-SpringBoot使用步骤"><a href="#8-1-SpringBoot使用步骤" class="headerlink" title="8.1 SpringBoot使用步骤"></a>8.1 SpringBoot使用步骤</h2><ul>
<li>第一步：引入场景依赖。<ul>
<li>Spring官方的场景的介绍：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/html/using-spring-boot.html#using-boot-starter</a></li>
</ul>
</li>
<li>第二步：查看自动配置了那些/查看引入的接口/源码(选做)<ul>
<li>可以查看自动配置相关的配置类。即spring-boot-autoconfigure.jar中的文件</li>
<li>在application.xml文件中加入debug=true开启debug模式。<ul>
<li>negative（不生效的）。positive（生效的）</li>
</ul>
</li>
</ul>
</li>
<li>第三步：是否需要修改配置。</li>
<li>第四步：加入组件或自定义组件</li>
</ul>
<h2 id="8-2-Lombok"><a href="#8-2-Lombok" class="headerlink" title="8.2 Lombok"></a>8.2 Lombok</h2><ul>
<li>简化JavaBean的开发，自动生成get,set.构造器等方法</li>
<li>第一步：引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：开发工具装上lombok插件</li>
<li>第三步：在JavaBean上使用Lombok的注解简化开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">//get,set,tostring方法</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">//全参构造</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>  <span class="comment">//无参构造</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//简化日志的开发</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">//添加注解</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;请求进来了&quot;</span>);  <span class="comment">//日志输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world Spring Boot&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-3-dev-tools"><a href="#8-3-dev-tools" class="headerlink" title="8.3 dev-tools"></a>8.3 dev-tools</h2><ul>
<li>作用：当引入此以来后。就实现了热部署。<ul>
<li>即：在项目启动后。如果修改项目的代码时，不需要重新启动项目。</li>
<li>IDEA需要按Ctrl+F9编译一遍项目。然后此依赖就会自动更新项目代码。</li>
</ul>
</li>
<li>但此依赖的实质还是重新启动项目。</li>
<li>想要不重启也实现热部署。想要使用付费的东西：<a target="_blank" rel="noopener" href="https://www.jrebel.com/products/jrebel">https://www.jrebel.com/products/jrebel</a></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">  &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="8-3-Spring-Initailizr（项目初始化向导）"><a href="#8-3-Spring-Initailizr（项目初始化向导）" class="headerlink" title="8.3 Spring Initailizr（项目初始化向导）"></a>8.3 Spring Initailizr（项目初始化向导）</h2><ul>
<li>Spring Initailizr是IDEA支持的快速创建SpringBoot应用的快捷方式。</li>
<li>第一步：选择Spring Initailizr，创建项目</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210412135650.png"></p>
<ul>
<li>第二步：选择场景</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325174214.png"></p>
<ul>
<li>第三步：设置项目名。</li>
<li>第四步：等待。等待以依赖加载完成。</li>
<li>项目结构</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210325174434.png"></p>
<h1 id="第九章：-web开发"><a href="#第九章：-web开发" class="headerlink" title="第九章： web开发"></a>第九章： web开发</h1><ul>
<li>SpringBoot在官方文档中说已经给我们配置好了所有的配置。我们在大多数场景下都无需自定义配置。</li>
<li>对于web开发，SpringBoot帮我们配置了<ul>
<li>内容协商视图解析器和BeanName视图解析器</li>
<li>静态资源（包括webjars）</li>
<li>自动注册 <code>Converter，GenericConverter，Formatter </code></li>
<li>支持 <code>HttpMessageConverters</code> </li>
<li>自动注册 <code>MessageCodesResolver</code> （国际化用）</li>
<li>静态index.html 页支持</li>
<li>自定义 <code>Favicon</code>  </li>
<li>自动使用 <code>ConfigurableWebBindingInitializer</code> ，（DataBinder负责将请求数据绑定到JavaBean上）</li>
</ul>
</li>
<li>同时我们还可以自定义自己的配置。例如：<ul>
<li>不用@EnableWebMvc注解。使用 <code>@Configuration</code> + <code>WebMvcConfigurer</code> 自定义规则</li>
<li>声明 <code>WebMvcRegistrations</code> 改变默认底层组件</li>
<li>使用 <code>@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration 全面接管SpringMVC</code></li>
</ul>
</li>
</ul>
<h2 id="9-1-静态资源访问"><a href="#9-1-静态资源访问" class="headerlink" title="9.1 静态资源访问"></a>9.1 静态资源访问</h2><ul>
<li><p>在SpringBoot中默认的静态资源是放在类路径下的。</p>
<ul>
<li>默认的资源路径文件目录可以是<code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code> /META-INF/resources</code> </li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327131403.png"></p>
<ul>
<li>访问路径为：当前项目根路径/+静态资源名。例如：<a target="_blank" rel="noopener" href="http://localhost:8080/1.jpg">http://localhost:8080/1.jpg</a></li>
</ul>
</li>
<li><p>当controller层有对/1.jpg请求的处理方法时，此请求不会访问资源，而是被controller的方法处理。</p>
</li>
<li><p>原理：</p>
<ul>
<li>首先SpringBoot设置的静态资源拦截是/**，表示拦截所有请求</li>
<li>当请求进来时，先找Controller能不能处理，不能处理则去静态资源的文件目录下寻找。即上述的目录。</li>
<li>当还找不到，就会报404错误。</li>
</ul>
</li>
</ul>
<p><strong>更改资源的默认设置</strong></p>
<ul>
<li>更改静态资源的拦截的路径</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置静态资源的拦截路径是：当前项目根路径 + /res/ + 资源名称。</span></span><br><span class="line"><span class="comment"># 例如：http://localhost:8080/res/1.jpg</span></span><br><span class="line"><span class="meta">spring.mvc.static-path-pattern</span>=<span class="string">/res/**</span></span><br></pre></td></tr></table></figure>

<ul>
<li>更改静态资源的文件目录</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改变静态资源的默认路径。从原来的四个默认路径，变为了aaa路径下。此路径可以有多个</span></span><br><span class="line"><span class="meta">spring.resources.static-locations[0]</span>=<span class="string">classpath:/aaa/</span></span><br><span class="line"><span class="meta">spring.resources.static-locations[1]</span>=<span class="string">classpath:/bbb/</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327135637.png"></p>
<p><strong>webjar</strong></p>
<ul>
<li>webjar是指：经常使用的js,jquery资源可以通过依赖的方式引入到项目中，而不通过将资源放到项目中。</li>
<li>webjar的官方地址：<a target="_blank" rel="noopener" href="https://www.webjars.org/">https://www.webjars.org/</a></li>
<li>SpringBoot对这类的资源的访问路径的前缀是：/webjar/**</li>
<li>以访问jquery为例</li>
<li>第一步：引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：查看依赖的源码（帮助理解的）</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327140742.png"></p>
<ul>
<li>第三步：通过<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.6.0/jquery.js%E8%AE%BF%E9%97%AE">http://localhost:8080/webjars/jquery/3.6.0/jquery.js访问</a></li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327140949.png"></p>
<h3 id="9-1-1-欢迎页支持"><a href="#9-1-1-欢迎页支持" class="headerlink" title="9.1.1 欢迎页支持"></a>9.1.1 欢迎页支持</h3><ul>
<li><p>SpringBoot默认访问的欢迎页是index.html。</p>
</li>
<li><p>第一步：在静态资源路径下新建一个index.html文件</p>
</li>
<li><p>注意点：</p>
<ul>
<li>当设置的静态资源访问路径后，就无法访问欢迎页。</li>
<li>但是我们可以设置静态资源文件的目录。其不影响我们访问欢迎页。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问欢迎页时，这个设置不能有</span></span><br><span class="line"><span class="comment"># spring.mvc.static-path-pattern=/res/**</span></span><br><span class="line"><span class="comment">#下面的设置可以有</span></span><br><span class="line"><span class="meta">spring.resources.static-locations[0]</span>=<span class="string">classpath: /aaa</span></span><br></pre></td></tr></table></figure></li>
<li><p>SpringBoot对于欢迎的访问默认为：<a target="_blank" rel="noopener" href="http://localhost:8080/index.html%E3%80%82%E5%85%B6%E4%B8%ADindex.html%E5%8F%AF%E4%BB%A5%E9%9A%90%E8%97%8F%E3%80%82">http://localhost:8080/index.html。其中index.html可以隐藏。</a></p>
<ul>
<li>因此当我们修改了静态资源访问路径后，无法访问到欢迎页面。</li>
<li>但是通过<a target="_blank" rel="noopener" href="http://localhost:8080/res/index.html%E6%98%AF%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0%E6%AC%A2%E8%BF%8E%E9%A1%B5%E7%9A%84%E3%80%82">http://localhost:8080/res/index.html是可以访问到欢迎页的。</a></li>
</ul>
</li>
</ul>
<h3 id="9-1-2自定义Favicon-图标"><a href="#9-1-2自定义Favicon-图标" class="headerlink" title="9.1.2自定义Favicon(图标)"></a>9.1.2自定义Favicon(图标)</h3><ul>
<li>Favicon即图标，是浏览器标签页的小图标。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327143721.png"></p>
<ul>
<li>SpringBoot支持图标功能。但是图标的名称一定是favicon.ico</li>
<li>图标文件可以放在静态资源路径下。</li>
<li>注意点：和欢迎页一样。<ul>
<li>当设置的静态资源访问路径后，就无法访问图标。</li>
</ul>
</li>
<li>原因和欢迎页一样。对图标的访问默认为：<a target="_blank" rel="noopener" href="http://localhost:8080/favicon.ico">http://localhost:8080/favicon.ico</a></li>
</ul>
<h3 id="9-1-3-静态资源配置原理"><a href="#9-1-3-静态资源配置原理" class="headerlink" title="9.1.3 静态资源配置原理"></a>9.1.3 静态资源配置原理</h3><ul>
<li>首先SpringBoot在启动后会加载所有xxxAutoConfig（z自动配置）。</li>
<li>因此我们查看WebMvcAutoConfiguration。他是一个静态资源的自动化配置类。代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span> <span class="comment">//确保当前是一个servlet的项目</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span><span class="comment">//确保当前为mvc环境</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span> <span class="comment">//确保当前没有mvc配置。即我们没有自定义mvc配置</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>总结：当前项目是mvc的servlet项目时，并且没有自定义配置。则``WebMvcAutoConfiguration`配置类生效。</p>
</li>
<li><p>然后查看``WebMvcAutoConfiguration`，发现其内又包含一个配置类适配器。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, ResourceProperties.class &#125;)</span><span class="comment">//此处启用了配置属性类。</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>WebMvcProperties类：绑定了配置中以<code>spring.mvc</code>开头的配置</li>
<li>ResourceProperties类：绑定了配置中以<code>spring.resources</code>开头的配置。并且注意一个代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此属性表明了资源的默认文件路径。对应配置中的spring.resources.static-locations配置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,</span><br><span class="line">                                                              <span class="string">&quot;classpath:/resources/&quot;</span>, <span class="string">&quot;classpath:/static/&quot;</span>, <span class="string">&quot;classpath:/public/&quot;</span> &#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>回到<code>WebMvcAutoConfigurationAdapter</code>配置类适配器中。发现只有一个有参的构造方法。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">WebMvcAutoConfigurationAdapter</span><span class="params">(WebMvcProperties mvcProperties, ListableBeanFactory beanFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">  <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">  <span class="keyword">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">  <span class="keyword">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">  <span class="keyword">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">  <span class="keyword">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>一个特点：有参构造器中所有参数的值都会从容器中确定</strong></li>
<li>mvcProperties参数：获取所有spring.mvc绑定的值。</li>
<li>beanFactory参数：Spring的bean工厂</li>
<li>messageConvertersProvider参数：获取所有的HttpMessageConverters。消息转换器</li>
<li>resourceHandlerRegistrationCustomizerProvider参数：找到资源处理器的自定义器</li>
<li>dispatcherServletPath参数：servlet路径调度器</li>
<li>servletRegistrations参数：给Servlet,Fliter…注册</li>
</ul>
</li>
<li><p>在``WebMvcAutoConfiguration<code>配置类中，有另一个配置类</code>EnableWebMvcConfiguration`</p>
</li>
</ul>
<p><strong>静态资源的配置代码</strong> </p>
<ul>
<li><p>在其中有对资源<code>ResourceProperties</code>处理的默认配置。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">super</span>.addResourceHandlers(registry);</span><br><span class="line">  <span class="comment">//当下面的属性为true时，启用资源配置。为false时不启用。</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">    logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//设置对webjar的静态资源配置</span></span><br><span class="line">  addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">  <span class="comment">//设置对静态资源的配置</span></span><br><span class="line">  addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getStaticPathPattern(),</span><br><span class="line">                     <span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addResourceHandler</span><span class="params">(ResourceHandlerRegistry registry, String pattern, String... locations)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (registry.hasMappingForPattern(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ResourceHandlerRegistration registration = registry.addResourceHandler(pattern);</span><br><span class="line">  registration.addResourceLocations(locations);</span><br><span class="line">  <span class="comment">//设置静态资源的缓存策略。</span></span><br><span class="line">  registration.setCachePeriod(getSeconds(<span class="keyword">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line">  registration.setCacheControl(<span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br><span class="line">  customizeResourceHandlerRegistration(registration);</span><br><span class="line">  <span class="keyword">this</span>.autoConfiguredResourceHandlers.add(pattern);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>因此在<code>ResourceProperties</code>中查看addMappings属性。发现其默认为true。</li>
<li>且其可以在配置文件中配置。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置是否启用默认的静态资源配置</span></span><br><span class="line"><span class="meta">spring.resources.add-mappings</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 设置静态资源的缓存存在时间。单位秒</span></span><br><span class="line"><span class="meta">spring.resources.cache.period</span>=<span class="string">11000</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>欢迎页的配置代码</strong></p>
<ul>
<li><p>在上述的方法下面可以找到对欢迎页的配置。代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                           FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;</span><br><span class="line">  WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="keyword">new</span> WelcomePageHandlerMapping(</span><br><span class="line">    <span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(),</span><br><span class="line">    <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">  welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">  welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());</span><br><span class="line">  <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">&#125;</span><br><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,</span><br><span class="line">                          ApplicationContext applicationContext, Resource welcomePage, String staticPathPattern) &#123;</span><br><span class="line">  <span class="comment">//此处写死了欢迎页的访问。如果存在欢迎页，且静态资源访问路径为/**。则转发到欢迎页。</span></span><br><span class="line">  <span class="keyword">if</span> (welcomePage != <span class="keyword">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">    logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage);</span><br><span class="line">    setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">    logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">    <span class="comment">//如果修改了静态资源访问路径，则找有没有cpntroller能处理这个欢迎页。</span></span><br><span class="line">    setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>首先明白一个单词： HandlerMapping：处理器映射。保存了每一个Handler能处理哪些请求。</li>
</ul>
</li>
</ul>
<h2 id="9-2-请求参数处理"><a href="#9-2-请求参数处理" class="headerlink" title="9.2 请求参数处理"></a>9.2 请求参数处理</h2><h3 id="9-2-1-请求映射"><a href="#9-2-1-请求映射" class="headerlink" title="9.2.1 请求映射"></a>9.2.1 请求映射</h3><ul>
<li><p>SpringBoot支持REST风格的请求。因为它内置了HiddenHttpMethodFilter过滤器。</p>
</li>
<li><p>但是在SpringBoot默认是关闭的。源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WebMvcAutoConfiguration自动配置类中</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;, matchIfMissing = false)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title">hiddenHttpMethodFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> OrderedHiddenHttpMethodFilter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>REST风格</strong></p>
<ul>
<li><p>指使用HTTP请求方式动词来表示对资源的操作</p>
</li>
<li><p>以前：*/getUser*  <em>获取用户</em>   <em>/deleteUser</em> <em>删除用户</em>   <em>/editUser</em>  <em>修改用户</em>    <em>/saveUser</em> <em>保存用户</em></p>
</li>
<li><p>现在： <em>/user</em>   <em>GET-获取用户</em>   <em>DELETE-删除用户</em>   <em>PUT-修改用户</em>    <em>POST-保存用户</em></p>
</li>
<li><p>HiddenHttpMethodFilter过滤器的使用方式：</p>
<ul>
<li>表单提交。</li>
<li>隐藏提交的_method属性。其值设置为想要提交的方式(PUT,DELETE)。</li>
<li>表单的提交仍为post提交，但由于_method属性，在经过过滤器时，会将post提交设置为对应的put或delete提交。</li>
</ul>
</li>
<li><p>HiddenHttpMethodFilter过滤器的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">  HttpServletRequest requestToUse = request;</span><br><span class="line">	<span class="comment">//提交方式为post提交，且有_method属性时才执行</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//获取请求中_method属性的值</span></span><br><span class="line">    String paramValue = request.getParameter(<span class="keyword">this</span>.methodParam);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;</span><br><span class="line">      <span class="comment">//将其转换成大写</span></span><br><span class="line">      String method = paramValue.toUpperCase(Locale.ENGLISH);</span><br><span class="line">      <span class="comment">//确定其是合法的。</span></span><br><span class="line">      <span class="comment">//ALLOWED_METHODS包含PUT,DELETE,PATCH三种请求</span></span><br><span class="line">      <span class="keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;</span><br><span class="line">        <span class="comment">//对请求进行装饰</span></span><br><span class="line">        requestToUse = <span class="keyword">new</span> HttpMethodRequestWrapper(request, method);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  filterChain.doFilter(requestToUse, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对于HttpMethodRequestWrapper装饰者类。利用了装饰式设计方式。代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpMethodRequestWrapper</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String method;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HttpMethodRequestWrapper</span><span class="params">(HttpServletRequest request, String method)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(request);</span><br><span class="line">    <span class="keyword">this</span>.method = method;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">//重写了这个方法，以区分请求的put和delete</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.method;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>REST风格请求的使用</strong></p>
<ul>
<li><p>首先在配置文件中开启HiddenHttpMethodFilter的功能</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启Rest风格的请求</span></span><br><span class="line"><span class="meta">spring.mvc.hiddenmethod.filter.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>然后编写表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;get-提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;post-提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">hidden</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put-提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">hidden</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete-提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写controller代码。Spring支持简化的RequestMapping的写法，不同mappering对应不同的请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET)</span></span><br><span class="line"><span class="comment">//简化为</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;get-user&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;post-user&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.PUT)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">putUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;put-user&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;delete-user&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>REST使用客户端工具</strong></p>
<ul>
<li>加入使用的是PostMan或手机等工具。它们发送的请求本身就是REST风格的。因此不需要配置HiddenHttpMethodFilter</li>
<li>这也是为什么spring.mvc.hiddenmethod.filter.enabled的值默认是false。</li>
</ul>
<p><strong>请求映射的原理</strong></p>
<ul>
<li><p>在SpringBoot中所有的请求都会访问DispatcherServlet的doDispatch()方法。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="comment">//复制当前的请求</span></span><br><span class="line">  HttpServletRequest processedRequest = request;</span><br><span class="line">  HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    ModelAndView mv = <span class="keyword">null</span>;</span><br><span class="line">    Exception dispatchException = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      processedRequest = checkMultipart(request);</span><br><span class="line">      multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 找到当前请求使用哪个handler处理。handler指controller中的方法。</span></span><br><span class="line">      mappedHandler = getHandler(processedRequest);</span><br><span class="line">      <span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">        noHandlerFound(processedRequest, response);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line">      HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br></pre></td></tr></table></figure></li>
<li><p>然后调用getHandler方法。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.handlerMappings != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//遍历当前所有的处理器映射。</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerMapping mapping : <span class="keyword">this</span>.handlerMappings) &#123;</span><br><span class="line">      HandlerExecutionChain handler = mapping.getHandler(request);</span><br><span class="line">      <span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> handler;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>初始情况下。处理器映射如下</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327172601.png"></p>
<ul>
<li>我们编写的被RequestMapping注解修饰的方法的映射就在RequestMappingHandlerMapping中。</li>
<li>位置如下：</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327172722.png"></p>
</li>
<li><p>因此：当请求进来后。</p>
<ul>
<li>首先在RequestMappingHandlerMapping中即controller中查找有没有处理请求的handler。</li>
<li>如果没有就去WelcomePageHandlerMapping 中查找。</li>
<li>当最中没有找到时，才会返回错误页面。</li>
</ul>
</li>
<li><p>我们有时会自定义一些映射处理，即xxxHandlerMapping。然后就可以对请求进行分类。达到不同系统 的问题。</p>
</li>
</ul>
<h3 id="9-2-2-普通参数与基本注解"><a href="#9-2-2-普通参数与基本注解" class="headerlink" title="9.2.2 普通参数与基本注解"></a>9.2.2 普通参数与基本注解</h3><ul>
<li>对于在controller接受请求中传来的参数。对应的注解大致分为4种。</li>
</ul>
<p><strong>注解：</strong></p>
<p>常见的有：@PathVariable、@RequestHeader、@RequestAttribute、@RequestParam、@MatrixVariable、@CookieValue、@RequestBody等</p>
<ul>
<li><p>@PathVariable：获取请求中url路径的参数信息</p>
<ul>
<li><p>请求的url格式为：/car/{1}/name/{李四}。其中{}中的数据为要获取的参数信息。</p>
</li>
<li><p>使用方式一：将参数封装到对应的参数中。想要指明哪个参数获取哪个信息。</p>
<ul>
<li>请求的url：<a target="_blank" rel="noopener" href="http://localhost:8080/car/1/owner/lisi">http://localhost:8080/car/1/owner/lisi</a></li>
<li>controller层代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求路径中的&#123;&#125;对应位置被绑定为参数，参数的名称为id或name.</span></span><br><span class="line"><span class="comment"> * 在方法的参数上通过<span class="doctag">@PathVariable</span>注解让id,name参数再绑定到对应的参数上。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test1</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,<span class="meta">@PathVariable(&quot;name&quot;)</span> String name)</span></span>&#123;</span><br><span class="line"> <span class="comment">//此时的id的值就是url中的1.name的值为lisi</span></span><br><span class="line">  </span><br><span class="line">  Map&lt;String,Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">  result.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用方式二：将参数封装到map中。不需要指明。此时会将所有的都绑定到map中</p>
<ul>
<li>请求url:<a target="_blank" rel="noopener" href="http://localhost:8080/car/1/owner/lisi">http://localhost:8080/car/1/owner/lisi</a></li>
<li>controller层代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 此时不需要指定参数绑定的名称，默认将所有参数都绑定到map中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">test1</span><span class="params">(Map&lt;String,String&gt; pathParamMap)</span></span>&#123;</span><br><span class="line">	<span class="comment">//此时的pathParamMap中有两个key-value.</span></span><br><span class="line">  <span class="comment">//一个是：id-1</span></span><br><span class="line">  <span class="comment">//另一个是：name-lisi</span></span><br><span class="line">  <span class="keyword">return</span> pathParamMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>源码：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation which indicates that a method parameter should be bound to a URI template</span></span><br><span class="line"><span class="comment"> * variable. Supported for &#123;<span class="doctag">@link</span> RequestMapping&#125; annotated handler methods.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If the method parameter is &#123;<span class="doctag">@link</span> java.util.Map Map&amp;lt;String, String&amp;gt;&#125;</span></span><br><span class="line"><span class="comment"> * then the map is populated with all path variable names and values.</span></span><br><span class="line"><span class="comment"> *意为如果方法的参数是Map&lt;String,String&gt;类型的，则将所有的路径参数绑定到map中</span></span><br><span class="line"><span class="comment"> *注意Map的key和value都是String类型的</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Arjen Poutsma</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestMapping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PathVariable &#123;</span><br></pre></td></tr></table></figure></li>
<li><p>@RequestHeader：获取请求中请求头的信息。</p>
<ul>
<li>类似于这样</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330095925.png"></p>
<ul>
<li><p>使用方式一：明确指出要获取的请求头中，对应key-value的属性值。</p>
<ul>
<li>controller代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/car&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">test3</span><span class="params">(<span class="meta">@RequestHeader(&quot;accept&quot;)</span> String accept)</span></span>&#123;</span><br><span class="line">  <span class="comment">//只获取请求头中accept对应的值，将其绑定到参数accept中。</span></span><br><span class="line">  Map&lt;String,String&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;accept&quot;</span>, accept);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用方式二：获取请求头中所有的信息。参数为Map或MultiValueMap或HttpHeaders</p>
<ul>
<li>查看源码可知：HttpHeaders实现了MultiValueMap接口，而MultiValueMap接口继承了map接口</li>
<li>controller代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/car&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test4</span><span class="params">(<span class="meta">@RequestHeader</span> HttpHeaders headers)</span></span>&#123;</span><br><span class="line">  <span class="comment">//将请求头中的所有信息都绑定到headers参数中</span></span><br><span class="line">  Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;headers&quot;</span>, headers);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//HttpHeaders的部分源码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpHeaders</span> <span class="keyword">implements</span> <span class="title">MultiValueMap</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCEPT = <span class="string">&quot;Accept&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCEPT_CHARSET = <span class="string">&quot;Accept-Charset&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCEPT_ENCODING = <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCEPT_LANGUAGE = <span class="string">&quot;Accept-Language&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCEPT_RANGES = <span class="string">&quot;Accept-Ranges&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_CONTROL_ALLOW_CREDENTIALS = <span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_CONTROL_ALLOW_HEADERS = <span class="string">&quot;Access-Control-Allow-Headers&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_CONTROL_ALLOW_METHODS = <span class="string">&quot;Access-Control-Allow-Methods&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACCESS_CONTROL_ALLOW_ORIGIN = <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//MultiValueMap的部分源码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultiValueMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Map</span>&lt;<span class="title">K</span>, <span class="title">List</span>&lt;<span class="title">V</span>&gt;&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>源码：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation which indicates that a method parameter should be bound to a web request header.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Supported for annotated handler methods in Spring MVC and Spring WebFlux.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If the method parameter is &#123;<span class="doctag">@link</span> java.util.Map Map&amp;lt;String, String&amp;gt;&#125;,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.util.MultiValueMap MultiValueMap&amp;lt;String, String&amp;gt;&#125;,</span></span><br><span class="line"><span class="comment"> * or &#123;<span class="doctag">@link</span> org.springframework.http.HttpHeaders HttpHeaders&#125; then the map is</span></span><br><span class="line"><span class="comment"> * populated with all header names and values.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestMapping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestParam</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CookieValue</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestHeader &#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>@RequestAttribute：绑定请求域中的信息</p>
<ul>
<li>代码：转发前往request域中放入key-value信息，转发后获取请求与中的信息。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/goToPage&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">goToPage</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">  request.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;成功了&quot;</span>);</span><br><span class="line">  request.setAttribute(<span class="string">&quot;code&quot;</span>, <span class="number">200</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/success&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test2</span><span class="params">(<span class="meta">@RequestAttribute(&quot;msg&quot;)</span>String msg,<span class="meta">@RequestAttribute(&quot;code&quot;)</span>Integer code)</span></span>&#123;</span><br><span class="line">  <span class="comment">//获取请求域中指定属性的值</span></span><br><span class="line">  Map&lt;String,Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;msg&quot;</span>, msg);</span><br><span class="line">  result.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//直接获取请求域,作用和上面相同</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/success&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test3</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">  <span class="comment">//获取请求域中指定属性的值</span></span><br><span class="line">  Map&lt;String,Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;msg&quot;</span>, request.getAttribute(<span class="string">&quot;msg&quot;</span>));</span><br><span class="line">  result.put(<span class="string">&quot;code&quot;</span>,  request.getAttribute(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>源码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation to bind a method parameter to a request attribute.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The main motivation is to provide convenient access to request attributes</span></span><br><span class="line"><span class="comment"> * from a controller method with an optional/required check and a cast to the</span></span><br><span class="line"><span class="comment"> * target method parameter type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rossen Stoyanchev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestMapping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> SessionAttribute</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestAttribute &#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>@RequestParam：绑定请求参数类型。和SpringMVC的用法一致</p>
</li>
<li><p>@CookieValue：获取请求头中cookie属性的值。cookie中又分很多key-value的信息。</p>
<ul>
<li>例如上述的图片中就有lang和yuque_ctoken两个属性的值。</li>
<li>使用方式一：指定获取的key。将其value绑定到参数中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/car&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test5</span><span class="params">(<span class="meta">@CookieValue(&quot;lang&quot;)</span>String lang)</span></span>&#123;</span><br><span class="line">  <span class="comment">//只获取cookie中lang对应的value值，将其绑定到lang参数中</span></span><br><span class="line">  Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;lang&quot;</span>, lang);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用方式二：将所有的信息绑定到Cookie对象中。<ul>
<li>注意Cookie是javax.servlet.http包下的Cookie类</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/car&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">test6</span><span class="params">(<span class="meta">@CookieValue</span> Cookie cookie)</span></span>&#123;</span><br><span class="line">  <span class="comment">//将cookie中的所有属性绑定到cookie中</span></span><br><span class="line">  Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;cookie&quot;</span>, cookie);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>源码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation which indicates that a method parameter should be bound to an HTTP cookie.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The method parameter may be declared as type &#123;<span class="doctag">@link</span> javax.servlet.http.Cookie&#125;</span></span><br><span class="line"><span class="comment"> * or as cookie value type (String, int, etc.).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestMapping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestParam</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestHeader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.web.bind.annotation.RequestMapping</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CookieValue &#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>@RequestBody：获取请求体中的数据。请求体一般只有post请求中才有。</p>
<ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">terst7</span><span class="params">(<span class="meta">@RequestBody</span> String context)</span></span>&#123;</span><br><span class="line">  Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  map.put(<span class="string">&quot;context&quot;</span>,context);</span><br><span class="line">  <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation indicating a method parameter should be bound to the body of the web request.</span></span><br><span class="line"><span class="comment"> * The body of the request is passed through an &#123;<span class="doctag">@link</span> HttpMessageConverter&#125; to resolve the</span></span><br><span class="line"><span class="comment"> * method argument depending on the content type of the request. Optionally, automatic</span></span><br><span class="line"><span class="comment"> * validation can be applied by annotating the argument with &#123;<span class="doctag">@code</span> <span class="doctag">@Valid</span>&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Supported for annotated handler methods.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Arjen Poutsma</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> RequestHeader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ResponseBody</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.PARAMETER)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestBody &#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>@MatrixVariable：<font color="red">矩阵变量</font></p>
<ul>
<li>矩阵变量：在URL中，以url路径为基础的，用“;”分割的数据信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//URL:/car/path;name=lisi;age=10</span></span><br><span class="line">controller映射为：<span class="meta">@GetMapping(&quot;/car/&#123;path&#125;&quot;)</span></span><br><span class="line"><span class="comment">//其中path;name=lisi;age=10以;拆分，第一个path仍未路径参数。后面的name=lisi和age=10为矩阵变量。</span></span><br></pre></td></tr></table></figure>

<ul>
<li>用处：当浏览器禁用Cookie时，对于Session的id服务器就无法获取了。因此可以在矩阵变量中传递这个SessionId。</li>
<li>通用的功能请求参数也能实现，但使用矩阵变量可以和请求参数区别开。</li>
<li>注意点：<ul>
<li>语法：/car/path;name=lisi;brand=byd,audi,yd</li>
<li>SpringBoot默认时禁用了矩阵变量的功能。想要手动开启。开启方式在下面</li>
<li>矩阵变量必须有url路径变量才能被解析。</li>
</ul>
</li>
<li>使用方式：可以指明具体的key,也可以使用map承接全部的变量</li>
<li>示例一：值传递一个路径参数的矩阵变量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求url:/car/path;name=lisi;brand=byd,yd,audi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/car/&#123;path&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map <span class="title">test8</span><span class="params">(<span class="meta">@MatrixVariable(&quot;name&quot;)</span> String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="meta">@MatrixVariable(&quot;brand&quot;)</span> List&lt;Integer&gt; brand,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="meta">@PathVariable(&quot;path&quot;)</span>String path)</span></span>&#123;</span><br><span class="line">  <span class="comment">//注意必须有@PathVariable。@MatrixVariable才起作用。</span></span><br><span class="line">  <span class="comment">//参数的值分别为：path = path ,name = lisi ,brand = [byd,yd,audi]</span></span><br><span class="line">  Map&lt;String,Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">  result.put(<span class="string">&quot;brand&quot;</span>,brand);</span><br><span class="line">  result.put(<span class="string">&quot;path&quot;</span>,path);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>示例二：值传递二个以上路径参数的矩阵变量。此处可以省略 @PathVariable路径变量注解。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求url:/car/first;age=20/second;age=10</span></span><br><span class="line"><span class="comment"> * pathVar属性：指定当前的矩阵变量是属于哪个路径变量的</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/car/&#123;first&#125;/&#123;second&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map <span class="title">test9</span><span class="params">(<span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;first&quot;)</span> String firstAge,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;second&quot;)</span> String secondAge,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="meta">@PathVariable(&quot;first&quot;)</span>String first,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="meta">@PathVariable(&quot;second&quot;)</span>String second)</span></span>&#123;</span><br><span class="line">  <span class="comment">//注意必须有@PathVariable。@MatrixVariable才起作用。</span></span><br><span class="line">  <span class="comment">//参数的值分别为：firstAge = 20，secondAge=10，first=first，second=second</span></span><br><span class="line">  Map&lt;String,Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  result.put(<span class="string">&quot;firstAge&quot;</span>,firstAge);</span><br><span class="line">  result.put(<span class="string">&quot;secondAge&quot;</span>,secondAge);</span><br><span class="line">  result.put(<span class="string">&quot;first&quot;</span>,first);</span><br><span class="line">  result.put(<span class="string">&quot;second&quot;</span>,second);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>SpringBoot关于矩阵变量的源码</p>
<ul>
<li>第一个：WebMvcAutoConfiguration自动配置类中有一个配置路径变量的方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//configurePathMatch意为：配置路径匹配</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">  configurer.setUseSuffixPatternMatch(<span class="keyword">this</span>.mvcProperties.getPathmatch().isUseSuffixPattern());</span><br><span class="line">  configurer.setUseRegisteredSuffixPatternMatch(</span><br><span class="line">    <span class="keyword">this</span>.mvcProperties.getPathmatch().isUseRegisteredSuffixPattern());</span><br><span class="line">  <span class="keyword">this</span>.dispatcherServletPath.ifAvailable((dispatcherPath) -&gt; &#123;</span><br><span class="line">    String servletUrlMapping = dispatcherPath.getServletUrlMapping();</span><br><span class="line">    <span class="keyword">if</span> (servletUrlMapping.equals(<span class="string">&quot;/&quot;</span>) &amp;&amp; singleDispatcherServlet()) &#123;</span><br><span class="line">      <span class="comment">//UrlPathHelper被添加到了配置中。下面查看这个类</span></span><br><span class="line">      UrlPathHelper urlPathHelper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">      urlPathHelper.setAlwaysUseFullPath(<span class="keyword">true</span>);</span><br><span class="line">      configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第二个：UrlPathHelper类中有一个属性removeSemicolonContent</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UrlPathHelper意为url路径帮助。此类中配置了很多的关于URL的解码方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UrlPathHelper</span> </span>&#123;</span><br><span class="line">  <span class="comment">//此属性意为：移除分号内容。此属性就是控制矩阵变量功能是否开启的配置。默认为true</span></span><br><span class="line">  <span class="comment">//true：表示在url中会将&quot;;&quot;分号后面的都给移除掉，因此矩阵变量就不起作用了。</span></span><br><span class="line">  <span class="comment">//将其设置为false就可以开启矩阵变量功能。</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> removeSemicolonContent = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>开启矩阵变量功能的方式：</p>
<ul>
<li>方式一：创建一个配置类，让这个配置类实现WebMvcConfigurer接口，然后重写configurePathMatch方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration()</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">    UrlPathHelper helper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">    <span class="comment">//在此处将removeSemicolonContent属性设置为false即可</span></span><br><span class="line">    helper.setRemoveSemicolonContent(<span class="keyword">false</span>);</span><br><span class="line">    configurer.setUrlPathHelper(helper);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方式二：使用bean注解。往容器中加入一个修改后的WebMvcConfigurer实体。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration()</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span></span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//使用匿名内部类的方式实现实体的创建。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer()&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">        UrlPathHelper helper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">        <span class="comment">//在此处将removeSemicolonContent属性设置为false即可</span></span><br><span class="line">        helper.setRemoveSemicolonContent(<span class="keyword">false</span>);</span><br><span class="line">        configurer.setUrlPathHelper(helper);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>Servlet API</strong></p>
<p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p>
<ul>
<li><p>查看源码：ServletRequestMethodArgumentResolver类。请求方法参数解析。</p>
<ul>
<li>用于解析上面的ServletAPI类型的参数。核心代码如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>&#123;</span><br><span class="line">  Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">  <span class="keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">          ServletRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">          MultipartRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">          HttpSession.class.isAssignableFrom(paramType) ||</span><br><span class="line">          (pushBuilder != <span class="keyword">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||</span><br><span class="line">          Principal.class.isAssignableFrom(paramType) ||</span><br><span class="line">          InputStream.class.isAssignableFrom(paramType) ||</span><br><span class="line">          Reader.class.isAssignableFrom(paramType) ||</span><br><span class="line">          HttpMethod.class == paramType ||</span><br><span class="line">          Locale.class == paramType ||</span><br><span class="line">          TimeZone.class == paramType ||</span><br><span class="line">          ZoneId.class == paramType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>复杂参数</strong></p>
<p><strong>Map</strong>、<strong>Model（map、model里面的数据会被放在request的请求域  request.setAttribute）、</strong>Errors/BindingResult、<strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong>、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p>
<ul>
<li>map和model做参数时，会在解析时返回mavContainer.getModel()。</li>
<li>而getModel()方法会BindingAwareModelMap对象。</li>
<li>当map和model在同一个处理器中，参数解析器只会创建一个BindingAwareModelMap对象，而不是创建两个。</li>
</ul>
<h3 id="9-2-3-自定义对象参数-POJO封装过程"><a href="#9-2-3-自定义对象参数-POJO封装过程" class="headerlink" title="9.2.3 自定义对象参数 POJO封装过程"></a>9.2.3 <strong>自定义对象参数</strong> POJO封装过程</h3><ul>
<li>解析器为ServletModelAttributeMethodProcessor类<ul>
<li>先创建空对象。</li>
<li>然后将请求参数转换成对应的数据类型。(提供了大概124个类型转换器)</li>
<li>在为对象的属性设置值。通过反射。</li>
</ul>
</li>
<li>GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean – Integer）。</li>
<li>自定义的类型转换器。类型转换器会被添加到converter中。</li>
<li>样例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、WebMvcConfigurer定制化SpringMVC的功能</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">      registry.addConverter(<span class="keyword">new</span> Converter&lt;String, Pet&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Pet <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// 啊猫,3</span></span><br><span class="line">          <span class="keyword">if</span>(!StringUtils.isEmpty(source))&#123;</span><br><span class="line">            Pet pet = <span class="keyword">new</span> Pet();</span><br><span class="line">            String[] split = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            pet.setName(split[<span class="number">0</span>]);</span><br><span class="line">            pet.setAge(Integer.parseInt(split[<span class="number">1</span>]));</span><br><span class="line">            <span class="keyword">return</span> pet;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-4-参数处理原理"><a href="#9-2-4-参数处理原理" class="headerlink" title="9.2.4 参数处理原理"></a>9.2.4 参数处理原理</h3><ul>
<li>首先：DispatcherServlet类中的doDispatch方法用于对请求进行处理。此方法中有三步处理</li>
<li>方法的简化源码如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  ModelAndView mv;</span><br><span class="line">  HttpServletRequest processedRequest = request;</span><br><span class="line">  <span class="comment">//第一步：getHandler()方法用于获取当前请求的处理器(即有RequestMapping注解的方法。)</span></span><br><span class="line">  mappedHandler = getHandler(processedRequest);</span><br><span class="line">  <span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">    noHandlerFound(processedRequest, response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//第二步：根据当前的处理器找到对应的处理器适配器</span></span><br><span class="line">  <span class="comment">//这一步是因为方法的参数的匹配很麻烦，因此使用适配器解析参数，然后通过反射调用处理器。</span></span><br><span class="line">  HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//第三步：执行处理器适配的目标方法。此方法执行后请求就完成了处理。</span></span><br><span class="line">  mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">	<span class="comment">//对响应结果进行处理</span></span><br><span class="line">  processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>上述的第一步：获取处理器的源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.handlerMappings != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//遍历全部的处理器映射，返回合适的处理器</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerMapping mapping : <span class="keyword">this</span>.handlerMappings) &#123;</span><br><span class="line">      HandlerExecutionChain handler = mapping.getHandler(request);</span><br><span class="line">      <span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> handler;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>处理器映射的截图如下</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210327172601.png"></p>
</li>
<li><p>上述的第二步：获取处理器适配器的源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HandlerAdapter <span class="title">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.handlerAdapters != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//遍历全部的处理器适配器，找到合适的适配器</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerAdapter adapter : <span class="keyword">this</span>.handlerAdapters) &#123;</span><br><span class="line">      <span class="keyword">if</span> (adapter.supports(handler)) &#123;</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">&quot;No adapter for handler [&quot;</span> + handler +</span><br><span class="line">                             <span class="string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>处理器适配器的截图如下：</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330153242.png"></p>
</li>
<li><p>上述的第三步：</p>
<ul>
<li>handle方法又调用了handleInternal()方法。</li>
<li>handleInternal方法判断请求是否是同步的。然后又调用了invokeHandlerMethod方法</li>
<li>invokeHandlerMethod方法才是真正的执行处理器的方法。方法位于RequestMappingHandlerAdapter类中</li>
</ul>
</li>
<li><p>invokeHandlerMethod的核心源码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置参数解析器</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers != <span class="keyword">null</span>) &#123;</span><br><span class="line">  invocableMethod.setHandlerMethodArgumentResolvers(<span class="keyword">this</span>.argumentResolvers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置返回值解析器</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers != <span class="keyword">null</span>) &#123;</span><br><span class="line">  invocableMethod.setHandlerMethodReturnValueHandlers(<span class="keyword">this</span>.returnValueHandlers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行并且处理。</span></span><br><span class="line">invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br></pre></td></tr></table></figure>

<ul>
<li>参数解析器如下：</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330154710.png"></p>
<ul>
<li>返回值解析器如下：</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210330155312.png"></p>
</li>
<li><p>参数解析器的说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerMethodArgumentResolver</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span></span>;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function">Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">			NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用步骤：supportsParameter用于判断当前参数支不支持这个参数解析器。</li>
<li>支持就调用resolveArgument方法</li>
</ul>
</li>
<li><p>invokeAndHandle方法的说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">                            Object... providedArgs)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">//此方法真正的执行了controller层的方法。</span></span><br><span class="line">  <span class="comment">//此方法先确定了方法的每个参数的值，然后通过反射执行目标方法。</span></span><br><span class="line">  Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>invokeForRequest()方法中调用了getMethodArgumentValues()方法获取了方法的参数值。</p>
</li>
<li><p>getMethodArgumentValues方法源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="line">                                           Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">//获取所有的参数列表</span></span><br><span class="line">  MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">  <span class="comment">//判断参数列表是否为空</span></span><br><span class="line">  <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">    <span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">//创建了Object数组，存放参数的值信息</span></span><br><span class="line">  Object[] args = <span class="keyword">new</span> Object[parameters.length];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">    MethodParameter parameter = parameters[i];</span><br><span class="line">    parameter.initParameterNameDiscovery(<span class="keyword">this</span>.parameterNameDiscoverer);</span><br><span class="line">    args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">    <span class="keyword">if</span> (args[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断当前解析器支不支持当前类型的请求</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//此处开始解析参数</span></span><br><span class="line">      args[i] = <span class="keyword">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="keyword">this</span>.dataBinderFactory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">      <span class="comment">// Leave stack trace for later, exception may actually be resolved and handled...</span></span><br><span class="line">      <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">        String exMsg = ex.getMessage();</span><br><span class="line">        <span class="keyword">if</span> (exMsg != <span class="keyword">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">          logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>resolveArgument方法调用了getArgumentResolver(parameter)方法。那到当前参数的参数解析器。</p>
</li>
<li><p>getArgumentResolver(parameter)方法源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//首先从缓存中找。</span></span><br><span class="line">  HandlerMethodArgumentResolver result = <span class="keyword">this</span>.argumentResolverCache.get(parameter);</span><br><span class="line">  <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//遍历所有的参数解析器</span></span><br><span class="line">    <span class="keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="keyword">this</span>.argumentResolvers) &#123;</span><br><span class="line">      <span class="comment">//supportsParameter通过检查参数是否标识了对应的注解。标识的化就返回true</span></span><br><span class="line">      <span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;</span><br><span class="line">        result = resolver;</span><br><span class="line">        <span class="comment">//将参数解析器和对应的参数存入缓存。这样后面的访问就会很快</span></span><br><span class="line">        <span class="keyword">this</span>.argumentResolverCache.put(parameter, result);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>resolveArgument方法调用resolver.resolveArgument()。解析器的解析方法。解析参数的值。并将值返回</p>
</li>
<li><p>resolveArgument方法源码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">  NamedValueInfo namedValueInfo = getNamedValueInfo(parameter);</span><br><span class="line">  MethodParameter nestedParameter = parameter.nestedIfOptional();</span><br><span class="line">  <span class="comment">//获取解析的key。比如路径解析中&#123;&#125;中的值</span></span><br><span class="line">  Object resolvedName = resolveEmbeddedValuesAndExpressions(namedValueInfo.name);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//解析key对应的值</span></span><br><span class="line">  Object arg = resolveName(resolvedName.toString(), nestedParameter, webRequest);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>请求处理完后。会返回一个ModelAndView。这个对象存放着返回的视图和数据。</p>
</li>
<li><p>对响应结果的处理</p>
</li>
</ul>
<h2 id="9-3-数据响应与内容协商"><a href="#9-3-数据响应与内容协商" class="headerlink" title="9.3 数据响应与内容协商"></a>9.3 数据响应与内容协商</h2><p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403085808.jpg"></p>
<h3 id="9-3-1-响应JSON"><a href="#9-3-1-响应JSON" class="headerlink" title="9.3.1 响应JSON"></a>9.3.1 响应JSON</h3><ul>
<li><p>使用方式：</p>
<ul>
<li>引入web开发场景。此时web开发场景已经整合了json依赖。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--web开发场景--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--整合了以下关于json的依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jdk8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在处理器上添加注解。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/test/json&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">getPerson</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Person person = <span class="keyword">new</span> Person();</span><br><span class="line">  person.setName(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">  person.setAge(<span class="number">18</span>);</span><br><span class="line">  person.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">  <span class="keyword">return</span> person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-3-2-内容协商"><a href="#9-3-2-内容协商" class="headerlink" title="9.3.2 内容协商"></a>9.3.2 内容协商</h3><ul>
<li><p>内容协商是指：浏览器再发送请求时，会在请求头中告诉服务器，浏览器能接收什么类型的返回数据。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// q=0.9标识权重。权重越大标识客户端更想接收此类型的响应。</span><br><span class="line">accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br></pre></td></tr></table></figure></li>
<li><p><strong>内容协商原理</strong></p>
<ul>
<li>第一步：客户端发送请求给服务器</li>
<li>第二步：服务器判断当前响应头中是否已经有确认的媒体类型。即被拦截器修改的</li>
<li>第三步：服务器获取客户端支持接收的内容类型。（获取客户端请求头中Accept的字段）<ul>
<li><strong>contentNegotiationManager</strong> 内容协商管理器 默认使用基于请求头的策略。(此策略可以改)</li>
<li>进而使用<strong>HeaderContentNegotiationStrategy</strong>  确定客户端可以接收的内容类型 </li>
</ul>
</li>
<li>第四步：遍历所有的消息转换器。看谁能支持当前的返回值类型数据</li>
<li>第五步：遍历客户端能接受的，服务端能产生的。匹配后放入list中</li>
<li>第六步：找到最佳匹配的媒体数据类型。</li>
<li>第六步：遍历所有的消息转换器。找到合适的消息转换器，将数据转换成对应的媒体类型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建媒体类型</span></span><br><span class="line">MediaType selectedMediaType = <span class="keyword">null</span>;</span><br><span class="line">MediaType contentType = outputMessage.getHeaders().getContentType();</span><br><span class="line"><span class="keyword">boolean</span> isContentTypePreset = contentType != <span class="keyword">null</span> &amp;&amp; contentType.isConcrete();</span><br><span class="line"><span class="keyword">if</span> (isContentTypePreset) &#123;</span><br><span class="line">  <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">    logger.debug(<span class="string">&quot;Found &#x27;Content-Type:&quot;</span> + contentType + <span class="string">&quot;&#x27; in response&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  selectedMediaType = contentType;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  HttpServletRequest request = inputMessage.getServletRequest();</span><br><span class="line">  <span class="comment">//获取客户端支持的响应媒体的类型</span></span><br><span class="line">  List&lt;MediaType&gt; acceptableTypes = getAcceptableMediaTypes(request);</span><br><span class="line">  <span class="comment">//获取响应返回值支持的媒体的类型</span></span><br><span class="line">  List&lt;MediaType&gt; producibleTypes = getProducibleMediaTypes(request, valueType, targetType);</span><br><span class="line"></span><br><span class="line">  List&lt;MediaType&gt; mediaTypesToUse = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  <span class="comment">//双重遍历两个媒体类型。找到能被客户端接收的返回值支持的媒体类型</span></span><br><span class="line">  <span class="keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;</span><br><span class="line">    <span class="keyword">for</span> (MediaType producibleType : producibleTypes) &#123;</span><br><span class="line">      <span class="keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;</span><br><span class="line">        mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (mediaTypesToUse.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> HttpMediaTypeNotAcceptableException(producibleTypes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">      logger.debug(<span class="string">&quot;No match for &quot;</span> + acceptableTypes + <span class="string">&quot;, supported: &quot;</span> + producibleTypes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>开启浏览器参数方式内容协商功能</strong></p>
<ul>
<li>为了方便内容协商，开启基于请求参数的内容协商功能。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启请求参数内容协商模式</span></span><br><span class="line"><span class="meta">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>请求样式为：<a target="_blank" rel="noopener" href="http://localhost:8080/test/person?format=json%E6%88%96http://localhost:8080/test/person?format=xml%E3%80%82">http://localhost:8080/test/person?format=json或http://localhost:8080/test/person?format=xml。</a></li>
<li>默认使用format来确定格式。</li>
<li>原理：<ul>
<li>在服务器获取客户端能接受的内容类型。</li>
<li><strong>contentNegotiationManager</strong> 内容协商管理器 。默认基于请求头策略。</li>
<li>此时会加上基于参数的协商功能。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="9-3-3-原理解析"><a href="#9-3-3-原理解析" class="headerlink" title="9.3.3 原理解析"></a>9.3.3 原理解析</h3><ul>
<li><p>在SpringBoot中对于参数的解析有参数解析器。对于返回的解析当然也有返回值解析器。</p>
</li>
<li><p>在HandlerMethodArgumentResolver的方法中有段代码是设置返回值解析器的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">  ServletWebRequest webRequest = <span class="keyword">new</span> ServletWebRequest(request, response);</span><br><span class="line"> 	</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">//设置所有的参数解析器</span></span><br><span class="line">      invocableMethod.setHandlerMethodArgumentResolvers(<span class="keyword">this</span>.argumentResolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers != <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">//设置所有的返回值解析器</span></span><br><span class="line">      invocableMethod.setHandlerMethodReturnValueHandlers(<span class="keyword">this</span>.returnValueHandlers);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>返回值解析器如下</p>
</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403085804.png"></p>
<ul>
<li><p>使用返回值处理器的代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (returnValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="comment">//返回值为空时</span></span><br><span class="line">  <span class="keyword">if</span> (isRequestNotModified(webRequest) || getResponseStatus() != <span class="keyword">null</span> || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">    disableContentCachingIfNecessary(webRequest);</span><br><span class="line">    mavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(getResponseStatusReason())) &#123;</span><br><span class="line">  <span class="comment">//返回值有错误信息时</span></span><br><span class="line">  mavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">//使用返回值处理器</span></span><br><span class="line">  <span class="keyword">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">    returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>内部使用原理如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取具体的返回值处理器。即从15个处理器中选择一个真正处理这个返回值的处理器</span></span><br><span class="line">HandlerMethodReturnValueHandler handler = selectHandler(returnValue, returnType);</span><br><span class="line"><span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用处理器的处理方法，解析返回值</span></span><br><span class="line">handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>返回值解析器的原理：</p>
<ul>
<li>返回值处理器判断是否支持这种类型返回值 supportsReturnType 方法</li>
<li>支持的话，返回值处理器调用 handleReturnValue方法 进行处理。</li>
</ul>
</li>
<li><p>以json返回为例：</p>
<ul>
<li>返回值标注了ResponseBody注解，所以返回值处理器为RequestResponseBodyMethodProcessor处理器。</li>
<li>handleReturnValue方法代码如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span></span><br><span class="line"><span class="function"><span class="params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException </span>&#123;</span><br><span class="line"></span><br><span class="line">  mavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">  ServletServerHttpRequest inputMessage = createInputMessage(webRequest);</span><br><span class="line">  ServletServerHttpResponse outputMessage = createOutputMessage(webRequest);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用消息转换器处理返回值数据</span></span><br><span class="line">  writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>利用 MessageConverters 进行处理 将数据写为json</p>
<ul>
<li>内容协商（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</li>
<li>服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，</li>
<li>SpringMVC会挨个遍历所有容器底层的 HttpMessageConverter ，看谁能处理？<ul>
<li>得到MappingJackson2HttpMessageConverter可以将对象写为json</li>
<li>利用MappingJackson2HttpMessageConverter将对象转为json再写出去。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="9-3-4-SpringMVC支持的返回值类型"><a href="#9-3-4-SpringMVC支持的返回值类型" class="headerlink" title="9.3.4 SpringMVC支持的返回值类型"></a>9.3.4 SpringMVC支持的返回值类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView</span><br><span class="line">Model</span><br><span class="line">View</span><br><span class="line">ResponseEntity </span><br><span class="line">ResponseBodyEmitter</span><br><span class="line">StreamingResponseBody</span><br><span class="line">HttpEntity</span><br><span class="line">HttpHeaders</span><br><span class="line">Callable</span><br><span class="line">DeferredResult</span><br><span class="line">ListenableFuture</span><br><span class="line">CompletionStage</span><br><span class="line">WebAsyncTask</span><br><span class="line">有 <span class="meta">@ModelAttribute</span> 且为对象类型的</span><br><span class="line"><span class="meta">@ResponseBody</span> 注解 ---&gt; RequestResponseBodyMethodProcessor处理器；</span><br></pre></td></tr></table></figure>

<h3 id="9-3-5-HttpMessageConverter消息转换器"><a href="#9-3-5-HttpMessageConverter消息转换器" class="headerlink" title="9.3.5 HttpMessageConverter消息转换器"></a>9.3.5 HttpMessageConverter消息转换器</h3><ul>
<li><p>作用：</p>
<ul>
<li>HttpMessageConverter: 看是否支持将 此 Class类型的对象，转为MediaType类型的数据。</li>
<li>例子：Person对象转为JSON。或者 JSON转为Person</li>
</ul>
</li>
<li><p>默认的MessageConverter</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403094002.png"></p>
</li>
<li><p>支持的类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> - 只支持Byte类型的</span><br><span class="line"><span class="number">1</span> - String</span><br><span class="line"><span class="number">2</span> - String</span><br><span class="line"><span class="number">3</span> - Resource</span><br><span class="line"><span class="number">4</span> - ResourceRegion</span><br><span class="line"><span class="number">5</span> - DOMSource.class \ SAXSource.class) \ StAXSource.class \StreamSource.class \Source.class</span><br><span class="line"><span class="number">6</span> - MultiValueMap</span><br><span class="line"><span class="number">7</span> - <span class="keyword">true</span> ,支持任何类型的</span><br><span class="line"><span class="number">8</span> - <span class="keyword">true</span> ，支持任何类型的</span><br><span class="line"><span class="number">9</span> - 支持注解方式xml处理的。</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-3-6-自定义消息转换器"><a href="#9-3-6-自定义消息转换器" class="headerlink" title="9.3.6 自定义消息转换器"></a>9.3.6 自定义消息转换器</h3><ul>
<li><p>功能：将person对象的数据转换成以；隔开的字符串。协议为application/x-guigu</p>
</li>
<li><p>第一步：在webconfig中重写extendMessageConverters。并添加自定义消息转换器</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//extendMessageConverters()方法表示在原有的基础上，另外扩展功能</span></span><br><span class="line">      converters.add(<span class="keyword">new</span> GuiguMessageConverter());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">      UrlPathHelper helper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">      helper.setRemoveSemicolonContent(<span class="keyword">false</span>);</span><br><span class="line">      configurer.setUrlPathHelper(helper);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：自定义消息转换器。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuiguMessageConverter</span> <span class="keyword">implements</span> <span class="title">HttpMessageConverter</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canRead</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//不支持读。即不支持将此类型的传输，转换成person</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canWrite</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">return</span> clazz.isAssignableFrom(Person.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 服务器通过调用此方法来统计服务器能支持的所有的媒体类型。</span></span><br><span class="line"><span class="comment">   * 我们自定义媒体类型为application/x-guigu</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;MediaType&gt; <span class="title">getSupportedMediaTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> MediaType.parseMediaTypes(<span class="string">&quot;application/x-guigu&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Person <span class="title">read</span><span class="params">(Class&lt;? extends Person&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Person person, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException </span>&#123;</span><br><span class="line">    <span class="comment">//自定义协议的数据格式</span></span><br><span class="line">    String data = person.getName() + <span class="string">&quot;;&quot;</span> + person.getAge() + <span class="string">&quot;;&quot;</span> + person.getBirth();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将其写入到输出流中</span></span><br><span class="line">    outputMessage.getBody().write(data.getBytes());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当我们开启浏览器请求参数内容协商匹配时。上述的配置就会不起作用。</p>
<ul>
<li>因为内容协商匹配策略默认是基于请求头的。</li>
</ul>
</li>
<li><p>解决方式：配置自定义内容协商匹配策略。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//配置自定义内容协商策略。此配置会完全覆盖原来的配置。</span></span><br><span class="line">      Map&lt;String, MediaType&gt; mediaTypeMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">      mediaTypeMap.put(<span class="string">&quot;json&quot;</span>, MediaType.APPLICATION_STREAM_JSON);</span><br><span class="line">      mediaTypeMap.put(<span class="string">&quot;xml&quot;</span>, MediaType.APPLICATION_ATOM_XML);</span><br><span class="line">      mediaTypeMap.put(<span class="string">&quot;gg&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/x-guigu&quot;</span>));</span><br><span class="line">      <span class="comment">//指定解析哪些参数对应的媒体类型。</span></span><br><span class="line">      ParameterContentNegotiationStrategy parameterStrategy = <span class="keyword">new</span> ParameterContentNegotiationStrategy(mediaTypeMap);</span><br><span class="line">      <span class="comment">//设置指定请求头的内容协商策略</span></span><br><span class="line">      HeaderContentNegotiationStrategy headStrategy = <span class="keyword">new</span> HeaderContentNegotiationStrategy();</span><br><span class="line"></span><br><span class="line">      configurer.strategies(Arrays.asList(parameterStrategy,headStrategy));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//扩展消息转换器</span></span><br><span class="line">      converters.add(<span class="keyword">new</span> GuiguMessageConverter());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="9-4-视图解析与模板引擎"><a href="#9-4-视图解析与模板引擎" class="headerlink" title="9.4 视图解析与模板引擎"></a>9.4 视图解析与模板引擎</h2><h3 id="9-4-1-视图解析"><a href="#9-4-1-视图解析" class="headerlink" title="9.4.1 视图解析"></a>9.4.1 视图解析</h3><p>视图解析：<strong>SpringBoot默认不支持 JSP，需要引入第三方模板引擎技术实现页面渲染。</strong></p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210403123215.jpg"></p>
<p><strong>视图解析流程</strong></p>
<ul>
<li>1.目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer 里面。包括数据和视图地址</strong></li>
<li>2.<strong>方法的参数是一个自定义类型对象（从请求参数中确定的），把他重新放在</strong> <strong>ModelAndViewContainer</strong> </li>
<li>3.任何目标方法执行完成以后都会返回 ModelAndView（<strong>数据和视图地址</strong>）。</li>
<li>4.<strong>processDispatchResult  处理派发结果（页面改如何响应）</strong><ul>
<li><strong>render</strong>(<strong>mv</strong>, request, response); 进行页面渲染逻辑</li>
<li>根据方法的String返回值得到 <strong>View</strong> 对象【定义了页面的渲染逻辑】<ul>
<li>1.所有的视图解析器尝试是否能根据当前返回值得到<strong>View</strong>对象</li>
<li>2.得到了  <strong>redirect:/main.html</strong> –&gt; Thymeleaf new <strong>RedirectView</strong>()</li>
<li>3.ContentNegotiationViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象。</li>
<li>4.view.render(mv.getModelInternal(), request, response);  视图对象调用自定义的render进行页面渲染工作<ul>
<li><strong>RedirectView 如何渲染【重定向到一个页面】</strong></li>
<li><strong>1、获取目标url地址</strong></li>
<li><strong>2、response.sendRedirect(encodedURL);</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>视图解析<ul>
<li><strong>返回值以 forward: 开始： new InternalResourceView(forwardUrl); –&gt;  转发request.getRequestDispatcher(path).forward(request, response);</strong></li>
<li><strong>返回值以</strong> <strong>redirect: 开始：</strong> <strong>new RedirectView() –》 render就是重定向</strong> </li>
<li><strong>返回值是普通字符串： new ThymeleafView（）—&gt;</strong> </li>
</ul>
</li>
</ul>
<h3 id="9-4-2-模板引擎"><a href="#9-4-2-模板引擎" class="headerlink" title="9.4.2 模板引擎"></a>9.4.2 模板引擎</h3><h4 id="1、thymeleaf简介"><a href="#1、thymeleaf简介" class="headerlink" title="1、thymeleaf简介"></a>1、thymeleaf简介</h4><p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text.</p>
<p><strong>现代化、服务端Java模板引擎</strong></p>
<h4 id="2、基本语法"><a href="#2、基本语法" class="headerlink" title="2、基本语法"></a>2、基本语法</h4><p><strong>1、表达式</strong></p>
<table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>变量取值</td>
<td>${…}</td>
<td>获取请求域、session域、对象等值</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{…}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{…}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{…}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{…}</td>
<td>jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody></table>
<p><strong>2、字面量</strong></p>
<p>文本值: <strong>‘one text’</strong> <strong>,</strong> <strong>‘Another one!’</strong> <strong>,…</strong>数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> <strong>,…</strong>布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p>
<p>空值: <strong>null</strong></p>
<p>变量： one，two，…. 变量不能有空格</p>
<p><strong>3、文本操作</strong></p>
<p>字符串拼接: <strong>+</strong></p>
<p>变量替换: <strong>|The name is ${name}|</strong> </p>
<p><strong>4、数学运算</strong></p>
<p>运算符: + , - , * , / , %</p>
<p><strong>5、布尔运算</strong></p>
<p>运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p>
<p>一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong> </p>
<p><strong>6、比较运算</strong></p>
<p>比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;** **,** **&gt;=</strong> <strong>,</strong> <strong>&lt;=</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> **)**等式: <strong>==</strong> <strong>,</strong> <strong>!=</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong> </p>
<p><strong>7、条件运算</strong></p>
<p>If-then: <strong>(if) ? (then)</strong></p>
<p>If-then-else: <strong>(if) ? (then) : (else)</strong></p>
<p>Default: (value) <strong>?: (defaultvalue)</strong> </p>
<p><strong>8、特殊操作</strong></p>
<p>无操作： _</p>
<h4 id="3、设置属性值-th-attr"><a href="#3、设置属性值-th-attr" class="headerlink" title="3、设置属性值-th:attr"></a>3、设置属性值-th:attr</h4><p>设置单个值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;subscribe.html&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;action=@&#123;/subscribe&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Subscribe!&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;value=#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置多个值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../images/gtvglogo.png&quot;</span>  <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上两个的代替写法 th:xxxx</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Subscribe!&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;subscribe.html&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/subscribe&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所有h5兼容的标签写法：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>
<h4 id="4、迭代"><a href="#4、迭代" class="headerlink" title="4、迭代"></a>4、迭代</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod : $&#123;prods&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod,iterStat : $&#123;prods&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;iterStat.odd&#125;? &#x27;odd&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5、条件运算"><a href="#5、条件运算" class="headerlink" title="5、条件运算"></a>5、条件运算</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;comments.html&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/product/comments(prodId=$&#123;prod.id&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(prod.comments)&#125;&quot;</span>&gt;</span>view<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>User is an administrator<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;</span>User is a manager<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>User is some other thing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="6、属性优先级"><a href="#6、属性优先级" class="headerlink" title="6、属性优先级"></a>6、属性优先级</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605498132699-4fae6085-a207-456c-89fa-e571ff1663da.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_14,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10"></p>
<h3 id="9-4-3-Thymeleaf的使用"><a href="#9-4-3-Thymeleaf的使用" class="headerlink" title="9.4.3 Thymeleaf的使用"></a>9.4.3 Thymeleaf的使用</h3><p><strong>1.引入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.配置</strong></p>
<p>SpringBoot会为我们自动配置好thymeleaf。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; TemplateMode.class, SpringTemplateEngine.class &#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>所有的thymeleaf的配置值都在 ThymeleafProperties</li>
<li>配置好了 <strong>SpringTemplateEngine</strong> 引擎</li>
<li><strong>配好了</strong> <strong>ThymeleafViewResolver</strong> 视图解析器</li>
<li>而我们只需要直接开发页面</li>
<li>在 ThymeleafProperties中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认视图跳转的前缀</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line"><span class="comment">//默认跳转的后缀</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">&quot;.html&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>3.页面开发</strong></p>
<ul>
<li><p>首先在templates文件下创建一个index.html页面</p>
</li>
<li><p>然后再页面上引入templates的名称空间。这样在编写页面时就会有提示。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--第一步加入thymeleaf的名称空间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;*&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;link&#125;&quot;</span>&gt;</span>去百度1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--@取出的是&#123;&#125;中的路径。例如a标签的实际访问路径为相对路径。即：http://localhost:8080/link--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;*&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;link&#125;&quot;</span>&gt;</span>去百度2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当a标签的实际访问路径为绝对路径时，此路径的访问为：http://localhost:8080/项目访问路径/link--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;*&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/link&#125;&quot;</span>&gt;</span>去百度2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在controller层创建一个页面跳转的处理方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toIndex</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;你好&quot;</span>);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;link&quot;</span>, <span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//此处的返回值再加上thymeleaf的前缀和后缀拼接后才是真正的页面位置。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-4-4-构建后台管理系统"><a href="#9-4-4-构建后台管理系统" class="headerlink" title="9.4.4 构建后台管理系统"></a>9.4.4 构建后台管理系统</h3><p><strong>1.项目创建</strong></p>
<p>引入依赖：thymeleaf、web-starter、devtools、lombok</p>
<p><strong>2.静态资源处理</strong></p>
<p>自动配置好，我们只需要把所有静态资源放到 static 文件夹下</p>
<p><strong>3.路径构建</strong></p>
<p>th:action=”@{/login}”</p>
<p><strong>4.模板抽取</strong></p>
<p>th:insert：插入</p>
<p>th:replace：替换</p>
<p>th:include：包含</p>
<ul>
<li>公共页面</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">th:fragment</span>=<span class="string">&quot;commonHead&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span>  <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/css/style.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span>  <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/css/style-responsive.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">&lt;script  th:src=&quot;@&#123;/js/html5shiv.js&#125;&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">&lt;script  th:src=&quot;@&#123;/js/respond.min.js&#125;&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">&lt;![endif]--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用模板</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!--格式：&quot;模板的文件名 :: 模板的fragment名&quot;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;common :: commonHead&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>5.页面跳转</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">main</span><span class="params">(User user, HttpSession session, Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(StringUtils.hasLength(user.getUserName()) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(user.getPassword()))&#123;</span><br><span class="line">    <span class="comment">//把登陆成功的用户保存起来</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;loginUser&quot;</span>,user);</span><br><span class="line">    <span class="comment">//登录成功重定向到main.html;  重定向防止表单重复提交</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/main.html&quot;</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;账号密码错误&quot;</span>);</span><br><span class="line">    <span class="comment">//回到登录页面</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6.数据渲染</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/dynamic_table&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">dynamic_table</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">  <span class="comment">//表格内容的遍历</span></span><br><span class="line">  List&lt;User&gt; users = Arrays.asList(<span class="keyword">new</span> User(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;123456&quot;</span>),</span><br><span class="line">                                   <span class="keyword">new</span> User(<span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;123444&quot;</span>),</span><br><span class="line">                                   <span class="keyword">new</span> User(<span class="string">&quot;haha&quot;</span>, <span class="string">&quot;aaaaa&quot;</span>),</span><br><span class="line">                                   <span class="keyword">new</span> User(<span class="string">&quot;hehe &quot;</span>, <span class="string">&quot;aaddd&quot;</span>));</span><br><span class="line">  model.addAttribute(<span class="string">&quot;users&quot;</span>,users);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;table/dynamic_table&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;display table table-bordered&quot;</span> <span class="attr">id</span>=<span class="string">&quot;hidden-table-info&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;gradeX&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;user,stats:$&#123;users&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;stats.count&#125;&quot;</span>&gt;</span>Trident<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.userName&#125;&quot;</span>&gt;</span>Internet<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> &gt;</span>[[$&#123;user.password&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="8-5-拦截器"><a href="#8-5-拦截器" class="headerlink" title="8.5 拦截器"></a>8.5 拦截器</h2><h3 id="8-5-1-拦截器的使用"><a href="#8-5-1-拦截器的使用" class="headerlink" title="8.5.1 拦截器的使用"></a>8.5.1 拦截器的使用</h3><ul>
<li><p>我们可以使用Servlet的拦截器功能。也能使用SpringBoot提供的拦截器功能。</p>
</li>
<li><p>SpringBoot提供的拦截器功能需要实现接口。</p>
</li>
<li><p>接口中有三个方法：</p>
<ul>
<li>preHandle()：处理器执行方法前</li>
<li>postHandle()：处理器执行方法后，渲染视图前</li>
<li>afterCompletion()：渲染视图后</li>
</ul>
</li>
<li><p>样例：实现是否登录的检测</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登陆检查</span></span><br><span class="line"><span class="comment"> * 1.配置好拦截器要拦截那些请求。</span></span><br><span class="line"><span class="comment"> * 2.把配置放到容器中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 处理器方法执行前</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">    Object loginUser = session.getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != loginUser)&#123;</span><br><span class="line">      <span class="comment">//表示已经登陆，拦截器放行</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//未登录，不放行，跳转到登陆页面</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;请先登录&quot;</span>);</span><br><span class="line">    request.getRequestDispatcher(<span class="string">&quot;/&quot;</span>).forward(request,response);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 处理器方法执行后，视图渲染前</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 视图渲染后</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>拦截器的使用步骤：</p>
<ul>
<li>创建拦截器</li>
<li>注册拦截器：<ul>
<li>设置拦截器需要拦截的请求路径。</li>
<li>设置拦截器不需要拦截的请求路径.</li>
</ul>
</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加拦截器</span></span><br><span class="line"><span class="comment">     * 设置拦截路径。 /**表示拦截所有请求。包括静态资源</span></span><br><span class="line"><span class="comment">     * 设置不拦截的路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> LoginInterceptor())</span><br><span class="line">      .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">      .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/*&quot;</span>,<span class="string">&quot;/fonts/*&quot;</span>,<span class="string">&quot;/images/*&quot;</span>,<span class="string">&quot;/js/*&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-5-2-对静态资源的处理"><a href="#8-5-2-对静态资源的处理" class="headerlink" title="8.5.2 对静态资源的处理"></a>8.5.2 对静态资源的处理</h3><p><strong>方式一：</strong></p>
<ul>
<li>再配置不拦截的请求上，将所有的对静态资源的请求放行。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/*&quot;</span>,<span class="string">&quot;/fonts/*&quot;</span>,<span class="string">&quot;/images/*&quot;</span>,<span class="string">&quot;/js/*&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>方式二：</strong></p>
<ul>
<li>修改对静态资源的访问路径。比如加个前缀。然后再将所有对此前缀的访问放行。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mvc.static-path-pattern</span>=<span class="string">/static/**</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/static/**&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="5-5-3-原理解析"><a href="#5-5-3-原理解析" class="headerlink" title="5.5.3 原理解析"></a>5.5.3 原理解析</h3><ul>
<li>1、根据当前请求，找到<strong>HandlerExecutionChain【</strong>可以处理请求的handler以及handler的所有 拦截器】</li>
<li>2、先来<strong>顺序执行</strong> 所有拦截器的 preHandle方法<ul>
<li>1、如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</li>
<li>2、如果当前拦截器返回为false。直接   倒序执行所有已经执行了的拦截器的  afterCompletion；</li>
</ul>
</li>
<li><strong>3、如果任何一个拦截器返回false。直接跳出不执行目标方法</strong></li>
<li>4、所有拦截器都返回True。执行目标方法。</li>
<li>5、倒序执行所有拦截器的postHandle方法。</li>
<li><strong>6、前面的步骤有任何异常都会直接倒序触发已执行的</strong> afterCompletion</li>
<li>7、页面成功渲染完成以后，也会倒序触发 afterCompletion</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1605765121071-64cfc649-4892-49a3-ac08-88b52fb4286f.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10/resize,w_1212"></p>
<h2 id="9-6-文件上传"><a href="#9-6-文件上传" class="headerlink" title="9.6 文件上传"></a>9.6 文件上传</h2><h3 id="9-6-1-页面表单"><a href="#9-6-1-页面表单" class="headerlink" title="9.6.1 页面表单"></a>9.6.1 页面表单</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--表单的格式必需是：method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">&quot;form&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/upload&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputEmail1&quot;</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;exampleInputEmail1&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter email&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;</span>单个文件<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;oneFile&quot;</span> <span class="attr">id</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;help-block&quot;</span>&gt;</span>Example block-level help text here.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;</span>多个文件<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--multiple：表示可以上传多个文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;duoFile&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;help-block&quot;</span>&gt;</span>Example block-level help text here.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="9-6-2-文件上传代码及配置"><a href="#9-6-2-文件上传代码及配置" class="headerlink" title="9.6.2 文件上传代码及配置"></a>9.6.2 文件上传代码及配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * MultipartFile：用于接收文件。只能接受一个文件。如果同时上传多个文件。则用数组模式</span></span><br><span class="line"><span class="comment">  * 请求的注解为RequestPart。意为请求部分</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;email&quot;)</span> String email,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="meta">@RequestPart(&quot;oneFile&quot;)</span> MultipartFile oneFile,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="meta">@RequestPart(&quot;duoFile&quot;)</span> MultipartFile[] duoFile)</span></span>&#123;</span><br><span class="line">  log.info(<span class="string">&quot;email=&#123;&#125;,oneFile=&#123;&#125;,duoFile=&#123;&#125;&quot;</span>,email,oneFile.getSize(),duoFile.length);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置上传文件的单个文件最大大小.单位MB</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-file-size</span>=<span class="string">10</span></span><br><span class="line"><span class="comment"># 设置一个请求最大上传多大的文件。单位MB</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-request-size</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure>

<h3 id="9-6-3-原理"><a href="#9-6-3-原理" class="headerlink" title="9.6.3 原理"></a>9.6.3 原理</h3><ul>
<li>**文件上传自动配置类-MultipartAutoConfiguration-**MultipartProperties</li>
<li>自动配置好了 <strong>StandardServletMultipartResolver  【文件上传解析器】</strong></li>
<li><strong>原理步骤</strong></li>
</ul>
<ul>
<li><ul>
<li><strong>1、请求进来使用文件上传解析器判断（</strong>isMultipart<strong>）并封装（</strong>resolveMultipart，<strong>返回</strong>MultipartHttpServletRequest<strong>）文件上传请求</strong></li>
<li><strong>2、参数解析器来解析请求中的文件内容封装成MultipartFile</strong></li>
<li><strong>3、将request中文件信息封装为一个Map；</strong>MultiValueMap&lt;String, MultipartFile&gt;</li>
</ul>
</li>
</ul>
<p><strong>FileCopyUtils</strong>。实现文件流的拷贝</p>
<h2 id="9-7-异常处理（缺失）"><a href="#9-7-异常处理（缺失）" class="headerlink" title="9.7 异常处理（缺失）"></a>9.7 异常处理（缺失）</h2><h3 id="9-7-1-默认规则"><a href="#9-7-1-默认规则" class="headerlink" title="9.7.1 默认规则"></a>9.7.1 默认规则</h3><ul>
<li>默认情况下，Spring Boot提供<code>/error</code>处理所有错误的映射。即发生错误时，它会默认发出/error请求。</li>
<li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。</li>
<li>对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据。</li>
<li><strong>要对其进行自定义，添加</strong><code>View</code><strong>解析为<code>error</code></strong></li>
<li>要完全替换默认行为，可以实现 <code>ErrorController </code>并注册该类型的Bean定义，或添加<code>ErrorAttributes类型的组件</code>以使用现有机制但替换其内容。</li>
<li>SpringBoot会自动解析静态资源下的error下的4xx，5xx页面作为错误页面；<ul>
<li>或者templates下的error下的4xx，5xx页面。</li>
</ul>
</li>
<li>4xx用来表示发生以4开头的错误代码的信息。5xx用来表示错误代码以5开头的错误页面</li>
</ul>
<h3 id="9-7-2-自定义错误页面实现逻辑"><a href="#9-7-2-自定义错误页面实现逻辑" class="headerlink" title="9.7.2 自定义错误页面实现逻辑"></a>9.7.2 自定义错误页面实现逻辑</h3><ul>
<li>自定义错误页<ul>
<li>error/404.html  error/5xx.html；</li>
<li>有精确的错误状态码页面就匹配精确，没有就找 4xx.html；</li>
<li>如果都没有就触发默认的错误白页。</li>
</ul>
</li>
<li></li>
</ul>
<h3 id="9-7-3-异常处理原理"><a href="#9-7-3-异常处理原理" class="headerlink" title="9.7.3 异常处理原理"></a>9.7.3 异常处理原理</h3><ul>
<li><strong>ErrorMvcAutoConfiguration  自动配置异常处理规则</strong></li>
</ul>
<ul>
<li><ul>
<li><strong>容器中的组件：类型：DefaultErrorAttributes -&gt;</strong> <strong>id：errorAttributes</strong></li>
<li></li>
</ul>
</li>
</ul>
<h3 id="9-7-4-异常处理流程"><a href="#9-7-4-异常处理流程" class="headerlink" title="9.7.4 异常处理流程"></a>9.7.4 异常处理流程</h3><h2 id="9-8-Web原生组件注入"><a href="#9-8-Web原生组件注入" class="headerlink" title="9.8 Web原生组件注入"></a>9.8 Web原生组件注入</h2><h3 id="9-8-1-使用原生的Servlet-API"><a href="#9-8-1-使用原生的Servlet-API" class="headerlink" title="9.8.1 使用原生的Servlet API"></a>9.8.1 使用原生的Servlet API</h3><ul>
<li><p>对于三大组件，在创建类时，在类上分别标注对应的注解</p>
<ul>
<li>@WebServlet(urlPatterns = <strong>“/my”</strong>)：效果：直接响应，<strong>没有经过Spring的拦截器？</strong></li>
<li>@WebFilter(urlPatterns={<strong>“/css/*“</strong>,<strong>“/images/*“</strong>})</li>
<li>@WebListener</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/ms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/ms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>同时：需要在SpringBoot配置上加上扫描注解</p>
<ul>
<li>@ServletComponentScan(basePackages = <strong>“com.atguigu.admin”</strong>) :指定原生Servlet组件都放在那里</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ServletComponentScan(basePackages = &quot;com.lc.servlet&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAdminApplication</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(SpringbootAdminApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>原生Servlet直接响应，不经过拦截器Interceptors的原因：</p>
<ul>
<li>首先，拦截器的作用在Servlet后面。</li>
<li>然后，Spring的默认Servlet是DispatcherServlet 。它的默认匹配路径是“/”。</li>
<li>原生的Servlet。我们设置的匹配路径是“/my”。</li>
<li>又根据Tomcat的精确匹配原则。当我们访问/my时。它会被匹配到原生的Servlet上，然后执行。</li>
<li>只有当我们的请求被匹配到DispatcherServlet 时，才会被拦截器拦截。因为拦截器是spring的。</li>
</ul>
</li>
</ul>
<h3 id="9-8-2-使用Spring的RegistrantionBean"><a href="#9-8-2-使用Spring的RegistrantionBean" class="headerlink" title="9.8.2 使用Spring的RegistrantionBean"></a>9.8.2 使用Spring的RegistrantionBean</h3><ul>
<li>使用Spring的容器：ServletRegistrationBean, FilterRegistrationBean,ServletListenerRegistrationBean</li>
<li>将要注册的三大组件通过bean注解的方式加入到容器中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRegisterConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">myServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> MyServlet(), <span class="string">&quot;/my&quot;</span>,<span class="string">&quot;/ms&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">myFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    MyFilter myFilter = <span class="keyword">new</span> MyFilter();</span><br><span class="line">    <span class="comment">//方式一：以servlet为过滤路径</span></span><br><span class="line">    <span class="comment">//return new FilterRegistrationBean(myFilter,myServlet());</span></span><br><span class="line">    <span class="comment">//方式二：</span></span><br><span class="line">    FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean(myFilter);</span><br><span class="line">    filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/my&quot;</span>,<span class="string">&quot;/ms&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title">myListener</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServletListenerRegistrationBean(<span class="keyword">new</span> MyServletContextListener());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：在上面注解配置中没有设置proxyBeanMethods属性。<ul>
<li>不设置，即默认为true。保证组件在容器中的唯一性。</li>
</ul>
</li>
</ul>
<h2 id="9-9-嵌入式Servlet容器"><a href="#9-9-嵌入式Servlet容器" class="headerlink" title="9.9 嵌入式Servlet容器"></a>9.9 嵌入式Servlet容器</h2><ul>
<li><p>首先需要明白：SpringBoot内置了三个web服务器(Tomcat,Jetty,Undertow)。</p>
</li>
<li><p>SpringBoot启动时，对于web服务器的管理使用了一个容器<code>ServletWebServerApplicationContext</code>。</p>
<ul>
<li>当启动web项目时。会从此容器中寻找web服务器工厂(<code>ServletWebServerFactory</code>)。</li>
<li>SpringBoot内置了很多的服务器工厂：<code>TomcatServletWebServerFactory</code>, <code>JettyServletWebServerFactory</code>, or <code>UndertowServletWebServerFactory</code></li>
</ul>
</li>
<li><p>关于web服务器的自动配置在<code>ServletWebServerFactoryAutoConfiguration</code>类中。</p>
</li>
<li><p>此类在其作用前会先导入<code>ServletWebServerFactoryConfiguration</code>类。即服务器工厂配置类</p>
<ul>
<li>服务器工厂配置类会根据项目导入的包动态的判断要导入哪个服务器。</li>
<li>SpringBoot的web应用默认导入的是Tomcat包。因此服务器工厂配置类会导入Tomcat服务器。</li>
<li>因此导入：<code>TomcatServletWebServerFactory</code>Tomcat服务器工厂。</li>
<li>Tomcat服务器工厂有个<code>getWebServer</code>方法，此方法用于创建服务器并启动服务器。</li>
</ul>
</li>
<li><p>总之：默认支持的web服务器有：</p>
</li>
<li><p><code>ServletWebServerApplicationContext</code>会寻找已经加入到项目中的<code>ServletWebServerFactory</code> 并引导创建对应的服务器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ServletWebServerFactory <span class="title">getWebServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 获取项目中的所有web服务器</span></span><br><span class="line">  String[] beanNames = getBeanFactory().getBeanNamesForType(ServletWebServerFactory.class);</span><br><span class="line">  <span class="comment">//如果没有服务器就报异常</span></span><br><span class="line">  <span class="keyword">if</span> (beanNames.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Unable to start ServletWebServerApplicationContext due to missing &quot;</span></span><br><span class="line">                                          + <span class="string">&quot;ServletWebServerFactory bean.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//如果服务器过多，也报异常</span></span><br><span class="line">  <span class="keyword">if</span> (beanNames.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Unable to start ServletWebServerApplicationContext due to multiple &quot;</span></span><br><span class="line">                                          + <span class="string">&quot;ServletWebServerFactory beans : &quot;</span> + StringUtils.arrayToCommaDelimitedString(beanNames));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//ServletWebServerFactory类通过调用getWebServer()方法创建服务器并启动服务器</span></span><br><span class="line">  <span class="keyword">return</span> getBeanFactory().getBean(beanNames[<span class="number">0</span>], ServletWebServerFactory.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-9-1-应用：如何切换服务器"><a href="#9-9-1-应用：如何切换服务器" class="headerlink" title="9.9.1 应用：如何切换服务器"></a>9.9.1 应用：如何切换服务器</h3><ul>
<li>由于web服务器的导入是通过maven依赖引入的。</li>
<li>因此：我们只需要在maven的SpringBoot场景中排除Tomcat，加入其他服务器即可。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--排除Tomcat服务器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用undertow服务器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="9-9-2-修改web服务器配置"><a href="#9-9-2-修改web服务器配置" class="headerlink" title="9.9.2 修改web服务器配置"></a>9.9.2 修改web服务器配置</h3><ul>
<li><p>方式一：通过配置文件。</p>
<ul>
<li>由于<code>ServletWebServerFactoryAutoConfiguration</code>自动配置类绑定的web服务器的属性配置为<code>ServerProperties</code>类。此类绑定了以server开头的属性配置。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置服务器的访问端口号</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8088</span></span><br></pre></td></tr></table></figure></li>
<li><p>方式二：实现<code>ConfigurableServletWebServerFactory</code>接口。此接口继承于<code>ServletWebServerFactory</code>接口。</p>
<ul>
<li>因为<code>ServletWebServerApplicationContext</code>是通过<code>ServletWebServerFactory</code>来创建web服务器的。</li>
<li>并且<code>ConfigurableServletWebServerFactory</code>接口比<code>ServletWebServerFactory</code>接口多很多方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改web服务器的配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableServletWebServerFactory <span class="title">webServerFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">  TomcatServletWebServerFactory factory = <span class="keyword">new</span> TomcatServletWebServerFactory();</span><br><span class="line">  factory.setPort(<span class="number">8088</span>);</span><br><span class="line">  factory.addErrorPages(<span class="keyword">new</span> ErrorPage(HttpStatus.NOT_FOUND,<span class="string">&quot;/notfound.html&quot;</span>));</span><br><span class="line">  <span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方式三：实现  WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; 定制化器</p>
<ul>
<li>定制化器的作用：当容器中准备好web服务器后，定制化器将配置文件的信息和对应的工厂进行绑定。</li>
<li>例如：将配置文件的值和<code>ServletWebServerFactory</code> 进行绑定</li>
<li>在<code>ServletWebServerFactoryAutoConfiguration</code>中第一个方法就是<code>servletWebServerFactoryCustomizer</code>方法。用来设定定制化器。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomizationBean</span> <span class="keyword">implements</span> <span class="title">WebServerFactoryCustomizer</span>&lt;<span class="title">ConfigurableServletWebServerFactory</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableServletWebServerFactory server)</span> </span>&#123;</span><br><span class="line">    server.setPort(<span class="number">9000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="9-10-定制化原理"><a href="#9-10-定制化原理" class="headerlink" title="9.10 定制化原理"></a>9.10 定制化原理</h2><ul>
<li><p>定制化：即我们要修改SpringBoot默认的配置。</p>
</li>
<li><p>首先：通过前面的学习。我们了解到SpringBoot的配置都是一个逻辑。即：</p>
<ul>
<li>1.通过依赖引入资源场景starter.</li>
<li>2.通过xxxAutoConfiguration自动配置类，进行配置。</li>
<li>3.在自动配置类中通过Bean注解的方式导入此配置的相关组件。</li>
<li>4.在自动配置类中绑定对应的xxxProperties类。</li>
<li>5.进而绑定配置文件中对应的属性。</li>
</ul>
</li>
<li><p>因此我们想要修改配置的方式如下：</p>
<ul>
<li>1：修改配置文件</li>
<li>2：编写自定义的xxxCustomizer定制化器</li>
<li>3：编写自定义的配置类xxxConfiguration。将其放到容器中。或者使用@Bean注解替换默认组件。</li>
<li>4：编写一个实现WebMvcConfiguration的配置类，并加上@Configuration注解。此类就是web的配置类。再通过加@Bean注解添加组件。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>5：在4的基础上给配置类添加@EnableWebMvc注解。表示全面接管web的配置。所有的默认配置都将不起作用。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>@EnableWebMvc注解的原理</p>
<ul>
<li><p>此注解在起作用时会导入<code>DelegatingWebMvcConfiguration</code>类。</p>
</li>
<li><p>此类会将项目中所有的WebMvcConfigurer接口的实现类都获取到，然后让其生效。</p>
</li>
<li><p>此类也会提供一些SpringBoot的一些非常底层的基本的配置组件。用于保证项目的正常启动。</p>
</li>
<li><p>从另一方面说：SpringBoot关于webmvc的配置都在<code>WebMvcAutoConfiguration</code>类中。而此类起作用的一个条件是容器中没有<code>WebMvcConfigurationSupport</code>类。</p>
<ul>
<li>而<code>DelegatingWebMvcConfiguration</code>就是继承于<code>WebMvcConfigurationSupport</code>的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当不存在WebMvcConfigurationSupport时，此类生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>因此当存在@EnableWebMvc时，容器中会存在<code>DelegatingWebMvcConfiguration</code>，进而<code>WebMvcAutoConfiguration</code>不能起作用。</p>
</li>
</ul>
</li>
</ul>
<h1 id="第十章：数据访问"><a href="#第十章：数据访问" class="headerlink" title="第十章：数据访问"></a>第十章：数据访问</h1><h2 id="10-1-SQL"><a href="#10-1-SQL" class="headerlink" title="10.1 SQL"></a>10.1 SQL</h2><h3 id="10-1-1-数据的配置"><a href="#10-1-1-数据的配置" class="headerlink" title="10.1.1 数据的配置"></a>10.1.1 数据的配置</h3><ul>
<li>导入数据源和数据库驱动</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入数据源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--导入数据库驱动。注意版本要和自己的mysql相一致--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>默认数据源的依赖图</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1354552/1606366100317-5e0199fa-6709-4d32-bce3-bb262e2e5e6a.png?x-oss-process=image/watermark,type_d3F5LW1pY3JvaGVp,size_10,text_YXRndWlndS5jb20g5bCa56GF6LC3,color_FFFFFF,shadow_50,t_80,g_se,x_10,y_10"></p>
</li>
</ul>
<p><strong>数据源的自动配置</strong></p>
<ul>
<li><p>DataSourceAutoConfiguration 数据源自动配置类</p>
</li>
<li><p>DataSourceTransactionManagerAutoConfiguration： 事务管理器的自动配置</p>
</li>
<li><p>JdbcTemplateAutoConfiguration： <strong>JdbcTemplate的自动配置，可以来对数据库进行crud</strong></p>
</li>
<li><p>JndiDataSourceAutoConfiguration： jndi的自动配置</p>
</li>
<li><p>XADataSourceAutoConfiguration： 分布式事务相关的自动配置</p>
</li>
<li><p>DataSourceAutoConfiguration ：</p>
<ul>
<li>使用绑定spring.datasource属性的配置。</li>
<li>当不指定具体的数据源时，默认配置<strong>HikariDataSource</strong>连接池</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Conditional(PooledDataSourceCondition.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span></span><br><span class="line"><span class="meta">         DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span></span><br><span class="line"><span class="meta">         DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PooledDataSourceConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>JdbcTemplateAutoConfiguration：</p>
<ul>
<li>绑定配置属性spring.jdbc</li>
<li>此配置会往容器中添加JdbcTemplate组件，因此我们可以通过自动注入的方式使用它。</li>
</ul>
</li>
</ul>
<p><strong>修改配置项</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.name</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mysql</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p><strong>使用第三方数据源的方式</strong></p>
<ul>
<li>方式一：导入第三方依赖，配置数据源，往容器中添加数据源Bean.</li>
<li>方式二：找SpringBoot有没有第三方数据源的场景依赖。</li>
</ul>
<h3 id="10-1-2-使用Druid数据源"><a href="#10-1-2-使用Druid数据源" class="headerlink" title="10.1.2 使用Druid数据源"></a>10.1.2 使用Druid数据源</h3><ul>
<li>官方地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></li>
</ul>
<p><strong>方式一：自定义数据源</strong></p>
<ul>
<li><p>基本使用</p>
<ul>
<li>引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>添加数据源Bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSourceConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过bean注解往容器中放入Druid数据源。</span></span><br><span class="line"><span class="comment">   * 通过ConfigurationProperties注解绑定spring.datasource前缀的属性。并将数据绑定到datasource中</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">    DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    <span class="comment">//这里通过配置文件绑定属性，更能解开耦合性</span></span><br><span class="line">    <span class="comment">//dataSource.setUrl();</span></span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>绑定的基本配置</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring-jdbc</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">  log.info(dataSource.getClass().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>StatViewServlet的使用(具体使用见官网)</p>
<ul>
<li><p>作用：</p>
<ul>
<li>提供监控信息展示的html页面</li>
<li>提供监控信息的JSON API</li>
</ul>
</li>
<li><p>使用方式</p>
<ul>
<li>官方如下所示</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DruidStatView<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.alibaba.druid.support.http.StatViewServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DruidStatView<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/druid/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>实质上是往容器中放入了一个servletBean，因此我们这样使用（注意此时项目要导入web场景的支持）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">  StatViewServlet statViewServlet = <span class="keyword">new</span> StatViewServlet();</span><br><span class="line">  ServletRegistrationBean&lt;StatViewServlet&gt; servletRegistrationBean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(statViewServlet, <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时启动项目访问<a target="_blank" rel="noopener" href="http://localhost:8080/druid/index.html%E3%80%82%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E7%95%8C%E9%9D%A2">http://localhost:8080/druid/index.html。就可以看到如下界面</a></li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210410145724.png"></p>
</li>
</ul>
</li>
<li><p>StatFilter的使用</p>
<ul>
<li>作用：开启监控功能，将监控的数据显示在监控的页面上。</li>
<li>在上述的监控页面开启后，我们还需要配置这个StatFilter，用于将监控的信息显示在监控页面上。</li>
<li>使用方式：在数据源的配置上将某个属性的置设为StatFilterBean的名称。</li>
<li>官网方式：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">需要给数据源中配置如下属性；可以允许多个filter，多个用，分割；如：</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;filters&quot;</span> <span class="attr">value</span>=<span class="string">&quot;stat,slf4j&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>springboot方式：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">  <span class="comment">//开启监控功能。可以开启多个监控</span></span><br><span class="line">  dataSource.setFilters(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>WebStatFilter的使用</p>
<ul>
<li>作用：开启web应用中对请求的监控功能</li>
<li>官方配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>DruidWebStatFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.alibaba.druid.support.http.WebStatFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>exclusions<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>DruidWebStatFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>springboot配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">druidWebStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">  WebStatFilter webStatFilter = <span class="keyword">new</span> WebStatFilter();</span><br><span class="line">  FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">  <span class="comment">//设置过滤的请求路径</span></span><br><span class="line">  filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">  <span class="comment">//设置要排除的请求</span></span><br><span class="line">  Map&lt;String,String&gt; initParam = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  initParam.put(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">  filterRegistrationBean.setInitParameters(initParam);</span><br><span class="line">  <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>* </p>
</li>
<li><p>系统中所有的Filter</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>别名</th>
<th>Filter类名</th>
</tr>
</thead>
<tbody><tr>
<td>default</td>
<td>com.alibaba.druid.filter.stat.StatFilter</td>
</tr>
<tr>
<td>stat</td>
<td>com.alibaba.druid.filter.stat.StatFilter</td>
</tr>
<tr>
<td>mergeStat</td>
<td>com.alibaba.druid.filter.stat.MergeStatFilter</td>
</tr>
<tr>
<td>encoding</td>
<td>com.alibaba.druid.filter.encoding.EncodingConvertFilter</td>
</tr>
<tr>
<td>log4j</td>
<td>com.alibaba.druid.filter.logging.Log4jFilter</td>
</tr>
<tr>
<td>log4j2</td>
<td>com.alibaba.druid.filter.logging.Log4j2Filter</td>
</tr>
<tr>
<td>slf4j</td>
<td>com.alibaba.druid.filter.logging.Slf4jLogFilter</td>
</tr>
<tr>
<td>commonlogging</td>
<td>com.alibaba.druid.filter.logging.CommonsLogFilter</td>
</tr>
</tbody></table>
<ul>
<li>慢SQL记录设置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stat-filter&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.filter.stat.StatFilter&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;slowSqlMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;logSlowSql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">使用 slowSqlMillis 定义慢SQL的时长</span><br></pre></td></tr></table></figure>

<p><strong>方式二：导入场景</strong></p>
<ul>
<li><p>引入场景依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>对应的自动配置类为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DruidStatProperties.class, DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DruidSpringAopConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidStatViewServletConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidWebStatFilterConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidFilterConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidDataSourceAutoConfigure</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>DruidStatProperties</code> 对应的配置属性为spring.datasource.druid</p>
</li>
<li><p><code>DataSourceProperties</code>对应的配置属性为spring.datasource</p>
</li>
<li><p><code>DruidSpringAopConfiguration</code> 用于监控SpringBean的。对应的配置属性为spring.datasource.druid.aop-patterns</p>
</li>
<li><p><code>DruidStatViewServletConfiguration</code>用于监控页的配置。对应的配置属性为spring.datasource.druid.stat-view-servlet</p>
</li>
<li><p><code>DruidWebStatFilterConfiguration</code>用于web监控的配置。对应的配置属性为spring.datasource.druid.web-stat-filter</p>
</li>
<li><p><code>DruidFilterConfiguration</code>用于所有Druid子弟的Filter的配置。</p>
<ul>
<li>其中的Filter配置对应的属性如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_STAT_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.stat&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_CONFIG_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.config&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_ENCODING_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.encoding&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_SLF4J_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.slf4j&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_LOG4J_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.log4j&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_LOG4J2_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.log4j2&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_COMMONS_LOG_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.commons-log&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_WALL_PREFIX = <span class="string">&quot;spring.datasource.druid.filter.wall&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_WALL_CONFIG_PREFIX = FILTER_WALL_PREFIX + <span class="string">&quot;.config&quot;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置示例演示：</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启对com.lc包下的所有Bean的监控</span></span><br><span class="line"><span class="meta">spring.datasource.druid.aop-patterns</span>=<span class="string">com.lc.*</span></span><br><span class="line"><span class="comment"># 开启sql监控和防火墙监控</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filters</span>=<span class="string">stat,wall</span></span><br><span class="line"><span class="comment"># 配置监控功能(开启监控页功能，设置登陆账号和密码，禁用重置按钮)</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.login-username</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.login-password</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.reset-enable</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 配置web监控(开启web监控功能，设置监控的路径匹配，排除不监控的路径匹配)</span></span><br><span class="line"><span class="meta">spring.datasource.druid.web-stat-filter.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.druid.web-stat-filter.url-pattern</span>=<span class="string">/*</span></span><br><span class="line"><span class="meta">spring.datasource.druid.web-stat-filter.exclusions</span>=<span class="string">*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*</span></span><br><span class="line"><span class="comment"># 对sql监控的详细配置(开启sql监控功能，开启慢SQL的日志功能，设置慢SQL的限制时间)</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filter.stat.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filter.stat.log-slow-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filter.stat.slow-sql-millis</span>=<span class="string">1000</span></span><br><span class="line"><span class="comment"># 对防火墙的详细配置(开启防火墙监控功能，允许删除表)</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filter.wall.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.druid.filter.wall.config.drop-table-allow</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>官方配置示例：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></li>
</ul>
<h3 id="10-1-3-使用MyBatisca操作"><a href="#10-1-3-使用MyBatisca操作" class="headerlink" title="10.1.3 使用MyBatisca操作"></a>10.1.3 使用MyBatisca操作</h3><ul>
<li><p>首先导入Mybatis的场景依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>自动配置文件如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span> <span class="comment">//当容器中只存在一个数据源时起作用</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MybatisProperties.class)</span> <span class="comment">//绑定属性配置文件</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisAutoConfiguration</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">//属性配置文件默认以mybatis开头</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = MybatisProperties.MYBATIS_PREFIX)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisProperties</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYBATIS_PREFIX = <span class="string">&quot;mybatis&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在自动配置文件中。会为我们配置好SqlSessionFactory，SqlSession。</li>
<li>同时对于mapper的接口，自动配置文件会扫描所有带@Mapper注解的接口作为mapper的接口。</li>
</ul>
</li>
<li><p>使用规则：</p>
<ul>
<li>在SpringBoot配置文件中可以配置Mybatis的所有配置，</li>
<li>也可以指定Mybatis全局配置文件的位置，然后再全局配置文件中配置mybatis.</li>
<li><strong>注意：</strong>当指定全局配置文件时，不能再Springboot配置文件中配置mybatis的全局配置。</li>
<li>我们推荐不适用使用全局配置文件，而是再springboot配置文件中配置。</li>
</ul>
</li>
<li><p>通用配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对Mybatis的配置</span></span><br><span class="line"><span class="comment"># 指定mapper.xml文件的位置</span></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line"><span class="comment"># 指定mybatis全局配置文件的位置，不推荐使用</span></span><br><span class="line"><span class="comment"># mybatis.config-location=classpath:mybatis/mybatis-config.xml</span></span><br><span class="line"><span class="comment"># 配置开启驼峰命名</span></span><br><span class="line"><span class="meta">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>文件位置</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210410172926.png"></p>
</li>
</ul>
<p><strong>使用方式一：配置型使用</strong></p>
<ul>
<li><p>创建mapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意注解一定要添加到</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookMapper</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Book <span class="title">selectBook</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建mapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org/DTD Mapper 3.0&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lc.mapper.BookMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBook&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lc.bean.Book&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from `spring-jdbc`.book</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>  </span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>使用方式二：注解型使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&quot;select count(*) from book&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">selectCount</span><span class="params">()</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用方式三：混合型使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&quot;select count(*) from book&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">selectCount</span><span class="params">()</span></span>; </span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> Book <span class="title">selectBook</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<ul>
<li>第一步：引入mabatis场景</li>
<li>配置application配置文件，指定mapper-location位置即可。(也可以配置一些其他的mybatis的配置)</li>
<li>编写mapper接口并标注@Mapper注解。</li>
<li>创建对应mapper.xml文件并编写SQL语句</li>
<li>对于mapper接口的简化：<ul>
<li>可以再启动类上使用<code>@MapperScan(&quot;com.atguigu.admin.mapper&quot;)</code>直接指定扫描的位置，</li>
<li>而不用给每个接口添加mapper注解。</li>
</ul>
</li>
</ul>
<h3 id="10-1-4-使用Mybatis-Plus操作"><a href="#10-1-4-使用Mybatis-Plus操作" class="headerlink" title="10.1.4 使用Mybatis-Plus操作"></a>10.1.4 使用Mybatis-Plus操作</h3><ul>
<li><p>mybatis-plus是在Mybatis的基础上又进行了封装和升级。</p>
</li>
<li><p>官网：<a target="_blank" rel="noopener" href="https://baomidou.com/">https://baomidou.com/</a></p>
</li>
<li><p>添加mybatis-plus场景依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--此场景另外引入了jdbc的场景--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>自动配置</p>
<ul>
<li><code>MybatisPlusAutoConfiguration</code>自动配置类。绑定<code>MybatisPlusProperties</code>属性配置。对应mybatis-plus前缀的属性配置。</li>
<li><code>SqlSessionFactory</code>是自动配置好的，默认使用jdbc默认的数据源</li>
<li>和mybatis不同的一点：<code>mapperLocations </code>也是默认配置好的。<ul>
<li>默认属性为：classpath*:/mapper/**/*.xml。</li>
<li>表示匹配类资源路径下mapper文件，其文件下及其子文件下的所有xml文件。</li>
<li>因此建议将sql映射文件都放在mapper文件下。可以在mapper文件下左多层分级目录。</li>
</ul>
</li>
<li><code>SqlSessionTemplate</code>是自动配置好的。</li>
<li>对于mapper接口的扫描。支持使用@Mapper注解表述每一个mapper接口。或使用@MapperScan注解指定批量扫描。</li>
</ul>
</li>
<li><p>Mybatis-plus与Mybatis的最大的好处是：只要我们的mapper接口继承BaseMapper并标注泛型类型，就可以实现基本的CRUD功能。而且我们还可以添加自己的sql方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Book</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function">Integer <span class="title">selectCount</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>BaseMapper</code>的基本功能如下：</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210411155353.png"></p>
</li>
<li><p>Mybatis-plus的注意点：</p>
<ul>
<li>对于bean实体，默认查询的表明和实体名相同，如果不同时，需要再实体类上指明要查询的表名。</li>
<li>对于实体类，默认操作时是操作所有的属性，因此当有此属性而数据库中没有对应字段时，也要标注出来。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="comment">//当数据库中没有此字段时，可以使用此注解表明</span></span><br><span class="line">  <span class="meta">@TableField(exist = false)</span></span><br><span class="line">  <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>MybatisPlus不仅对mapper有BaseMapper的升级，在service层也有升级。</p>
<ul>
<li>在service接口需要继承<code>IService</code></li>
<li>在service实现类需要继承<code>ServiceImpl</code>并指明泛型。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Book</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">BookMapper</span>,<span class="title">Book</span>&gt; <span class="keyword">implements</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时的<code>BookServiceImpl</code>就具有<code>IService</code>和<code>ServiceImpl</code>的所有功能了。</li>
</ul>
</li>
<li><p>关于分页插件的功能</p>
<ul>
<li>需要在项目的容器中添加一个配置。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">  MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//添加分页拦截器</span></span><br><span class="line">  PaginationInnerInterceptor paginationInnerInterceptor = <span class="keyword">new</span> PaginationInnerInterceptor();</span><br><span class="line">  <span class="comment">//对分页进行设置</span></span><br><span class="line">  paginationInnerInterceptor.setOverflow(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">  interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line">  <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="10-2-NoSQL"><a href="#10-2-NoSQL" class="headerlink" title="10.2 NoSQL"></a>10.2 NoSQL</h2><h3 id="10-2-1-Redis配置"><a href="#10-2-1-Redis配置" class="headerlink" title="10.2.1 Redis配置"></a>10.2.1 Redis配置</h3><h3 id="10-2-2-RedisTemplate与Lettuce"><a href="#10-2-2-RedisTemplate与Lettuce" class="headerlink" title="10.2.2 RedisTemplate与Lettuce"></a>10.2.2 RedisTemplate与Lettuce</h3><h3 id="10-2-3-切换至jedis"><a href="#10-2-3-切换至jedis" class="headerlink" title="10.2.3 切换至jedis"></a>10.2.3 切换至jedis</h3><h1 id="第十一章：单元测试"><a href="#第十一章：单元测试" class="headerlink" title="第十一章：单元测试"></a>第十一章：单元测试</h1><h1 id="第十二章：指标监控"><a href="#第十二章：指标监控" class="headerlink" title="第十二章：指标监控"></a>第十二章：指标监控</h1><h1 id="第十三章：原理解析"><a href="#第十三章：原理解析" class="headerlink" title="第十三章：原理解析"></a>第十三章：原理解析</h1>
    </div>

    
    
    


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/03/30/%E5%8A%9B%E6%89%A3%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95/74-%E6%90%9C%E7%B4%A2%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5/" rel="prev" title="74-搜索二维矩阵">
      <i class="fa fa-chevron-left"></i> 74-搜索二维矩阵
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/04/18/%E5%B0%9A%E7%A1%85%E8%B0%B7%E8%AF%B4Java/%E9%9B%86%E6%88%90%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/linux%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="next" title="linux的搭建">
      linux的搭建 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-HelloWorld"><span class="nav-number">1.</span> <span class="nav-text">第一章 HelloWorld</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">第二章：配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2"><span class="nav-number">3.</span> <span class="nav-text">第三章：打包部署</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="nav-number">4.</span> <span class="nav-text">第四章：依赖管理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">第五章：自动配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E5%AE%B9%E5%99%A8%E5%8A%9F%E8%83%BD"><span class="nav-number">6.</span> <span class="nav-text">第六章：容器功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 组件添加</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-Configuration%E6%B3%A8%E8%A7%A3"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.1.1 @Configuration注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-Bean%E3%80%81-Component%E3%80%81-Controller%E3%80%81-Service%E3%80%81-Repository"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.1.2 @Bean、@Component、@Controller、@Service、@Repository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-3-ComponentScan%E3%80%81-Import"><span class="nav-number">6.1.3.</span> <span class="nav-text">6.1.3 @ComponentScan、@Import</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-4-Conditional"><span class="nav-number">6.1.4.</span> <span class="nav-text">6.1.4 @Conditional</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E5%8E%9F%E7%94%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5-ImportResource"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 原生配置文件引入@ImportResource</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E9%85%8D%E7%BD%AE%E7%BB%91%E5%AE%9A"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 配置绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-1-ConfigurationProperties"><span class="nav-number">6.3.1.</span> <span class="nav-text">6.3.1 @ConfigurationProperties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-2-%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A-ConfigurationProperties-Component"><span class="nav-number">6.3.2.</span> <span class="nav-text">6.3.2 使用方式一：@ConfigurationProperties+@Component</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-3-%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A-ConfigurationProperties-EnableConfigurationProperties"><span class="nav-number">6.3.3.</span> <span class="nav-text">6.3.3 使用方式二：@ConfigurationProperties+@EnableConfigurationProperties</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0%EF%BC%9A%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">第七章：自动配置原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E5%BC%95%E5%AF%BC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 引导自动配置类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-1-SpringBootConfiguration"><span class="nav-number">7.1.1.</span> <span class="nav-text">7.1.1 @SpringBootConfiguration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-2-EnableAutoConfiguration"><span class="nav-number">7.1.2.</span> <span class="nav-text">7.1.2 @EnableAutoConfiguration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-3-ComponentScan"><span class="nav-number">7.1.3.</span> <span class="nav-text">7.1.3 @ComponentScan</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E6%8C%89%E9%9C%80%E5%BC%80%E5%90%AF%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 按需开启自动配置项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="nav-number">7.3.</span> <span class="nav-text">7.3 修改默认配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0%EF%BC%9A%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7"><span class="nav-number">8.</span> <span class="nav-text">第八章：开发技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-SpringBoot%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 SpringBoot使用步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-Lombok"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 Lombok</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-dev-tools"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 dev-tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-Spring-Initailizr%EF%BC%88%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%91%E5%AF%BC%EF%BC%89"><span class="nav-number">8.4.</span> <span class="nav-text">8.3 Spring Initailizr（项目初始化向导）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0%EF%BC%9A-web%E5%BC%80%E5%8F%91"><span class="nav-number">9.</span> <span class="nav-text">第九章： web开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 静态资源访问</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-1-%E6%AC%A2%E8%BF%8E%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="nav-number">9.1.1.</span> <span class="nav-text">9.1.1 欢迎页支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-2%E8%87%AA%E5%AE%9A%E4%B9%89Favicon-%E5%9B%BE%E6%A0%87"><span class="nav-number">9.1.2.</span> <span class="nav-text">9.1.2自定义Favicon(图标)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-3-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">9.1.3.</span> <span class="nav-text">9.1.3 静态资源配置原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 请求参数处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-1-%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84"><span class="nav-number">9.2.1.</span> <span class="nav-text">9.2.1 请求映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-2-%E6%99%AE%E9%80%9A%E5%8F%82%E6%95%B0%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="nav-number">9.2.2.</span> <span class="nav-text">9.2.2 普通参数与基本注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0-POJO%E5%B0%81%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="nav-number">9.2.3.</span> <span class="nav-text">9.2.3 自定义对象参数 POJO封装过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-4-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86"><span class="nav-number">9.2.4.</span> <span class="nav-text">9.2.4 参数处理原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E4%B8%8E%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 数据响应与内容协商</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-1-%E5%93%8D%E5%BA%94JSON"><span class="nav-number">9.3.1.</span> <span class="nav-text">9.3.1 响应JSON</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-2-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">9.3.2.</span> <span class="nav-text">9.3.2 内容协商</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-3-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="nav-number">9.3.3.</span> <span class="nav-text">9.3.3 原理解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-4-SpringMVC%E6%94%AF%E6%8C%81%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.3.4.</span> <span class="nav-text">9.3.4 SpringMVC支持的返回值类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-5-HttpMessageConverter%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="nav-number">9.3.5.</span> <span class="nav-text">9.3.5 HttpMessageConverter消息转换器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-6-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="nav-number">9.3.6.</span> <span class="nav-text">9.3.6 自定义消息转换器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-number">9.4.</span> <span class="nav-text">9.4 视图解析与模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-1-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="nav-number">9.4.1.</span> <span class="nav-text">9.4.1 视图解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-2-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-number">9.4.2.</span> <span class="nav-text">9.4.2 模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81thymeleaf%E7%AE%80%E4%BB%8B"><span class="nav-number">9.4.2.1.</span> <span class="nav-text">1、thymeleaf简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">9.4.2.2.</span> <span class="nav-text">2、基本语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC-th-attr"><span class="nav-number">9.4.2.3.</span> <span class="nav-text">3、设置属性值-th:attr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E8%BF%AD%E4%BB%A3"><span class="nav-number">9.4.2.4.</span> <span class="nav-text">4、迭代</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97"><span class="nav-number">9.4.2.5.</span> <span class="nav-text">5、条件运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%E3%80%81%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">9.4.2.6.</span> <span class="nav-text">6、属性优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-3-Thymeleaf%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">9.4.3.</span> <span class="nav-text">9.4.3 Thymeleaf的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-4-%E6%9E%84%E5%BB%BA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">9.4.4.</span> <span class="nav-text">9.4.4 构建后台管理系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">9.5.</span> <span class="nav-text">8.5 拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-1-%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">9.5.1.</span> <span class="nav-text">8.5.1 拦截器的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-2-%E5%AF%B9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">9.5.2.</span> <span class="nav-text">8.5.2 对静态资源的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-3-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="nav-number">9.5.3.</span> <span class="nav-text">5.5.3 原理解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">9.6.</span> <span class="nav-text">9.6 文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-6-1-%E9%A1%B5%E9%9D%A2%E8%A1%A8%E5%8D%95"><span class="nav-number">9.6.1.</span> <span class="nav-text">9.6.1 页面表单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-6-2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81%E5%8F%8A%E9%85%8D%E7%BD%AE"><span class="nav-number">9.6.2.</span> <span class="nav-text">9.6.2 文件上传代码及配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-6-3-%E5%8E%9F%E7%90%86"><span class="nav-number">9.6.3.</span> <span class="nav-text">9.6.3 原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%EF%BC%88%E7%BC%BA%E5%A4%B1%EF%BC%89"><span class="nav-number">9.7.</span> <span class="nav-text">9.7 异常处理（缺失）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-1-%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="nav-number">9.7.1.</span> <span class="nav-text">9.7.1 默认规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91"><span class="nav-number">9.7.2.</span> <span class="nav-text">9.7.2 自定义错误页面实现逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-3-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86"><span class="nav-number">9.7.3.</span> <span class="nav-text">9.7.3 异常处理原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-4-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-number">9.7.4.</span> <span class="nav-text">9.7.4 异常处理流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-8-Web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5"><span class="nav-number">9.8.</span> <span class="nav-text">9.8 Web原生组件注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-8-1-%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E7%9A%84Servlet-API"><span class="nav-number">9.8.1.</span> <span class="nav-text">9.8.1 使用原生的Servlet API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-8-2-%E4%BD%BF%E7%94%A8Spring%E7%9A%84RegistrantionBean"><span class="nav-number">9.8.2.</span> <span class="nav-text">9.8.2 使用Spring的RegistrantionBean</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-9-%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="nav-number">9.9.</span> <span class="nav-text">9.9 嵌入式Servlet容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-1-%E5%BA%94%E7%94%A8%EF%BC%9A%E5%A6%82%E4%BD%95%E5%88%87%E6%8D%A2%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">9.9.1.</span> <span class="nav-text">9.9.1 应用：如何切换服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-2-%E4%BF%AE%E6%94%B9web%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">9.9.2.</span> <span class="nav-text">9.9.2 修改web服务器配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-10-%E5%AE%9A%E5%88%B6%E5%8C%96%E5%8E%9F%E7%90%86"><span class="nav-number">9.10.</span> <span class="nav-text">9.10 定制化原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="nav-number">10.</span> <span class="nav-text">第十章：数据访问</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-SQL"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-1-%E6%95%B0%E6%8D%AE%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">10.1.1.</span> <span class="nav-text">10.1.1 数据的配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-2-%E4%BD%BF%E7%94%A8Druid%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">10.1.2.</span> <span class="nav-text">10.1.2 使用Druid数据源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-3-%E4%BD%BF%E7%94%A8MyBatisca%E6%93%8D%E4%BD%9C"><span class="nav-number">10.1.3.</span> <span class="nav-text">10.1.3 使用MyBatisca操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-4-%E4%BD%BF%E7%94%A8Mybatis-Plus%E6%93%8D%E4%BD%9C"><span class="nav-number">10.1.4.</span> <span class="nav-text">10.1.4 使用Mybatis-Plus操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-NoSQL"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 NoSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-1-Redis%E9%85%8D%E7%BD%AE"><span class="nav-number">10.2.1.</span> <span class="nav-text">10.2.1 Redis配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-2-RedisTemplate%E4%B8%8ELettuce"><span class="nav-number">10.2.2.</span> <span class="nav-text">10.2.2 RedisTemplate与Lettuce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-3-%E5%88%87%E6%8D%A2%E8%87%B3jedis"><span class="nav-number">10.2.3.</span> <span class="nav-text">10.2.3 切换至jedis</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%EF%BC%9A%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">11.</span> <span class="nav-text">第十一章：单元测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-number">12.</span> <span class="nav-text">第十二章：指标监控</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="nav-number">13.</span> <span class="nav-text">第十三章：原理解析</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Plum Reiver</p>
  <div class="site-description" itemprop="description">技术，日常，笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">91</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
	
  </nav>
</div>


      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Plum Reiver</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
