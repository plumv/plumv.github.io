<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"plumv.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="Spring的使用，IOC容器，AOP功能，jdbcTemplate,事务功能，动态代理，单元测试，webFlux">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring5的学习">
<meta property="og:url" content="https://plumv.github.io/2021/03/06/Java%E5%AD%A6%E4%B9%A0/JavaEE%E6%A1%86%E6%9E%B6/spring5/index.html">
<meta property="og:site_name" content="李川的个人博客">
<meta property="og:description" content="Spring的使用，IOC容器，AOP功能，jdbcTemplate,事务功能，动态代理，单元测试，webFlux">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120510.jpg">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120717.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120828.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301121023.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301122307.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301133809.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301133843.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210302192831.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210306154933.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304163738.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304163725.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304163746.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304170514.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305102753.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305102806.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305121142.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305162242.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305174026.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305174000.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305174454.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210306111003.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427083625.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427100117.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427104447.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427104451.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427144138.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427144209.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427185510.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427184619.png">
<meta property="og:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427205845.png">
<meta property="article:published_time" content="2021-03-05T16:00:00.000Z">
<meta property="article:modified_time" content="2021-04-28T11:02:11.415Z">
<meta property="article:author" content="Plum Reiver">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120510.jpg">

<link rel="canonical" href="https://plumv.github.io/2021/03/06/Java%E5%AD%A6%E4%B9%A0/JavaEE%E6%A1%86%E6%9E%B6/spring5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spring5的学习 | 李川的个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">李川的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学习生活</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>日志</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://plumv.github.io/2021/03/06/Java%E5%AD%A6%E4%B9%A0/JavaEE%E6%A1%86%E6%9E%B6/spring5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Plum Reiver">
      <meta itemprop="description" content="技术，日常，笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李川的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring5的学习
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-06 00:00:00" itemprop="dateCreated datePublished" datetime="2021-03-06T00:00:00+08:00">2021-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-28 19:02:11" itemprop="dateModified" datetime="2021-04-28T19:02:11+08:00">2021-04-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Java学习</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%AD%A6%E4%B9%A0/JavaEE%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">JavaEE框架</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Spring的使用，IOC容器，AOP功能，jdbcTemplate,事务功能，动态代理，单元测试，webFlux</p>
<span id="more"></span>

<h1 id="第一章-Spring框架概述"><a href="#第一章-Spring框架概述" class="headerlink" title="第一章 Spring框架概述"></a>第一章 Spring框架概述</h1><ul>
<li><p>Spring 是轻量级的开源的 JavaEE 框架。</p>
</li>
<li><p>Spring 可以解决企业应用开发的复杂性</p>
</li>
<li><p>Spring 有两个核心部分：IOC 和 Aop</p>
<ul>
<li>(1) IOC：控制反转，把创建对象过程交给 Spring 进行管理。</li>
<li>(2) Aop：面向切面，不修改源代码进行功能增强。</li>
</ul>
</li>
<li><p>Spring特点：</p>
<ul>
<li>(1) 方便解耦，简化开发<ul>
<li>通过Spring提供的IoC容器，我们可以将对象之间的依赖关系交由Spring进行控制，避免硬编码所造成的过度程序耦合。有了Spring，用户不必再为单实例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用。</li>
</ul>
</li>
<li>(2) Aop编程支持<ul>
<li>通过Spring提供的AOP功能，方便进行面向切面的编程，</li>
</ul>
</li>
<li>(3) 方便程序测试<ul>
<li>可以用非容器依赖的编程方式进行几乎所有的测试工作，在Spring里，测试不再是昂贵的操作，而是随手可做的事情。例如：Spring对Junit4支持，可以通过注解方便的测试Spring程序。</li>
</ul>
</li>
<li>(4) 方便和其他框架进行整合<ul>
<li>Spring不排斥各种优秀的开源框架，相反，Spring可以降低各种框架的使用难度，Spring提供了对各种优秀框架（如Struts,Hibernate、Hessian、Quartz）等的直接支持。</li>
</ul>
</li>
<li>(5) 降低API开发难度<ul>
<li>Spring对很多难用的Java EE API（如JDBC，JavaMail，远程调用等）提供了一个薄薄的封装层，通过Spring的简易封装，这些Java EE API的使用难度大为降低。</li>
</ul>
</li>
</ul>
</li>
<li><p>Spring的基本功能需要的包的图示如下</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120510.jpg"></p>
</li>
</ul>
<h2 id="1-1-Spring的入门实现"><a href="#1-1-Spring的入门实现" class="headerlink" title="1.1 Spring的入门实现"></a>1.1 Spring的入门实现</h2><ul>
<li><p>以Spring2.5.6版本为例。</p>
</li>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://repo.spring.io/release/org/springframework/spring/5.2.6.RELEASE/">下载</a></p>
<ul>
<li>下载dist.zip结尾的文件。下载后解压。</li>
</ul>
</li>
<li><p>文件结构如下</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120717.png"></p>
</li>
</ul>
<p><strong>在IDEA中使用Spring</strong></p>
<ul>
<li><p>使用IDEA创建一个简单的Java工程，然后创建lib目录。如下</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301120828.png"></p>
</li>
<li><p>使用Spring时，还需要使用一个辅助包logging。下载地址：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/izZfYmdxm6b">下载</a></p>
</li>
<li><p>将Spring的基本包和辅助包复制到到lib文件中。如上图</p>
</li>
<li><p>打开IDEA的项目设置。添加jar,把lib目录为项目的依赖jar包目录。</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301121023.png"></p>
</li>
<li><p>在项目中创建两个类：User类和Test类。创建spring的配置文件。如上面的图</p>
</li>
<li><p>示例代码如下</p>
</li>
<li><p>User类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user-add&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>test类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpring5</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1.加载配置文件</span></span><br><span class="line">    ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean-config.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//2.通过配置文件创建对象</span></span><br><span class="line">    User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    user.add();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置User对象的创建。id表示User的标识符。class为User的类路径--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>执行结果如下</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301122307.png"></p>
<h1 id="第二章-IOC容器"><a href="#第二章-IOC容器" class="headerlink" title="第二章 IOC容器"></a>第二章 IOC容器</h1><h2 id="2-1-IOC底层原理"><a href="#2-1-IOC底层原理" class="headerlink" title="2.1 IOC底层原理"></a>2.1 IOC底层原理</h2><ul>
<li><p>控制反转：就是把对象创建和对象之间的调用过程，交给 Spring 进行管理。</p>
</li>
<li><p>使用IOC目的：降低耦合度。</p>
</li>
<li><p>IOC的原理：使用的<font color="red">xml解析</font>技术。以<font color="red">工厂模式</font>通过<font color="red">反射</font>完成。</p>
</li>
<li><p>实现在Service中调用dao类：原始方式和工厂模式。</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301133809.png"></p>
</li>
<li><p>IOC的实现模式：</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210301133843.png"></p>
</li>
</ul>
<h2 id="2-2-IOC接口：BeanFactory"><a href="#2-2-IOC接口：BeanFactory" class="headerlink" title="2.2 IOC接口：BeanFactory"></a>2.2 IOC接口：BeanFactory</h2><ul>
<li>IOC 思想基于 IOC 容器完成，IOC 容器底层就是对象工厂。</li>
<li>Spring 提供 IOC 容器实现两种方式：（两个接口）<ul>
<li>BeanFactory：IOC 容器基本实现，是 Spring 内部的使用接口，不提供开发人员进行使用。<ul>
<li>加载配置文件时候不会创建对象，在获取对象（使用）才去创建对象。</li>
</ul>
</li>
<li>ApplicationContext：BeanFactory 接口的子接口，提供更多更强大的功能，一般由开发人员进行使用。<ul>
<li>加载配置文件时候就会把在配置文件对象进行创建。</li>
</ul>
</li>
</ul>
</li>
<li>往后的使用中：由于spring框架适合web服务器一起使用的。<ul>
<li>因此会优先选择ApplicationContext接口。因为在服务器启动时就创建好bean。会节省使用时再创建bean的时间。</li>
</ul>
</li>
<li>ApplicationContext 接口的主要实现类：<ul>
<li>FileSystemXmlApplicationContext：用于解析xml文件。以绝对路径为参数。一般从盘符开始指明路径。</li>
<li>ClassPathXmlApplicationContext：用于解析xml文件。以相对路径为参数。一般从src目录下开始指明路径。</li>
</ul>
</li>
</ul>
<h2 id="2-3-IOC操作Bean管理："><a href="#2-3-IOC操作Bean管理：" class="headerlink" title="2.3 IOC操作Bean管理："></a>2.3 IOC操作Bean管理：</h2><ul>
<li>Bean管理是指两个操作：<ul>
<li>Spring创建对象：即通过IOC的方式创建出实体类的对象。而不是new出对象。</li>
<li>Spring注入属性：即通过IOC的方式设置对象的属性值。而不是通过setXxx()的方法。<ul>
<li>依赖注入（Dependency Injection）简称DI。就是注入属性。</li>
</ul>
</li>
</ul>
</li>
<li>Bean 管理操作有两种方式：<ul>
<li>基于 xml 配置文件方式实现。</li>
<li>基于 xml 配置文件方式实现。</li>
</ul>
</li>
</ul>
<h3 id="2-3-1-基于xml的方式—创建对象"><a href="#2-3-1-基于xml的方式—创建对象" class="headerlink" title="2.3.1 基于xml的方式—创建对象"></a>2.3.1 基于xml的方式—创建对象</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在 spring 配置文件中，使用 bean 标签，标签里面添加对应属性，就可以实现对象创建。</li>
<li>在 bean 标签有很多属性，介绍常用的属性：<ul>
<li>id：是bean标签的唯一标识符。具有相同作用的属性是name。<ul>
<li>不同的是：id的值不能含有符号，例如/-之类的。而name中可以含有符号。</li>
</ul>
</li>
<li>class：类全路径（包类路径）。是实体类在src目录下的路径。</li>
</ul>
</li>
<li>创建对象时候，默认也是执行无参数构造方法完成对象创建。<ul>
<li>因此注意：在编写Bean的实体类时一定要有无参构造方法。</li>
</ul>
</li>
</ul>
<h3 id="2-3-2-基于xml的方式—注入属性"><a href="#2-3-2-基于xml的方式—注入属性" class="headerlink" title="2.3.2 基于xml的方式—注入属性"></a>2.3.2 基于xml的方式—注入属性</h3><p>第一种注入方式：使用set方法进行注入 -property</p>
<ul>
<li>首先需要满足前提条件：定义属性和对应的set方法。在配置文件中创建对象。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--使用property完成属性注入：</span></span><br><span class="line"><span class="comment">        name：实体类中的属性名称。</span></span><br><span class="line"><span class="comment">        value：向属性中注入的值。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二种注入方式：使用有参构造注入 -constructor</p>
<ul>
<li>首先需要满足前提条件：定义属性和对应的有参构造方法。在配置文件中创建对象。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--使用property完成属性注入：</span></span><br><span class="line"><span class="comment">        name：实体类中的属性名称。</span></span><br><span class="line"><span class="comment">        value：向属性中注入的值--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三种注入方式：p名称空间注入(了解)</p>
<ul>
<li>作用：可以简化xml配置</li>
<li>首先需要满足前提条件：在xml文件的头配置中加上xmlns:p=”<a target="_blank" rel="noopener" href="http://www.springframework.org/schema/p&quot;">http://www.springframework.org/schema/p&quot;</a></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans    </span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;cl&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-基于xml的方式—注入其他类型属性"><a href="#2-3-3-基于xml的方式—注入其他类型属性" class="headerlink" title="2.3.3 基于xml的方式—注入其他类型属性"></a>2.3.3 基于xml的方式—注入其他类型属性</h3><p><strong>1.字面量</strong></p>
<ul>
<li>null值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>属性值包含特殊符号</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--属性值包含特殊符号</span></span><br><span class="line"><span class="comment">    方法一：把&lt;&gt;进行转义。使用转义字符代替特殊符号。</span></span><br><span class="line"><span class="comment">    方法二：把特殊符号内容写到CDATA中。CDATA格式为： &lt;![CDATA[值]]&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[&lt;&lt;cl&gt;&gt;]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.注入属性-外部bean</strong></p>
<ul>
<li>第一步：创建service类，dao接口和实现类。</li>
<li>第二步：在service类中创建dao属性和set方法。</li>
<li>第三步：在配置文件中进行配置。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--外部bean注入</span></span><br><span class="line"><span class="comment">    ref属性值：创建userDao对象bean标签的id值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.services.UserService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.daos.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.注入属性-内部bean</strong></p>
<ul>
<li>常用于一对多关系</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.services.UserService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.daos.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>4.注入属性-级联赋值</strong></p>
<ul>
<li>一级级联赋值(类似于外部bean)：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.services.UserService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.daos.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>二级级联赋值:<ul>
<li>需要在people中有getUser()的方法。</li>
<li>people的bean中需要先设置user的外部bean。</li>
<li>需要有外部bean存在。</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.People&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--二级赋值--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user.age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;asd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-基于xml的方式—注入集合属性"><a href="#2-3-4-基于xml的方式—注入集合属性" class="headerlink" title="2.3.4 基于xml的方式—注入集合属性"></a>2.3.4 基于xml的方式—注入集合属性</h3><ul>
<li>注入数组类型/List集合Map集合/Set集合。</li>
<li>集合的值可以是基本数据类型，也可以是引用数据类型。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.Student&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;array&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--当数组类型是引用对象时可以采用&lt;ref/&gt;设置值。或者使用内部bean方式--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--当list类型是引用对象时可以采用&lt;ref/&gt;设置值。或者使用内部bean方式--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--当map类型的key是引用类型时：entry的属性可以用key-ref--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--当map类型的value是引用类型时：entry的属性可以用value-ref--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;a&quot;</span> <span class="attr">value</span>=<span class="string">&quot;a&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;b&quot;</span> <span class="attr">value</span>=<span class="string">&quot;b&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;c&quot;</span> <span class="attr">value</span>=<span class="string">&quot;c&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--当set类型是引用对象时可以采用&lt;ref/&gt;设置值。或者使用内部bean方式--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-5-基于xml的方式—提取公共部分。"><a href="#2-3-5-基于xml的方式—提取公共部分。" class="headerlink" title="2.3.5 基于xml的方式—提取公共部分。"></a>2.3.5 基于xml的方式—提取公共部分。</h3><ul>
<li>以集合为例。<ul>
<li>首先要在配置文件的头部引入名称空间util。</li>
<li>然后提取公共部分。</li>
<li>最后在bean的property标签中使用ref引入。</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--提取公共部分--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--集合的使用--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-6-基于注解的方式—创建对象"><a href="#2-3-6-基于注解的方式—创建对象" class="headerlink" title="2.3.6 基于注解的方式—创建对象"></a>2.3.6 基于注解的方式—创建对象</h3><ul>
<li><p>什么是注解？</p>
<ul>
<li>（1）注解是代码特殊标记，格式：@注解名称(属性名称=属性值, 属性名称=属性值..)</li>
<li>（2）使用注解，注解作用在类上面，方法上面，属性上面</li>
<li>（3）使用注解目的：简化 xml 配置</li>
</ul>
</li>
<li><p>Spring针对Bean管理中创建对象提供的注解</p>
<ul>
<li>@Component ：一般用于实体类上</li>
<li>@Service：一般用于业务类上</li>
<li>@Controller：一般用于控制层的类上</li>
<li>@Repository：一般用于数据访问层的类上</li>
</ul>
</li>
<li><p>上面四个注解功能是一样的，都可以用来创建 bean 实例</p>
</li>
<li><p>案例</p>
<ul>
<li>第一步 引入spring-aop.jar包到项目的lib文件中</li>
<li>第二步 在配置文件中加上context名称空间，并且配置：开启组件扫描</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--开启组件扫描</span></span><br><span class="line"><span class="comment">      1.多个包之间以逗号隔开。</span></span><br><span class="line"><span class="comment">      2.写多个包的父包。</span></span><br><span class="line"><span class="comment">      base-package：表示扫描当前包及包下的包中的所有类--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第三步 创建类，并在类上添加创建对象的注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在注解中的value属性值可以省略不写。默认值时类名称首字母小写。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;studentService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;service test-----&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第四步 测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean2-config.xml&quot;</span>);</span><br><span class="line">StudentService studentService = context.getBean(<span class="string">&quot;studentService&quot;</span>, StudentService.class);</span><br><span class="line">studentService.test();</span><br></pre></td></tr></table></figure></li>
<li><p>在配置文件中开启组件扫描的细节配置</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--实例一</span></span><br><span class="line"><span class="comment">  use-default-filters：为false表示不使用spring自带的扫描机制。而使用自定义的扫描机制。</span></span><br><span class="line"><span class="comment">  include-filter：表示当前组件扫描要使用哪种方式进行扫描。</span></span><br><span class="line"><span class="comment">    类型为annotation(意为注解)。expression指向Service注解类，</span></span><br><span class="line"><span class="comment">  此实例的意思为：只扫描com.lc包下带Service注解的类</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--实例二</span></span><br><span class="line"><span class="comment">  use-default-filters：为true表示使用spring自带的扫描机制。默认为true</span></span><br><span class="line"><span class="comment">  exclude-filter：表示当前组件扫描不使用哪种方式进行扫描。</span></span><br><span class="line"><span class="comment">    类型为annotation(意为注解)。expression指向Service注解类，</span></span><br><span class="line"><span class="comment">  此实例的意思为：根据spring自带机制扫描com.lc包下所有的注解，但Service注解不扫描</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-7基于注解的方式—注入属性"><a href="#2-3-7基于注解的方式—注入属性" class="headerlink" title="2.3.7基于注解的方式—注入属性"></a>2.3.7基于注解的方式—注入属性</h3><ul>
<li>@Autowired：根据属性类型进行自动装配。<ul>
<li>不需要添加set方法。</li>
</ul>
</li>
<li>@Qualifier：根据名称进行注入。<ul>
<li>@Qualifier注解需要和@Autowired注解一起使用。</li>
<li>常用于多个相同类型的bean匹配时，以名称区分。</li>
</ul>
</li>
<li>@Resource：可以根据类型注入，可以根据名称注入。<ul>
<li>@Resource注解不加name时，是根据类型注入。</li>
<li>@Resource注解加name时，是根据名称注入。</li>
<li>@Resource是javax.annotation包下的不属于spring注解，但也能使用。不推荐使用。</li>
</ul>
</li>
<li>@Value：注入普通类型属性。<ul>
<li>@Value注解是适用于注入基本数据类型或字符串类型，不适用于注入引用类型。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="meta">@Qualifier(&quot;userDao&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">  <span class="meta">@Resource(&quot;userDao2&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> UserDao userDao2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">  <span class="meta">@Value(&quot;asd&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-8-全注解方式开发"><a href="#2-3-8-全注解方式开发" class="headerlink" title="2.3.8 全注解方式开发"></a>2.3.8 全注解方式开发</h3><ul>
<li>全注解开发即项目中没有一个配置文件。</li>
<li>第一步：创建配置类，用于替代xml配置文件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span> 注解用于表示这个类是注解类，可以代替xml配置文件。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ComponentScan</span> 的作用相当于xml中的组件扫描功能。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.lc&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：使用配置类。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//AnnotationConfigApplicationContext：通过配置类来配置spring的context</span></span><br><span class="line">  ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfig.class);</span><br><span class="line">  StudentService studentService = context.getBean(<span class="string">&quot;studentService&quot;</span>, StudentService.class);</span><br><span class="line">  studentService.test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-Bean的两种类型"><a href="#2-4-Bean的两种类型" class="headerlink" title="2.4 Bean的两种类型"></a>2.4 Bean的两种类型</h2><ul>
<li>Spring 有两种类型 bean，一种普通 bean，另外一种工厂 bean（FactoryBean）<ul>
<li>普通 bean：在配置文件中定义的bean类型就是getBean()方法的返回类型</li>
<li>工厂 bean：在配置文件定义bean 类型和getBean()方法的返回类型不一样。</li>
</ul>
</li>
</ul>
<p><strong>普通Bean</strong></p>
<ul>
<li>xml配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Java代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//配置文件中的class类型就是User,这里的返回值还是User类型</span></span><br><span class="line">User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure>

<p><strong>工厂Bean</strong></p>
<ul>
<li><p>工厂Bean的实现方式</p>
<ul>
<li>第一步：创建实现FactoryBean接口的类，让这个类作为工厂Bean.</li>
<li>第二部：实现接口的方法，在实现的方法中定义返回的Bean类型。</li>
</ul>
</li>
<li><p>xml配置文件</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;factory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.Factory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>工厂Bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//此方法用于返回创建的Bean</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> User <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;Asd&quot;</span>,<span class="number">15</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//此方法用于返回此工厂Bean创建的Bean类型</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//此方法用于设置是否是单例的</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//配置文件中的class类型是Factory,而这里的返回值是User类型</span></span><br><span class="line">User user = context.getBean(<span class="string">&quot;factory&quot;</span>, User.class);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure>

<h2 id="2-5-Bean的作用域"><a href="#2-5-Bean的作用域" class="headerlink" title="2.5 Bean的作用域"></a>2.5 Bean的作用域</h2><ul>
<li>Bean的作用域实际上就是指Bean是否单例的。还是多实例的。</li>
<li>在Spring中Bean默认是单例对象。即获取多个Bean时，实际上获取的是同一个Bean对象。</li>
<li>在 spring 配置文件 bean 标签里面有属性（scope）用于设置单实例还是多实例。</li>
<li>scope 属性值<ul>
<li>第一个值 默认值，singleton，表示当前Bean是单实例对。</li>
<li>第二个值 prototype，表示当前Bean是多实例对象。</li>
</ul>
</li>
<li>singleton 和 prototype 区别<ul>
<li>singleton 单实例，prototype 多实例</li>
<li>设置 scope 值是 singleton 时候，加载 spring 配置文件时候就会创建单实例对象。</li>
<li>设置 scope 值是 prototype 时候，不是在加载 spring 配置文件时候创建 对象，在调用getBean 方法时候创建多实例对象。</li>
</ul>
</li>
<li>多实例的体现：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210302192831.png"></p>
<h2 id="2-6-Bean的生命周期"><a href="#2-6-Bean的生命周期" class="headerlink" title="2.6 Bean的生命周期"></a>2.6 Bean的生命周期</h2><ul>
<li><p>生命周期：从对象创建到对象销毁的过程。</p>
</li>
<li><p>Bean生命周期(一般包含五个过程)：</p>
<ul>
<li>（1）通过构造器创建 bean 实例（无参数构造）</li>
<li>（2）为 bean 的属性设置值和对其他 bean 引用（调用 set 方法）</li>
<li>（3）调用 bean 的初始化的方法（需要进行配置初始化的方法）</li>
<li>（4）bean 可以使用了（对象获取到了）</li>
<li>（5）当容器关闭时候，调用 bean 的销毁的方法（需要进行配置销毁的方法）</li>
</ul>
</li>
<li><p>当加上Bean的后置处理器后。Bean的生命周期变成了七个过程：</p>
<ul>
<li>（1）通过构造器创建 bean 实例（无参数构造）</li>
<li>（2）为 bean 的属性设置值和对其他 bean 引用（调用 set 方法）</li>
<li>（3）后置处理器在初始化前的操作</li>
<li>（4）调用 bean 的初始化的方法（需要进行配置初始化的方法）</li>
<li>（5）后置处理器在初始化后的操作</li>
<li>（6）bean 可以使用了（对象获取到了）</li>
<li>（7）当容器关闭时候，调用 bean 的销毁的方法（需要进行配置销毁的方法）</li>
</ul>
</li>
<li><p>实例</p>
<ul>
<li>创建后置处理器。实现BeanPostProcessor接口。实现接口的方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPost</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;在初始化前执行的方法&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;在初始化后执行的方法&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建Bean类，并创建初始化，销毁等方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;第一步 执行无参构造方法&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;第二步 调用set方法设置属性值&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;第三步 执行初始化方法&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroyMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;第五步 执行销毁方法&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Bean的生命周期</span></span><br><span class="line"><span class="comment">      init-method:用于指定此Bean的初始化方法是哪个</span></span><br><span class="line"><span class="comment">      destroy-method:用于指定此Bean的销毁方法是哪个</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.Teacher&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;initMethod&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroyMethod&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;asd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置后置处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanPost&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.services.MyBeanPost&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//配置文件中的class类型是Factory,而这里的返回值是User类型</span></span><br><span class="line">Teacher teacher = context.getBean(<span class="string">&quot;teacher&quot;</span>, Teacher.class);</span><br><span class="line">System.out.println(<span class="string">&quot;第四步 获取Bean实例对象&quot;</span>);</span><br><span class="line">System.out.println(teacher);</span><br><span class="line"><span class="comment">//手动销毁应用上下文</span></span><br><span class="line">context.close();</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210306154933.png"></p>
</li>
</ul>
<h2 id="2-7-Bean的自动装配功能"><a href="#2-7-Bean的自动装配功能" class="headerlink" title="2.7 Bean的自动装配功能"></a>2.7 Bean的自动装配功能</h2><ul>
<li><p>什么是自动装配？</p>
<ul>
<li>根据指定装配规则（属性名称或者属性类型），Spring 自动将匹配的属性值进行注入。</li>
</ul>
</li>
<li><p>使用方式</p>
<ul>
<li>根据属性名称自动装配：即Bean的属性名和它的值的id相同。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--autowire属性：配置自动装配</span></span><br><span class="line"><span class="comment">        常用值byName：根据属性名称注入，注入值bean的id值和类属性名称一样</span></span><br><span class="line"><span class="comment">        常用值byType：根据属性类型注入，若存在多个相同类型的bean则会报错--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.People&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;asd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;qwe&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>根据属性类型自动装配：即Bean的属性类型和它的值的属性类型相同。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.People&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;asd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.beans.User&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;qwe&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-8-Bean操作-引入外部属性文件"><a href="#2-8-Bean操作-引入外部属性文件" class="headerlink" title="2.8 Bean操作-引入外部属性文件"></a>2.8 Bean操作-引入外部属性文件</h2><ul>
<li><p>以配置德鲁伊数据连接池为例</p>
<ul>
<li>第一步 引入德鲁伊连接池依赖jar包，放到lib下。下载地址：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iuj4Vmdxucf">下载</a></li>
<li>第二步 创建外部属性文件，properties格式文件，编写数据库信息。</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">userName</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第三步 在配置文件中引用外部属性文件，并配置数据库连接池。<ul>
<li>引用外部属性文件，需要在配置文件中引入context名称空间</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入外部属性文件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置德鲁伊连接池--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driverClass&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="第三章-Aop"><a href="#第三章-Aop" class="headerlink" title="第三章 Aop"></a>第三章 Aop</h1><h2 id="3-1-Aop的概念"><a href="#3-1-Aop的概念" class="headerlink" title="3.1 Aop的概念"></a>3.1 Aop的概念</h2><ul>
<li>Aop：面向切面编程（方面），利用 AOP 可以对业务逻辑的各个部分进行隔离，从而使业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</li>
<li>通俗描述：不通过修改源代码方式，在主干功能里面添加新功能。</li>
<li>以登录功能为例：在实现和登录功能后，想添加一个权限的功能。可以在不修改源代码的基础上直接添加。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304163738.png"></p>
<ul>
<li><p>Aop的底层原理：使用动态代理方式实现。</p>
<ul>
<li>当有接口时，使用JDK的动态代理(创建接口实现类代理对象，来增强实现类的方法)。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304163725.png"></p>
<ul>
<li>当没有接口时，使用CGLIB动态代理(创建子类代理对象，来增强子类的方法)。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304163746.png"></p>
</li>
</ul>
<h2 id="3-2-JDK动态代理"><a href="#3-2-JDK动态代理" class="headerlink" title="3.2 JDK动态代理"></a>3.2 JDK动态代理</h2><ul>
<li><p>JDK已经封装好了动态代理的逻辑，因此只要使用包装类即可。</p>
<ul>
<li>动态代理需要通过Proxy类的newProxyInstance()静态方法来获取代理对象。</li>
</ul>
</li>
<li><p>newProxyInstance()静态方法由三个参数：</p>
<ul>
<li>ClassLoader loader：类加载器</li>
<li> Class&lt;?&gt;[] interfaces：增强方法所在的类，这个类实现的所有接口数组。</li>
<li>InvocationHandler h：实现InvocationHandler 接口的代理对象，此代理对象用于增强方法。</li>
</ul>
</li>
<li><p>注意Proxy类和InvocationHandler 接口都是java.lang.reflect包下的。</p>
</li>
<li><p>实例：</p>
<ul>
<li>接口和实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">say</span><span class="params">(<span class="keyword">int</span> c)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行add。。。&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">say</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对接口实现类进行增强的代理对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置一个属性，用于接受受增强的类</span></span><br><span class="line">  <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserServiceProxy</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.object = object;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 此方法用于增强object类的某个方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;执行&quot;</span> + method.getName() + <span class="string">&quot;方法前 : &quot;</span> + <span class="string">&quot;此方法传入的参数为：&quot;</span> + Arrays.toString(args));</span><br><span class="line">    <span class="comment">//执行object类中原来的方法内容。返回值为</span></span><br><span class="line">    Object res = method.invoke(object, args);</span><br><span class="line">    System.out.println(<span class="string">&quot;执行&quot;</span> + method.getName() + <span class="string">&quot;方法后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用方式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建接口实现类实现的接口数组</span></span><br><span class="line">    Class[] interfaces = &#123;UserService.class&#125;;</span><br><span class="line">    <span class="comment">//创建接口实现类</span></span><br><span class="line">    UserServiceImpl service = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    <span class="comment">//创建接口实现类的代理对象</span></span><br><span class="line">    UserServiceProxy proxy = <span class="keyword">new</span> UserServiceProxy(service);</span><br><span class="line">    <span class="comment">//获取代理后的接口实现类对象</span></span><br><span class="line">    UserService userService = (UserService) Proxy.newProxyInstance(SpringTest.class.getClassLoader(), interfaces, proxy);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用增强后的接口实现类</span></span><br><span class="line">    <span class="keyword">int</span> result = userService.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;result =&quot;</span> + result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210304170514.png"></p>
<h2 id="3-3-Aop的术语"><a href="#3-3-Aop的术语" class="headerlink" title="3.3 Aop的术语"></a>3.3 Aop的术语</h2><ul>
<li>连接点：类里面哪些方法可以被增强，这些方法称为连接点。<ul>
<li>例如上述实现类中的add方法和say方法。因为这些方法可以被增强。</li>
</ul>
</li>
<li>切入点：实际被真正增强的方法，称为切入点。<ul>
<li>例如上述实现类的add方法。因为这个方法被增强了。</li>
</ul>
</li>
<li>通知(/增强)：实际增强的逻辑部分称为通知(增强)。通知有很多类型。<ul>
<li>前置通知：在原方法的执行前，增强的代码被称为前置通知。<ul>
<li>例如上述的输出”执行add方法前”的代码。</li>
</ul>
</li>
<li>后置通知：在原方法的执行后，增强的代码被称为前置通知。<ul>
<li>例如上述的输出”执行add方法后”的代码。</li>
</ul>
</li>
<li>环绕通知：在原方法执行前和执行后，执行的代码被称为环绕通知。</li>
<li>异常通知：当原方法出现异常时，执行的代码被称为异常通知。</li>
<li>最终通知：原方法执行后或出现异常后都会执行的代码被称为后置通知。类比try-catch中的finally作用。</li>
</ul>
</li>
<li>切面：把通知应用到切入点过程。是一个动作。<ul>
<li>例如在登录功能中添加权限判断的过程被称为切面。</li>
</ul>
</li>
</ul>
<h2 id="3-4-Aop操作-准备工作"><a href="#3-4-Aop操作-准备工作" class="headerlink" title="3.4 Aop操作-准备工作"></a>3.4 Aop操作-准备工作</h2><ul>
<li>Spring 框架一般都是基于AspectJ 实现 AOP 操作<ul>
<li>AspectJ 不是 Spring 组成部分，独立 AOP 框架，一般把 AspectJ 和 Spirng 框架一起使用，进行 AOP 操作</li>
</ul>
</li>
<li>基于 AspectJ 实现 AOP 操作<ul>
<li>基于 xml 配置文件实现</li>
<li>基于注解方式实现</li>
</ul>
</li>
<li>在项目工程中引入AOP相关依赖<ul>
<li>spring-aspects：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iHSzImhvs3g">下载地址</a></li>
<li>spring,net：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ipTf4mhvpuf">下载地址</a></li>
<li>spring.aop：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iBZ8Dmhvprc">下载地址</a></li>
<li>spring.sapectj：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iFnwWmhvpte">下载地址</a></li>
</ul>
</li>
<li>切入点表达式<ul>
<li>切入点表达式作用：知道对哪个类里面的哪个方法进行增强。</li>
<li>语法结构： execution([权限修饰符] [返回类型] [类全路径] [方法名称]([参数列表]) )</li>
</ul>
</li>
<li>举例 1：对 com.zut.dao.BookDao 类里面的 add 进行增强<ul>
<li>execution(* com.zut.dao.BookDao.add(..))</li>
<li>权限修饰符省略不写，返回类型以*代替表示全部，参数列表以..代替表示可变形参</li>
</ul>
</li>
<li>举例 2：对 com.zut.dao.BookDao 类里面的所有的方法进行增强<ul>
<li>execution(* com.zut.dao.BookDao.*(..))</li>
<li>方法名以*代替表示匹配全部</li>
</ul>
</li>
<li>举例 3：对 com.zut.dao 包里面所有类，类里面所有方法进行增强<ul>
<li>execution(* com.zut.dao.*.*(..))</li>
<li>类型以*代替表示匹配全部</li>
</ul>
</li>
</ul>
<h2 id="3-5-Aop操作-基于AspectJ注解方式"><a href="#3-5-Aop操作-基于AspectJ注解方式" class="headerlink" title="3.5 Aop操作-基于AspectJ注解方式"></a>3.5 Aop操作-基于AspectJ注解方式</h2><h3 id="3-5-1-基础使用"><a href="#3-5-1-基础使用" class="headerlink" title="3.5.1 基础使用"></a>3.5.1 基础使用</h3><ul>
<li>创建原始的类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;User add.....&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建增强类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Component</span> 将当前类实例为bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Aspect</span> 表示当前类用于生成代理对象。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProxy</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Before注解表示当前方法中的代码为前置通知。</span></span><br><span class="line"><span class="comment">   * Before注解中的值为切入点表达式，表示要对那哪个方法进行增强</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Before(&quot;execution(* com.lc.mode2.beans.User.add(..))&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;before......前置通知&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * AfterReturning注解表示当前方法中的代码为后置通知。也被称为返回通知</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@AfterReturning(&quot;execution(* com.lc.mode2.beans.User.add(..))&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;afterReturning......后置通知&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * After注解表示当前方法中的代码为最终通知。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@After(&quot;execution(* com.lc.mode2.beans.User.add(..))&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;after......最终通知&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * AfterThrowing注解表示当前方法中的代码为异常通知。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@AfterThrowing(&quot;execution(* com.lc.mode2.beans.User.add(..))&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;afterThrowing......异常通知&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Around注解表示当前方法中的代码为环绕通知。</span></span><br><span class="line"><span class="comment">   * ProceedingJoinPoint参数：表示连接点</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Around(&quot;execution(* com.lc.mode2.beans.User.add(..))&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;around......环绕通知...前&quot;</span>);</span><br><span class="line">    <span class="comment">//原方法的执行</span></span><br><span class="line">    proceedingJoinPoint.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;around......环绕通知...后&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置相关配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--开启注解/组件扫描--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc.mode2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--开启Aspect代理功能--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring1-config.xml&quot;</span>);</span><br><span class="line">User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">user.add();</span><br></pre></td></tr></table></figure>

<ul>
<li>无异常时的输出</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305102753.png"></p>
<ul>
<li>有异常时的输出</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305102806.png"></p>
<h3 id="3-5-2-相同切入点的提取"><a href="#3-5-2-相同切入点的提取" class="headerlink" title="3.5.2 相同切入点的提取"></a>3.5.2 相同切入点的提取</h3><ul>
<li>在增强类上使用@Pointcut注解提取。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//相同切入点提取</span></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.lc.mode2.beans.User.add(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">point</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line"><span class="comment">//使用相同切入点的方法名代替切入点</span></span><br><span class="line"><span class="meta">@Before(&quot;point()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;before......前置通知&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@AfterReturning(&quot;point()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;afterReturning......后置通知&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-3-多个增强类的优先级设置"><a href="#3-5-3-多个增强类的优先级设置" class="headerlink" title="3.5.3 多个增强类的优先级设置"></a>3.5.3 多个增强类的优先级设置</h3><ul>
<li>在各个增强类上使用@Order(数字)注解。数字值越小优先级就越高。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProxy</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-4-完全注解开发"><a href="#3-5-4-完全注解开发" class="headerlink" title="3.5.4 完全注解开发"></a>3.5.4 完全注解开发</h3><ul>
<li>可以使用配置类来代替配置文件的作用。实例如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EnableAspectJAutoProxy注解对应xml中的aop:aspectj-autoproxy功能，其中</span></span><br><span class="line"><span class="comment">//proxyTargetClass默认为false，因此要设置为true。表示开启代理功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigAop</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-6-Aop操作-基于AspectJ配置xml方式"><a href="#3-6-Aop操作-基于AspectJ配置xml方式" class="headerlink" title="3.6 Aop操作-基于AspectJ配置xml方式"></a>3.6 Aop操作-基于AspectJ配置xml方式</h2><ul>
<li>创建类和增强类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">&quot;add...&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookProxy</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">&quot;before....&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建bean对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.mode.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookProxy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lc.mode.BookProxy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置aop功能--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置切入点--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;p&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.lc.mode.Book.add(..)&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置切面。指明代理对象--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;bookProxy&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置前置通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;p&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="第四章-JdbcTemplate"><a href="#第四章-JdbcTemplate" class="headerlink" title="第四章 JdbcTemplate"></a>第四章 JdbcTemplate</h1><h2 id="4-1-准备工作"><a href="#4-1-准备工作" class="headerlink" title="4.1 准备工作"></a>4.1 准备工作</h2><ul>
<li><p>Spring 框架对 JDBC 进行封装，使用封装后的 JdbcTemplate 可以方便实现对数据库操作。</p>
</li>
<li><p>准备工作</p>
<ul>
<li>第一步：引入相关jar包。<ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ioWXUmimioj">mysql</a>，<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iFq27mimlmf">jdbc</a>，<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iZVLTmimlng">orm</a>，<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iGhFymimlpi">tx</a></li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305121142.png"></p>
<ul>
<li>第二步：创建dao类，service类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title">BookDao</span></span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>第三步：配置xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--开启注解/组件扫描--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置数据库连接池--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/spring-jdbc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--创建JdbcTemplate对象--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-2-JdbcTemplate操作-添加-修改-删除"><a href="#4-2-JdbcTemplate操作-添加-修改-删除" class="headerlink" title="4.2 JdbcTemplate操作-添加/修改/删除"></a>4.2 JdbcTemplate操作-添加/修改/删除</h2><ul>
<li><p>JdbcTemplate类中有个update()方法，用于更新数据库的信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql, Object... args)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数sql，表示要执行的sql语句，可以是添加语句，修改语句，删除语句。</li>
<li>第二个参数args，是个可变形参，表示执行语句中的占位符的值。</li>
<li>返回值为int类型，表示数据库中受影响的数据量。为0时表示执行失败。</li>
</ul>
</li>
<li><p>注意：args的形参顺序要和sql语句中的占位符顺序相对应</p>
</li>
</ul>
<h3 id="4-2-1-添加操作样例"><a href="#4-2-1-添加操作样例" class="headerlink" title="4.2.1 添加操作样例"></a>4.2.1 添加操作样例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;insert into book(name,author,price,date) values(?,?,?,?)&quot;</span>;</span><br><span class="line"><span class="comment">//由于第二个参数是可变参数，因此可以将其写成object数组的形式</span></span><br><span class="line">Object[] args = &#123;book.getName(),book.getAuthor(),book.getPrice(),book.getDate()&#125;;</span><br><span class="line"><span class="keyword">int</span> insert = jdbcTemplate.update(sql, args);</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-修改操作样例"><a href="#4-2-2-修改操作样例" class="headerlink" title="4.2.2 修改操作样例"></a>4.2.2 修改操作样例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;update book set name=?,author=?,price=? where id=?&quot;</span>;</span><br><span class="line">Object[] args = &#123;book.getName(),book.getAuthor(),book.getPrice(),book.getId()&#125;;</span><br><span class="line"><span class="keyword">int</span> update = jdbcTemplate.update(sql, args);</span><br><span class="line"><span class="keyword">return</span> update;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-删除操作样例"><a href="#4-2-3-删除操作样例" class="headerlink" title="4.2.3 删除操作样例"></a>4.2.3 删除操作样例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;delete from book where id = ?&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> delete = jdbcTemplate.update(sql, id);</span><br></pre></td></tr></table></figure>

<h2 id="4-3-JdbcTemplate操作-查询"><a href="#4-3-JdbcTemplate操作-查询" class="headerlink" title="4.3 JdbcTemplate操作-查询"></a>4.3 JdbcTemplate操作-查询</h2><h3 id="4-3-1-查询返回对象"><a href="#4-3-1-查询返回对象" class="headerlink" title="4.3.1 查询返回对象"></a>4.3.1 查询返回对象</h3><ul>
<li><p>JdbcTemplate类中有个queryForObject()方法，用于查询数据库并返回某一个值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, Object... args)</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数sql表示查询语句</li>
<li>第二个参数rowMapper，映射器，表示将结果映射到哪个类中</li>
<li>第三个参数args，可变形参，用于填充占位符</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;select * from book where id=?&quot;</span>;</span><br><span class="line">Book book = jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Book&gt;(Book.class), id);</span><br></pre></td></tr></table></figure>

<h3 id="4-3-2-查询某个值"><a href="#4-3-2-查询某个值" class="headerlink" title="4.3.2 查询某个值"></a>4.3.2 查询某个值</h3><ul>
<li><p>JdbcTemplate类中有个queryForObject()方法，用于查询数据库并返回某一个值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryForObject(String sql, Class&lt;T&gt; requiredType)</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数sql表示查询语句</li>
<li>第二个参数requiredType，表示返回结果的class</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;select count(*) from book&quot;</span>;</span><br><span class="line">Integer integer = jdbcTemplate.queryForObject(sql, Integer.class);</span><br></pre></td></tr></table></figure>

<h3 id="4-3-3-查询返回集合"><a href="#4-3-3-查询返回集合" class="headerlink" title="4.3.3 查询返回集合"></a>4.3.3 查询返回集合</h3><ul>
<li><p>JdbcTemplate类中有个queryForObject()方法，用于查询数据库并返回某一个值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;T&gt; <span class="title">query</span><span class="params">(String sql, RowMapper&lt;T&gt; rowMapper)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数sql表示查询语句</li>
<li>第二个参数rowMapper，映射器，表示将结果映射到哪个类中</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;select * from book&quot;</span>;</span><br><span class="line">List&lt;Book&gt; books = jdbcTemplate.query(sql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Book&gt;(Book.class));</span><br></pre></td></tr></table></figure>

<h2 id="4-4-JdbcTemplate操作-批量添加-修改-删除"><a href="#4-4-JdbcTemplate操作-批量添加-修改-删除" class="headerlink" title="4.4 JdbcTemplate操作-批量添加/修改/删除"></a>4.4 JdbcTemplate操作-批量添加/修改/删除</h2><ul>
<li>批量操作：指将一条sql语句执行多遍，每一次执行的占位符的值不同。</li>
<li>JdbcTemplate类中有个()方法，用于批量操作sql语句。</li>
</ul>
<h3 id="4-4-1-批量添加"><a href="#4-4-1-批量添加" class="headerlink" title="4.4.1 批量添加"></a>4.4.1 批量添加</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;insert into book(name,author,price,date) values(?,?,?,?)&quot;</span>;</span><br><span class="line"><span class="keyword">int</span>[] ints = jdbcTemplate.batchUpdate(sql, objects);</span><br></pre></td></tr></table></figure>

<h3 id="4-4-2-批量修改"><a href="#4-4-2-批量修改" class="headerlink" title="4.4.2 批量修改"></a>4.4.2 批量修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;update book set name=?,author=?,price=? where id=?&quot;</span>;</span><br><span class="line"><span class="keyword">int</span>[] ints = jdbcTemplate.batchUpdate(sql, objects);</span><br></pre></td></tr></table></figure>

<h3 id="4-4-3-批量删除"><a href="#4-4-3-批量删除" class="headerlink" title="4.4.3 批量删除"></a>4.4.3 批量删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">&quot;delete from book where id = ?&quot;</span>;</span><br><span class="line"><span class="keyword">int</span>[] ints = jdbcTemplate.batchUpdate(sql, objects);</span><br></pre></td></tr></table></figure>

<h1 id="第五章-事务功能"><a href="#第五章-事务功能" class="headerlink" title="第五章 事务功能"></a>第五章 事务功能</h1><h2 id="5-1-基础概念"><a href="#5-1-基础概念" class="headerlink" title="5.1 基础概念"></a>5.1 基础概念</h2><ul>
<li>事务是数据库操作最基本单元，逻辑上一组操作，要么都成功，如果有一个失败所有操作都失败。</li>
<li>典型场景：<ul>
<li>银行转账，A转账100给B，A少100，B多100。</li>
<li>但是当A少100后，网络异常或其他原因导致系统无法让B多100，此时就会发生混乱。</li>
<li>解决此问题就是用事务解决，把转账事件当成一个事务。</li>
</ul>
</li>
<li>事务四个特性（ACID）<ul>
<li>原子性</li>
<li>一致性</li>
<li>隔离性</li>
<li>持久性</li>
</ul>
</li>
<li>事务的操作过程。<ul>
<li>第一步：开启事务。</li>
<li>第二步：进行业务操作。</li>
<li>第三步：业务操作完成，提交事务。</li>
<li>第四步：业务操作发生中断，事务回滚将业务回滚到未执行业务前的状态。</li>
</ul>
</li>
<li>事务可以在任何地方使用，但一般事务用于 JavaEE 三层结构里面 Service 层（即业务逻辑层）。</li>
<li>在Spring进行事务管理操作有两种方式<ul>
<li>编程式事务管理：即通过代码的方式实现事务的操作过程。缺点是多个地方需要事务时，会造成代码冗余。</li>
<li>声明式事务管理：通过注解或xml配置的方式进行事务的操作过程。</li>
</ul>
</li>
<li><strong>声明式事务的底层使用的是AOP原理。</strong></li>
<li>事务管理的API</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305162242.png"></p>
<h2 id="5-2-事务操作-基于注解方式"><a href="#5-2-事务操作-基于注解方式" class="headerlink" title="5.2 事务操作-基于注解方式"></a>5.2 事务操作-基于注解方式</h2><ul>
<li>第一步：在配置文件中配置事务管理功能，并开启事务注解功能</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--开启注解/组件扫描--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置数据库连接池--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/spring-jdbc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--创建JdbcTemplate对象--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--创建事务管理--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注入数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启事务注解功能--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：在service层中的service类上添加事务注解@Transactional<ul>
<li>这个注解可以写在类上，也可以写在方法上。</li>
<li>如果把这个注解添加类上面，这个类里面所有的方法都添加事务。</li>
<li>如果把这个注解添加方法.上面，为这个方法添加事务。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时事务的功能就开启了。</li>
</ul>
<h2 id="5-3-注解的参数"><a href="#5-3-注解的参数" class="headerlink" title="5.3 注解的参数"></a>5.3 注解的参数</h2><ul>
<li>@Transactional注解中有很多参数，可以配置事务的相关信息。如下<ul>
<li>propagation：用于设置事务传播行为</li>
<li>isolation：用于设置事务隔离级别</li>
<li>timeout：用于设置超时时间</li>
<li>readOnly：用于设置是否只读</li>
<li>rollbackFor：用于设置回滚</li>
<li>noRollbackFor：用于设置不回滚</li>
</ul>
</li>
</ul>
<p><strong>propagation：事务传播行为</strong></p>
<ul>
<li><p>事务方法：指对数据库进行变化的操作。</p>
</li>
<li><p>事务传播行为：指一个方法调用另一个方法时，它们之间的事务传递方式。</p>
</li>
<li><p>事务传播行为有七种：</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305174026.png"></p>
</li>
<li><p>举例：方法add有事务注解，方法update没有事务注解。如下图：</p>
</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305174000.png"></p>
<ul>
<li>使用方式:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br></pre></td></tr></table></figure>

<p><strong>isolation：事务隔离级别</strong></p>
<ul>
<li><p>事务的隔离性是指，多事务操作之间不会产生影响。不考虑隔离性会产生很多问题。</p>
<ul>
<li>三个问题：脏读，不可重复度，幻读。</li>
</ul>
</li>
<li><p>脏读：一个未提交事务读取到另一个未提交事务的数据。</p>
</li>
<li><p>不可重复度：一个未提交事务读取到另一提交事务修改数据。</p>
</li>
<li><p>幻读：一个未提交事务读取到另一提交事务添加数据。</p>
</li>
<li><p>事务隔离级别有四种:</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210305174454.png"></p>
</li>
<li><p>使用方式如下</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED,isolation = Isolation.SERIALIZABLE)</span></span><br></pre></td></tr></table></figure>

<p><strong>timeout：超时时间</strong></p>
<ul>
<li>事务需要在一定时间内进行提交，如果不提交进行回滚。</li>
<li>默认值是 -1，设置时间以秒单位进行计算。</li>
</ul>
<p><strong>readOnly：是否只读</strong></p>
<ul>
<li>读：查询操作，写：添加修改删除操作。</li>
<li>readOnly 默认值 false，表示可以查询，可以添加修改删除操作。</li>
<li>设置 readOnly 值为 true 之后，只能查询。</li>
</ul>
<p><strong>rollbackFor：回滚</strong></p>
<ul>
<li>设置出现哪些异常进行事务回滚</li>
</ul>
<p><strong>noRollbackFor：不回滚</strong></p>
<ul>
<li>设置出现哪些异常不进行事务回滚</li>
</ul>
<h2 id="5-4-事务操作-基于xml方式"><a href="#5-4-事务操作-基于xml方式" class="headerlink" title="5.4 事务操作-基于xml方式"></a>5.4 事务操作-基于xml方式</h2><ul>
<li>第一步：配置事务管理器</li>
<li>第二步：配置通知</li>
<li>第三步：配置切入点和切面</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--开启注解/组件扫描--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置数据库连接池--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/spring-jdbc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--创建JdbcTemplate对象--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--第一步：创建事务管理--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注入数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--第二步：配置通知。即配置事务的类型和参数数据--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;transaction&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务参数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--配置以哪种犯法匹配事务。name表示方法名。account*表示匹配account开头字符串的方法名--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;account*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--第三步：配置切入点和切面--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置切入点，即事务作用于哪个类的哪个方法上--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.lc.service.UserService.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置切面，即把事务和切入点连接在一起--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;transaction&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-5-事务操作-基于完全注解方式"><a href="#5-5-事务操作-基于完全注解方式" class="headerlink" title="5.5 事务操作-基于完全注解方式"></a>5.5 事务操作-基于完全注解方式</h2><ul>
<li>即将基于注解方式的xml配置文件也以注解的形式开发。</li>
<li>以下的代码相当于5.2的xml配置文件的作用。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.lc&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//开启事务注解功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">//创建数据库连接池</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">getDruidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">    DruidDataSource druidDataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    <span class="comment">////注入属性</span></span><br><span class="line">    druidDataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/spring-jdbc&quot;</span>);</span><br><span class="line">    druidDataSource.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    druidDataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    druidDataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> druidDataSource;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//创建JdbcTeplate对象。dataSource是从ioc容器中传递过来的</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">getJdbcTemplate</span><span class="params">(DruidDataSource dataSource)</span></span>&#123;</span><br><span class="line">    JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">    <span class="comment">//注入属性</span></span><br><span class="line">    jdbcTemplate.setDataSource(dataSource);</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建事务管理器。dataSource是从ioc容器中传递过来的</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">getDataSourceTransactionManager</span><span class="params">(DruidDataSource dataSource)</span></span>&#123;</span><br><span class="line">    DataSourceTransactionManager dataSourceTransactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">    <span class="comment">//注入属性</span></span><br><span class="line">    dataSourceTransactionManager.setDataSource(dataSource);</span><br><span class="line">    <span class="keyword">return</span> dataSourceTransactionManager;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第六章-Spring5新特性"><a href="#第六章-Spring5新特性" class="headerlink" title="第六章 Spring5新特性"></a>第六章 Spring5新特性</h1><ul>
<li>整个 Spring5 框架的代码基于 Java8，运行时兼容 JDK9<strong>，</strong>许多不建议使用的类和方法在代码库中删除。</li>
</ul>
<h2 id="6-1-日志功能整合"><a href="#6-1-日志功能整合" class="headerlink" title="6.1 日志功能整合"></a>6.1 日志功能整合</h2><ul>
<li><p>Spring 5.0 框架自带了通用的日志封装</p>
</li>
<li><p>Spring5 已经移除 Log4jConfigListener，官方建议使用 Log4j2</p>
</li>
<li><p>如果要使用Log4j低版本的话，需要将spring版本降低到4以下。</p>
</li>
<li><p>spring5整合log4j2</p>
<ul>
<li>第一步：导入相关的日志jar包<ul>
<li>log4j2-api：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iXSeCmkqv2b">下载</a></li>
<li>log4j2-core：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/iydi2mkquzi">下载</a></li>
<li>log4jw-slf4j：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ipnAgmkqv0j">下载</a></li>
<li>slf4j-api：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ihtt0mkqv1a">下载</a></li>
</ul>
</li>
<li>第二步：创建配置文件。文件名固定为log4j2.xml。文件内容如下</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Configuration后面的status用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，可以看到log4j2内部各种详细输出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--先定义所有的appender--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--输出日志信息到控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--控制日志输出的格式--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--root：用于指定项目的根日志，如果没有单独指定Logger，则会使用root作为默认的日志输出--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用log4j2在控制台输出</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLog</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MyLog.class);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">&quot;hello info logger&quot;</span>);</span><br><span class="line">    logger.warn(<span class="string">&quot;hello warn logger&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>结果</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210306111003.png"></p>
<h2 id="6-2-Nullable注解"><a href="#6-2-Nullable注解" class="headerlink" title="6.2 @Nullable注解"></a>6.2 @Nullable注解</h2><ul>
<li>Spring5框架核心容器支持@Nullable注解。</li>
<li>@Nullable 注解可以使用在方法上面，属性上面，参数上面，表示方法返回可以为空，属性值可以为空，参数值可以为空。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在属性上使用@Nullable注解</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> ResourceLoader resourceLoader;</span><br><span class="line"><span class="comment">//在参数上使用@Nullable注解</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GenericApplicationContext</span><span class="params">(<span class="meta">@Nullable</span> ApplicationContext parent)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>();</span><br><span class="line">  setParent(parent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在方法上使用@Nullable注解</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ClassLoader <span class="title">getClassLoader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.resourceLoader != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">this</span>.customClassLoader) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.resourceLoader.getClassLoader();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">super</span>.getClassLoader();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-函数式编程风格"><a href="#6-3-函数式编程风格" class="headerlink" title="6.3 函数式编程风格"></a>6.3 函数式编程风格</h2><ul>
<li>Spring5 核心容器支持函数式风格 GenericApplicationContext</li>
<li>以将自己new出的对象放到bean中，而不是通过spring创建bean。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建GenericApplicationContext对象</span></span><br><span class="line">GenericApplicationContext context = <span class="keyword">new</span> GenericApplicationContext();</span><br><span class="line"><span class="comment">//创建user对象并注册到ioc中</span></span><br><span class="line">context.refresh();</span><br><span class="line"><span class="comment">//注册时不设置bean的name</span></span><br><span class="line">context.registerBean(User.class, ()-&gt;<span class="keyword">new</span> User());</span><br><span class="line"><span class="comment">//获取ioc中的bean.通过User的包路径</span></span><br><span class="line">User user = (User) context.getBean(<span class="string">&quot;bean.User&quot;</span>);</span><br><span class="line">System.out.println(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式</span></span><br><span class="line">context.refresh();</span><br><span class="line"><span class="comment">//注册时设置bean的name为user1</span></span><br><span class="line">context.registerBean(<span class="string">&quot;user1&quot;</span>,User.class, ()-&gt;<span class="keyword">new</span> User());</span><br><span class="line">User user1 = (User) context.getBean(<span class="string">&quot;user1&quot;</span>);</span><br><span class="line">System.out.println(user1);</span><br></pre></td></tr></table></figure>

<h2 id="6-4-单元测试"><a href="#6-4-单元测试" class="headerlink" title="6.4 单元测试"></a>6.4 单元测试</h2><ul>
<li>第一步导入spring关于测试的依赖<ul>
<li>spring-text：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ii4HPmkxpni">下载</a></li>
</ul>
</li>
<li>第二步：导入JUnit4和JUnit5相关的jar包<ul>
<li>JUnit4：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/icypxmkxsbe">jar包1</a>，<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ituYNmkxseh">jar包2</a></li>
<li>JUnit5：<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/i4zQ5mkyapg">jar包1</a>，<a target="_blank" rel="noopener" href="https://plumriver.lanzous.com/ikzhrmkyf3e">jar包2</a></li>
</ul>
</li>
</ul>
<h3 id="6-4-1-JUnit4"><a href="#6-4-1-JUnit4" class="headerlink" title="6.4.1 JUnit4"></a>6.4.1 JUnit4</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @RunWith 表示运行时的环境</span></span><br><span class="line"><span class="comment"> * @ContextConfiguration 表示加载的spring配置文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:spring-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JUnit4Test</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-2-JUnit5"><a href="#6-4-2-JUnit5" class="headerlink" title="6.4.2 JUnit5"></a>6.4.2 JUnit5</h3><ul>
<li>普通写法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:spring-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JUnit5Test</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> User user;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用复合注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:spring-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JUnit5Test</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> User user;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-5-webflux"><a href="#6-5-webflux" class="headerlink" title="6.5 webflux"></a>6.5 webflux</h2><h3 id="WebFlus介绍"><a href="#WebFlus介绍" class="headerlink" title="WebFlus介绍"></a>WebFlus介绍</h3><ul>
<li><p>SpringWebFlux是 Spring5 添加新的模块，用于 web 开发的，功能和 SpringMVC 类似的，Webflux 使用当前一种比较流程响应式编程出现的框架。</p>
</li>
<li><p>使用传统 web 框架，比如 SpringMVC，这些基于 Servlet 容器；Webflux 是一种异步非阻塞的框架，异步非阻塞的框架在 <strong>Servlet3.1 以后</strong>才支持，核心是基于 Reactor 的相关 API 实现的。</p>
<ul>
<li><p>异步和同步：针对调用者。调用者发送请求，如果等着对方回应之后才去做其他事情就是同步，如果发送请求之后不等着对方回应就去做其他事情就是异步</p>
</li>
<li><p>阻塞和非阻塞：针对被调用者。被调用者受到请求之后，做完请求任务之后才给出反馈就是阻</p>
<p>塞，受到请求之后马上给出反馈然后再去做事情就是非阻塞。</p>
</li>
</ul>
</li>
<li><p>WebFlux的特点：</p>
<ul>
<li>第一 非阻塞式：在有限资源下，提高系统吞吐量和伸缩性，以 Reactor 为基础实现响应式编程。</li>
<li>第二 函数式编程：Spring5 框架基于 java8，Webflux 使用 Java8 函数式编程方式实现路由请求。</li>
</ul>
</li>
<li><p>WebFlux与SpringMVC的区别：</p>
<ul>
<li>第一 两个框架都可以使用注解方式，都运行在 Tomet 等容器中。</li>
<li>第二 SpringMVC 采用命令式编程，Webflux 采用异步响应式编程。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427083625.png"></p>
</li>
<li><p>创建springboot项目为例：</p>
</li>
</ul>
<h3 id="响应式编程"><a href="#响应式编程" class="headerlink" title="响应式编程"></a>响应式编程</h3><ul>
<li><p>什么是响应式编程</p>
<ul>
<li><p>响应式编程是一种面向数据流和变化传播的编程范式。这意味着可以在编程语言中很方便</p>
<p>地表达静态或动态的数据流，而相关的计算模型会自动将变化的值通过数据流进行传播。</p>
</li>
<li><p>电子表格程序就是响应式编程的一个例子。单元格可以包含字面值或类似”=B1+C1”的公式，而包含公式的单元格的值会依据其他单元格的值的变化而变化。</p>
</li>
</ul>
</li>
<li><p>Java8 及其之前版本</p>
<ul>
<li>提供的<strong>观察者模式</strong>两个类 Observer 和 Observable.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 被观察者。</span></span><br><span class="line"><span class="comment"> * 观察者 看 被观察者。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverDemo</span> <span class="keyword">extends</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ObserverDemo observer = <span class="keyword">new</span> ObserverDemo();</span><br><span class="line">    <span class="comment">//添加观察者</span></span><br><span class="line">    observer.addObserver((o,arg)-&gt;&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;被观察者动了&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    observer.addObserver((o,arg)-&gt;&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;我看到被观察者动了，我要做。。。&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//被观察者的数据变了</span></span><br><span class="line">    observer.setChanged();</span><br><span class="line">    <span class="comment">//通知所有观察者。</span></span><br><span class="line">    observer.notifyObservers();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>Java9版本：</p>
<ul>
<li>使用Publisher接口实现。</li>
</ul>
</li>
<li><p>Reactor实现响应式编程。</p>
<ul>
<li><p>响应式编程操作中，所有操作都遵循Reactive 规范，Reactor就是遵循这个规范的框架。</p>
</li>
<li><p>Reactor 有两个核心类，Mono 和 Flux，这两个类实现接口 Publisher，提供丰富操作<br>符。</p>
<ul>
<li>Flux 对象实现发布者，返回 N 个元素；</li>
<li>Mono 实现发布者，返回 0 或者 1 个元素。</li>
<li>发布者类似于被观察者。</li>
</ul>
</li>
<li><p>Flux 和 Mono 都是数据流的发布者，使用 Flux 和 Mono 都可以发出三种数据信号：<br>元素值，错误信号，完成信号。</p>
<ul>
<li>错误信号和完成信号都代表终止信号。</li>
<li>终止信号用于告诉订阅者数据流结束了。</li>
<li>错误信号终止数据流同时把错误信息传递给订阅者。</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427100117.png"></p>
</li>
<li><p>三种信号特点：</p>
<ul>
<li>错误信号和完成信号都是终止信号，不能共存的。</li>
<li>如果没有发送任何元素值，而是直接发送错误或者完成信号，表示是空数据流。</li>
<li>如果没有错误信号，没有完成信号，表示是无限数据流。</li>
</ul>
</li>
<li><p>演示：</p>
<ul>
<li>第一步：引入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>第二步：编写代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Reactor实现响应式编程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//数据流的定义</span></span><br><span class="line">  Flux.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">  Mono.just(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">//其他类型数据的</span></span><br><span class="line">  Integer[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">  Flux.fromArray(array);</span><br><span class="line"></span><br><span class="line">  List&lt;Integer&gt; list = Arrays.asList(array);</span><br><span class="line">  Flux.fromIterable(list);</span><br><span class="line"></span><br><span class="line">  Stream&lt;Integer&gt; stream = list.stream();</span><br><span class="line">  Flux.fromStream(stream);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//终止信号</span></span><br><span class="line">  Flux.error(<span class="keyword">new</span> RuntimeException());</span><br><span class="line">  Mono.error(<span class="keyword">new</span> RuntimeException());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>调用 just 或者其他方法只是声明数据流，数据流并没有发出，只有进行订阅之后才会触发数据流，不订阅什么都不会发生的。</p>
<ul>
<li>订阅的内容类似于观察者看到被观察者变了之后要执行的业务。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>).subscribe(System.out::print);</span><br><span class="line">Mono.just(<span class="number">1</span>).subscribe(System.out::print)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>操作符：对数据流进行一道道操作，成为操作符，比如工厂流水线。</p>
<ul>
<li>map操作符：将元素映射为新元素。<ul>
<li>例如将1，2，3.按照平方的规则映射为1，4，9</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427104447.png"></p>
<ul>
<li>flatmap操作符：将元素映射为流。把每个元素转换流，把转换之后多个流合并大的流。<ul>
<li>顺序没有区别。</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427104451.png"></p>
</li>
</ul>
<h3 id="执行流程和核心-API"><a href="#执行流程和核心-API" class="headerlink" title="执行流程和核心 API"></a>执行流程和核心 API</h3><ul>
<li><p>SpringWebflux 基于 Reactor，默认使用容器是 Netty，Netty 是高性能的 NIO 框架，异步非阻塞的框架。</p>
<ul>
<li>引入webflux的依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Netty</p>
<ul>
<li>阻塞的过程</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427144138.png"></p>
<ul>
<li>非阻塞的过程</li>
</ul>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427144209.png"></p>
<ul>
<li><p>SpringWebflux 执行过程和 SpringMVC 相似的。</p>
<ul>
<li><p>SpringWebflux 核心控制器 DispatcherHandler，实现接口 WebHandler。</p>
</li>
<li><p>接口 WebHandler只有一个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WebHandler</span> </span>&#123;</span><br><span class="line">  <span class="comment">//核心业务处理方法</span></span><br><span class="line">  <span class="function">Mono&lt;Void&gt; <span class="title">handle</span><span class="params">(ServerWebExchange var1)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//其实现方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">handle</span><span class="params">(ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.handlerMappings == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> createNotFoundError();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (CorsUtils.isPreFlightRequest(exchange.getRequest())) &#123;</span><br><span class="line">    <span class="keyword">return</span> handlePreFlight(exchange);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//加载mappers列表</span></span><br><span class="line">  <span class="keyword">return</span> Flux.fromIterable(<span class="keyword">this</span>.handlerMappings)</span><br><span class="line">    <span class="comment">//根据请求地址获取对应mapping</span></span><br><span class="line">    .concatMap(mapping -&gt; mapping.getHandler(exchange))</span><br><span class="line">    .next()</span><br><span class="line">    .switchIfEmpty(createNotFoundError())</span><br><span class="line">   	<span class="comment">//调用具体的业务方法</span></span><br><span class="line">    .flatMap(handler -&gt; invokeHandler(exchange, handler))</span><br><span class="line">    <span class="comment">//处理结果返回值</span></span><br><span class="line">    .flatMap(result -&gt; handleResult(exchange, result));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>SpringWebflux 里面 DispatcherHandler，负责请求的处理。</p>
<ul>
<li>HandlerMapping属性：请求查询到处理的方法。</li>
<li>HandlerAdapter属性：真正负责请求处理。</li>
<li>ResultHandler属性：响应结果处理。</li>
</ul>
</li>
<li><p>SpringWebflux 实现函数式编程，两个接口：</p>
<ul>
<li>RouterFunction（路由处理）。</li>
<li>HandlerFunction（处理函数）。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="SpringWebFlux-基于注解编程实现"><a href="#SpringWebFlux-基于注解编程实现" class="headerlink" title="SpringWebFlux(基于注解编程实现)"></a>SpringWebFlux(基于注解编程实现)</h3><ul>
<li><p>使用注解编程模型方式，和之前 SpringMVC 使用相似的，只需要把相关依赖配置到项目中。</p>
</li>
<li><p>示例使用springboot项目，会自动配置相关依赖。并且webflux场景默认使用netty服务器。</p>
</li>
<li><p>第一步：创建Springboot项目，引入相关依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427185510.png"></p>
</li>
<li><p>第二步：配置启动端口号</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure></li>
<li><p>第三步：创建包和实体类</p>
<ul>
<li><p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDAO</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> String gender;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>服务层（注意写法，和MVC的写法有些不同）</p>
<ul>
<li>接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserServer</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据id查询用户信息。</span></span><br><span class="line"><span class="comment">   * 由于返回值只有一个或者没有，因此使用Mono</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Mono&lt;UserDAO&gt; <span class="title">getUserById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取全部的用户信息</span></span><br><span class="line"><span class="comment">   * 由于返回值会有多个，因此使用Flux</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Flux&lt;UserDAO&gt; <span class="title">listUsers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 往数据库中插入数据.</span></span><br><span class="line"><span class="comment">   * 由于可以没有返回值，因此使用Void</span></span><br><span class="line"><span class="comment">   * 参数只有一个，因此使用mono</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Mono&lt;Void&gt; <span class="title">saveUser</span><span class="params">(Mono&lt;UserDAO&gt; user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>实现类（由于不连接数据库）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServerImpl</span> <span class="keyword">implements</span> <span class="title">UserServer</span> </span>&#123;</span><br><span class="line">  <span class="comment">//由于不连接数据库，所以创建一些静态的数据，来模拟数据库的操作</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;Integer,UserDAO&gt; users = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserServerImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.users.put(<span class="number">1</span>, <span class="keyword">new</span> UserDAO(<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">18</span>));</span><br><span class="line">    <span class="keyword">this</span>.users.put(<span class="number">2</span>, <span class="keyword">new</span> UserDAO(<span class="string">&quot;ww&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    <span class="keyword">this</span>.users.put(<span class="number">3</span>, <span class="keyword">new</span> UserDAO(<span class="string">&quot;zs&quot;</span>,<span class="string">&quot;女&quot;</span>,<span class="number">28</span>));</span><br><span class="line">    <span class="keyword">this</span>.users.put(<span class="number">4</span>, <span class="keyword">new</span> UserDAO(<span class="string">&quot;qq&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="number">38</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;UserDAO&gt; <span class="title">getUserById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果有数据，就返回数据组成的流。如果没有数据，返回空流</span></span><br><span class="line">    <span class="keyword">return</span> Mono.justOrEmpty(<span class="keyword">this</span>.users.get(id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Flux&lt;UserDAO&gt; <span class="title">listUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.fromIterable(<span class="keyword">this</span>.users.values());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">saveUser</span><span class="params">(Mono&lt;UserDAO&gt; userMono)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// doOnNext()方法表示取出数据域中的值，放到person中。</span></span><br><span class="line">    <span class="comment">// 然后执行函数内的步骤。</span></span><br><span class="line">    <span class="comment">// 最后，thenEmpty(Mono.empty())表示将当前数据域中的数据清空。</span></span><br><span class="line">    <span class="comment">// 即返回一个空数据域</span></span><br><span class="line">    <span class="keyword">return</span> userMono.doOnNext(person-&gt;&#123;</span><br><span class="line">      <span class="keyword">int</span> id = users.size()+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">this</span>.users.put(id,person);</span><br><span class="line">    &#125;).thenEmpty(Mono.empty());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>控制层</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> UserServer userServer;</span><br><span class="line">  <span class="comment">//查询用户信息</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;UserDAO&gt; <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userServer.getUserById(id);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//获取用户信息</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Flux&lt;UserDAO&gt; <span class="title">getUsers</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userServer.listUsers();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//添加用户信息</span></span><br><span class="line">  <span class="meta">@PostMapping(&quot;/user/save&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">addUser</span><span class="params">(<span class="meta">@RequestBody</span> UserDAO userDAO)</span></span>&#123;</span><br><span class="line">    Mono&lt;UserDAO&gt; userMono = Mono.just(userDAO);</span><br><span class="line">    <span class="keyword">return</span> userServer.saveUser(userMono);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>第四步：启动SpringBoot。打印如下信息</p>
<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427184619.png"></p>
</li>
</ul>
<h3 id="SpringWebFlux-基于函数式编程实现"><a href="#SpringWebFlux-基于函数式编程实现" class="headerlink" title="SpringWebFlux(基于函数式编程实现)"></a>SpringWebFlux(基于函数式编程实现)</h3><ul>
<li><p>在使用函数式编程模型操作时候，需要自己初始化服务器。</p>
</li>
<li><p>基于函数式编程模型时候，有两个核心接口：</p>
<ul>
<li>RouterFunction（实现路由功能，请求转发给对应的 handler）和 HandlerFunction（处理请求生成响应的函数）。<ul>
<li>理解：对比SpringMVC，</li>
<li>RouterFunction的功能相当于将请求匹配到对应的控制层的方法上。比如mapping注解</li>
<li>HandlerFunction的功能相当于这个方法。</li>
</ul>
</li>
<li>核心任务定义两个函数式接口的实现并且启动需要的服务器。</li>
</ul>
</li>
<li><p>SpringWebflux 请 求 和 响 应 不 再 是 <strong>Servlet</strong>Request 和 <strong>Servlet</strong>Response ，而是<strong>Server</strong>Request 和 <strong>Server</strong>Response。</p>
</li>
<li><p>第一步：把注解编程模型工程复制一份 ，保留 pojo 和 service 内容。删除controller层。</p>
</li>
<li><p>第二步：创建<font color="red">Handler</font>(相当于UserController)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserHandler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> UserServer userServer;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserHandler</span><span class="params">(UserServer userServer)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userServer = userServer;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//根据id查询</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">getUser</span><span class="params">(ServerRequest request)</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取id值</span></span><br><span class="line">    <span class="keyword">int</span> userId = Integer.valueOf(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">    <span class="comment">//空值预处理</span></span><br><span class="line">    Mono&lt;ServerResponse&gt; notFound = ServerResponse.notFound().build();</span><br><span class="line">    <span class="comment">//调用server方法得到数据</span></span><br><span class="line">    Mono&lt;UserDAO&gt; userMono= <span class="keyword">this</span>.userServer.getUserById(userId);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.通过flatmap将userDAO转换成ServerResponse。</span></span><br><span class="line"><span class="comment">     * 2.设置ServerResponse状态为ok.内容类型为json格式，内容为person.</span></span><br><span class="line"><span class="comment">     * 3.person为从userMono中获取的单个元素</span></span><br><span class="line"><span class="comment">     * 4.switchIfEmpty表示如果结果为空，则用notFound作为返回值结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> userMono.flatMap(person-&gt;</span><br><span class="line">                            ServerResponse.ok()</span><br><span class="line">                            .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                            .body(fromObject(person)))</span><br><span class="line">      .switchIfEmpty(notFound);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//查询所有</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">getUsers</span><span class="params">(ServerRequest request)</span></span>&#123;</span><br><span class="line">    Flux&lt;UserDAO&gt; users = <span class="keyword">this</span>.userServer.listUsers();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.body()方法的另一种用法</span></span><br><span class="line"><span class="comment">     * 2.body()方法返回值：Mono&lt;ServerResponse&gt;类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> ServerResponse.ok()</span><br><span class="line">      .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">      .body(users,UserDAO.class);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//添加user</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">addUser</span><span class="params">(ServerRequest request)</span></span>&#123;</span><br><span class="line">    <span class="comment">//bodyToMono()：将body中的内容提取根据UserDAO类型提取到Mono数据流中</span></span><br><span class="line">    Mono&lt;UserDAO&gt; userMono = request.bodyToMono(UserDAO.class);</span><br><span class="line">    <span class="comment">//build()：构建响应。主体有参数充满。</span></span><br><span class="line">    <span class="comment">//Mono&lt;ServerResponse&gt; build(Publisher&lt;Void&gt; voidPublisher);</span></span><br><span class="line">    <span class="keyword">return</span> ServerResponse.ok()</span><br><span class="line">      .build(<span class="keyword">this</span>.userServer.saveUser(userMono));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>第三步：初始化服务器，编写RouterFunction</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">  <span class="comment">//1. 创建路由</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">routerFunction</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//创建handler对象</span></span><br><span class="line">    UserServer userServer = <span class="keyword">new</span> UserServerImpl();</span><br><span class="line">    UserHandler handler = <span class="keyword">new</span> UserHandler(userServer);</span><br><span class="line">    <span class="comment">//设置路由</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加了连个路由</span></span><br><span class="line"><span class="comment">     * 第一个路由：请求路经”/user/&#123;id&#125;“且请求数据格式为json --&gt; 对应handler方法的getUser</span></span><br><span class="line"><span class="comment">     * 第二个路由：请求路经”/users“且请求数据格式为json --&gt; 对应handler方法的getUsers</span></span><br><span class="line"><span class="comment">     * 注意：handler中的方法要求带有参数(ServerRequest request)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> RouterFunctions</span><br><span class="line">        .route(RequestPredicates</span><br><span class="line">            .GET(<span class="string">&quot;/user/&#123;id&#125;&quot;</span>)</span><br><span class="line">            .and(RequestPredicates</span><br><span class="line">                    .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                ), handler::getUser)</span><br><span class="line">        .andRoute(RequestPredicates</span><br><span class="line">            .GET(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .and(RequestPredicates</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                ),handler::getUsers);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 2. 创建适配器：</span></span><br><span class="line"><span class="comment">   *  2.1 将路由和handler适配</span></span><br><span class="line"><span class="comment">   *  2.2 创建服务器</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createReactorServer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//路由和handler适配</span></span><br><span class="line">    RouterFunction&lt;ServerResponse&gt; route = routerFunction();</span><br><span class="line">    HttpHandler httpHandler = RouterFunctions.toHttpHandler(route);</span><br><span class="line">    ReactorHttpHandlerAdapter adapter = <span class="keyword">new</span> ReactorHttpHandlerAdapter(httpHandler);</span><br><span class="line">    <span class="comment">//创建服务器</span></span><br><span class="line">    HttpServer httpServer = HttpServer.create();</span><br><span class="line">    <span class="comment">//将适配器在服务器启动时立即绑定到服务器上</span></span><br><span class="line">    httpServer.handle(adapter).bindNow();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>第四步：最终测试调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  Server server = <span class="keyword">new</span> Server();</span><br><span class="line">  <span class="comment">//创建服务</span></span><br><span class="line">  server.createReactorServer();</span><br><span class="line">  System.out.println(<span class="string">&quot;enter to exit&quot;</span>);</span><br><span class="line">  <span class="comment">//只要不输入数据，就能保证服务不关闭</span></span><br><span class="line">  System.in.read();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/plumChuan/picture-bed/raw/master/img/20210427205845.png"></p>
</li>
<li><p>使用WebClient调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    &#x2F;&#x2F;设置服务器地址，创建浏览器客户端</span><br><span class="line">    WebClient client &#x3D; WebClient.create(&quot;http:127.0.0.1:14951&quot;);</span><br><span class="line">    &#x2F;&#x2F;根据id查询</span><br><span class="line">    String id &#x3D; &quot;1&quot;;</span><br><span class="line">    UserDAO userDAO &#x3D; client.get()</span><br><span class="line">        .uri(&quot;&#x2F;user&#x2F;&#123;id&#125;&quot;, id)</span><br><span class="line">        .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToMono(UserDAO.class)</span><br><span class="line">        .block();</span><br><span class="line">    System.out.println(userDAO);</span><br><span class="line">    &#x2F;&#x2F;查询所有</span><br><span class="line">    Flux&lt;? extends UserDAO&gt; users &#x3D; client.get()</span><br><span class="line">        .uri(&quot;&#x2F;users&quot;)</span><br><span class="line">        .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToFlux(userDAO.getClass());</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * map()：将user元素转换成user中的name</span><br><span class="line">     * buffer()：将数据流存到缓冲区中</span><br><span class="line">     * doOnNext()：订阅。订阅的业务为输出</span><br><span class="line">     * blockFirst()：当缓冲区有元素则输出直到终止信号</span><br><span class="line">     *&#x2F;</span><br><span class="line">    users.map(user-&gt;user.getName())</span><br><span class="line">        .buffer()</span><br><span class="line">        .doOnNext(System.out::println)</span><br><span class="line">        .blockFirst();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

    </div>

    
    
    


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/26/Java%E5%AD%A6%E4%B9%A0/%E5%89%8D%E7%AB%AF/JavaWeb-eclipse%E7%89%88/" rel="prev" title="javaweb学习">
      <i class="fa fa-chevron-left"></i> javaweb学习
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/03/09/Java%E5%AD%A6%E4%B9%A0/JavaEE%E6%A1%86%E6%9E%B6/Mybatis/" rel="next" title="Mybatis知识总结">
      Mybatis知识总结 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-Spring%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">第一章 Spring框架概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-Spring%E7%9A%84%E5%85%A5%E9%97%A8%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 Spring的入门实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-IOC%E5%AE%B9%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">第二章 IOC容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-IOC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 IOC底层原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-IOC%E6%8E%A5%E5%8F%A3%EF%BC%9ABeanFactory"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 IOC接口：BeanFactory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-IOC%E6%93%8D%E4%BD%9CBean%E7%AE%A1%E7%90%86%EF%BC%9A"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 IOC操作Bean管理：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-%E5%9F%BA%E4%BA%8Exml%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.3.1.</span> <span class="nav-text">2.3.1 基于xml的方式—创建对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-%E5%9F%BA%E4%BA%8Exml%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E6%B3%A8%E5%85%A5%E5%B1%9E%E6%80%A7"><span class="nav-number">2.3.2.</span> <span class="nav-text">2.3.2 基于xml的方式—注入属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-3-%E5%9F%BA%E4%BA%8Exml%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E6%B3%A8%E5%85%A5%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">2.3.3.</span> <span class="nav-text">2.3.3 基于xml的方式—注入其他类型属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-4-%E5%9F%BA%E4%BA%8Exml%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E6%B3%A8%E5%85%A5%E9%9B%86%E5%90%88%E5%B1%9E%E6%80%A7"><span class="nav-number">2.3.4.</span> <span class="nav-text">2.3.4 基于xml的方式—注入集合属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-5-%E5%9F%BA%E4%BA%8Exml%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E6%8F%90%E5%8F%96%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E3%80%82"><span class="nav-number">2.3.5.</span> <span class="nav-text">2.3.5 基于xml的方式—提取公共部分。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-6-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="nav-number">2.3.6.</span> <span class="nav-text">2.3.6 基于注解的方式—创建对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-7%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%96%B9%E5%BC%8F%E2%80%94%E6%B3%A8%E5%85%A5%E5%B1%9E%E6%80%A7"><span class="nav-number">2.3.7.</span> <span class="nav-text">2.3.7基于注解的方式—注入属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-8-%E5%85%A8%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91"><span class="nav-number">2.3.8.</span> <span class="nav-text">2.3.8 全注解方式开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-Bean%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 Bean的两种类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 Bean的作用域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 Bean的生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-Bean%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8A%9F%E8%83%BD"><span class="nav-number">2.7.</span> <span class="nav-text">2.7 Bean的自动装配功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-8-Bean%E6%93%8D%E4%BD%9C-%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E5%B1%9E%E6%80%A7%E6%96%87%E4%BB%B6"><span class="nav-number">2.8.</span> <span class="nav-text">2.8 Bean操作-引入外部属性文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-Aop"><span class="nav-number">3.</span> <span class="nav-text">第三章 Aop</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Aop%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 Aop的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 JDK动态代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Aop%E7%9A%84%E6%9C%AF%E8%AF%AD"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 Aop的术语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-Aop%E6%93%8D%E4%BD%9C-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 Aop操作-准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-Aop%E6%93%8D%E4%BD%9C-%E5%9F%BA%E4%BA%8EAspectJ%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 Aop操作-基于AspectJ注解方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-1-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">3.5.1.</span> <span class="nav-text">3.5.1 基础使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-2-%E7%9B%B8%E5%90%8C%E5%88%87%E5%85%A5%E7%82%B9%E7%9A%84%E6%8F%90%E5%8F%96"><span class="nav-number">3.5.2.</span> <span class="nav-text">3.5.2 相同切入点的提取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-3-%E5%A4%9A%E4%B8%AA%E5%A2%9E%E5%BC%BA%E7%B1%BB%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.5.3.</span> <span class="nav-text">3.5.3 多个增强类的优先级设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-4-%E5%AE%8C%E5%85%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="nav-number">3.5.4.</span> <span class="nav-text">3.5.4 完全注解开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-Aop%E6%93%8D%E4%BD%9C-%E5%9F%BA%E4%BA%8EAspectJ%E9%85%8D%E7%BD%AExml%E6%96%B9%E5%BC%8F"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 Aop操作-基于AspectJ配置xml方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-JdbcTemplate"><span class="nav-number">4.</span> <span class="nav-text">第四章 JdbcTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-JdbcTemplate%E6%93%8D%E4%BD%9C-%E6%B7%BB%E5%8A%A0-%E4%BF%AE%E6%94%B9-%E5%88%A0%E9%99%A4"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 JdbcTemplate操作-添加&#x2F;修改&#x2F;删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%A0%B7%E4%BE%8B"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1 添加操作样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C%E6%A0%B7%E4%BE%8B"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2 修改操作样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C%E6%A0%B7%E4%BE%8B"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3 删除操作样例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-JdbcTemplate%E6%93%8D%E4%BD%9C-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 JdbcTemplate操作-查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.3.1 查询返回对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-%E6%9F%A5%E8%AF%A2%E6%9F%90%E4%B8%AA%E5%80%BC"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.3.2 查询某个值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E9%9B%86%E5%90%88"><span class="nav-number">4.3.3.</span> <span class="nav-text">4.3.3 查询返回集合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-JdbcTemplate%E6%93%8D%E4%BD%9C-%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0-%E4%BF%AE%E6%94%B9-%E5%88%A0%E9%99%A4"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 JdbcTemplate操作-批量添加&#x2F;修改&#x2F;删除</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1-%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0"><span class="nav-number">4.4.1.</span> <span class="nav-text">4.4.1 批量添加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2-%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9"><span class="nav-number">4.4.2.</span> <span class="nav-text">4.4.2 批量修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-3-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="nav-number">4.4.3.</span> <span class="nav-text">4.4.3 批量删除</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E4%BA%8B%E5%8A%A1%E5%8A%9F%E8%83%BD"><span class="nav-number">5.</span> <span class="nav-text">第五章 事务功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 事务操作-基于注解方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%8F%82%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 注解的参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C-%E5%9F%BA%E4%BA%8Exml%E6%96%B9%E5%BC%8F"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 事务操作-基于xml方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C-%E5%9F%BA%E4%BA%8E%E5%AE%8C%E5%85%A8%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 事务操作-基于完全注解方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-Spring5%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-number">6.</span> <span class="nav-text">第六章 Spring5新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD%E6%95%B4%E5%90%88"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 日志功能整合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-Nullable%E6%B3%A8%E8%A7%A3"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 @Nullable注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E9%A3%8E%E6%A0%BC"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 函数式编程风格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">6.4.</span> <span class="nav-text">6.4 单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-1-JUnit4"><span class="nav-number">6.4.1.</span> <span class="nav-text">6.4.1 JUnit4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-2-JUnit5"><span class="nav-number">6.4.2.</span> <span class="nav-text">6.4.2 JUnit5</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-webflux"><span class="nav-number">6.5.</span> <span class="nav-text">6.5 webflux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebFlus%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.5.1.</span> <span class="nav-text">WebFlus介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">6.5.2.</span> <span class="nav-text">响应式编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%92%8C%E6%A0%B8%E5%BF%83-API"><span class="nav-number">6.5.3.</span> <span class="nav-text">执行流程和核心 API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringWebFlux-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.5.4.</span> <span class="nav-text">SpringWebFlux(基于注解编程实现)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringWebFlux-%E5%9F%BA%E4%BA%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.5.5.</span> <span class="nav-text">SpringWebFlux(基于函数式编程实现)</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Plum Reiver</p>
  <div class="site-description" itemprop="description">技术，日常，笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
	
  </nav>
</div>


      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Plum Reiver</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
